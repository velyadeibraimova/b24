this.BX=this.BX||{};(function(e,s,a,l){"use strict";let i=e=>e,t,r;var o=babelHelpers.classPrivateFieldLooseKey("widgetContainerId");var b=babelHelpers.classPrivateFieldLooseKey("messages");var d=babelHelpers.classPrivateFieldLooseKey("options");var c=babelHelpers.classPrivateFieldLooseKey("postInfo");var v=babelHelpers.classPrivateFieldLooseKey("url");var n=babelHelpers.classPrivateFieldLooseKey("pageSettings");var p=babelHelpers.classPrivateFieldLooseKey("activeMessageIndex");var h=babelHelpers.classPrivateFieldLooseKey("loader");var P=babelHelpers.classPrivateFieldLooseKey("loaderOverlay");var u=babelHelpers.classPrivateFieldLooseKey("lockButtons");var L=babelHelpers.classPrivateFieldLooseKey("needLoadNewMessages");var F=babelHelpers.classPrivateFieldLooseKey("loadNewMessages");var H=babelHelpers.classPrivateFieldLooseKey("fetchNewMessages");var B=babelHelpers.classPrivateFieldLooseKey("renderMessages");var m=babelHelpers.classPrivateFieldLooseKey("renderMessageElement");var f=babelHelpers.classPrivateFieldLooseKey("handleClickOnNextBtn");var g=babelHelpers.classPrivateFieldLooseKey("showNextMessage");var y=babelHelpers.classPrivateFieldLooseKey("showPrevMessage");var O=babelHelpers.classPrivateFieldLooseKey("readMessage");var j=babelHelpers.classPrivateFieldLooseKey("setPageSettings");var K=babelHelpers.classPrivateFieldLooseKey("hasNextMessage");var N=babelHelpers.classPrivateFieldLooseKey("getNextMessageIndex");var C=babelHelpers.classPrivateFieldLooseKey("hasPrevMessage");var M=babelHelpers.classPrivateFieldLooseKey("getPrevMessageIndex");var w=babelHelpers.classPrivateFieldLooseKey("removeMessageFromList");var D=babelHelpers.classPrivateFieldLooseKey("getActiveMessageElement");var E=babelHelpers.classPrivateFieldLooseKey("getMessageById");var x=babelHelpers.classPrivateFieldLooseKey("getMessagesListContainer");var I=babelHelpers.classPrivateFieldLooseKey("getReadMessageButton");var S=babelHelpers.classPrivateFieldLooseKey("getWidgetContainer");var _=babelHelpers.classPrivateFieldLooseKey("updateCurrentMessageNumber");var A=babelHelpers.classPrivateFieldLooseKey("updateTotalMessagesNumber");var T=babelHelpers.classPrivateFieldLooseKey("getTotalMessagesNumberContainer");var R=babelHelpers.classPrivateFieldLooseKey("getActiveMessageIndex");var X=babelHelpers.classPrivateFieldLooseKey("getPrevMessageButton");var $=babelHelpers.classPrivateFieldLooseKey("getNextMessageButton");var k=babelHelpers.classPrivateFieldLooseKey("showLoader");var q=babelHelpers.classPrivateFieldLooseKey("hideLoader");var J=babelHelpers.classPrivateFieldLooseKey("enableNextButton");var G=babelHelpers.classPrivateFieldLooseKey("disableNextButton");var W=babelHelpers.classPrivateFieldLooseKey("enablePrevButton");var z=babelHelpers.classPrivateFieldLooseKey("disablePrevButton");class Y{constructor(e){Object.defineProperty(this,z,{value:Ke});Object.defineProperty(this,W,{value:je});Object.defineProperty(this,G,{value:Oe});Object.defineProperty(this,J,{value:ye});Object.defineProperty(this,q,{value:ge});Object.defineProperty(this,k,{value:fe});Object.defineProperty(this,$,{value:me});Object.defineProperty(this,X,{value:Be});Object.defineProperty(this,R,{value:He});Object.defineProperty(this,T,{value:Fe});Object.defineProperty(this,A,{value:Le});Object.defineProperty(this,_,{value:ue});Object.defineProperty(this,S,{value:Pe});Object.defineProperty(this,I,{value:he});Object.defineProperty(this,x,{value:pe});Object.defineProperty(this,E,{value:ne});Object.defineProperty(this,D,{value:ve});Object.defineProperty(this,w,{value:ce});Object.defineProperty(this,M,{value:de});Object.defineProperty(this,C,{value:be});Object.defineProperty(this,N,{value:oe});Object.defineProperty(this,K,{value:re});Object.defineProperty(this,j,{value:te});Object.defineProperty(this,O,{value:ie});Object.defineProperty(this,y,{value:le});Object.defineProperty(this,g,{value:ae});Object.defineProperty(this,f,{value:se});Object.defineProperty(this,m,{value:ee});Object.defineProperty(this,B,{value:Z});Object.defineProperty(this,H,{value:V});Object.defineProperty(this,F,{value:U});Object.defineProperty(this,L,{value:Q});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:[]});Object.defineProperty(this,d,{writable:true,value:{}});Object.defineProperty(this,c,{writable:true,value:{}});Object.defineProperty(this,v,{writable:true,value:""});Object.defineProperty(this,n,{writable:true,value:{}});Object.defineProperty(this,p,{writable:true,value:0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e.widgetContainerId;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.messages;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e.options;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e.postInfo;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.url;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.pageSettings;babelHelpers.classPrivateFieldLooseBase(this,c)[c].AJAX_POST="Y";this.init()}init(){babelHelpers.classPrivateFieldLooseBase(this,B)[B]();s.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,$)[$](),"click",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){return}babelHelpers.classPrivateFieldLooseBase(this,u)[u]=true;babelHelpers.classPrivateFieldLooseBase(this,f)[f]().then((()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]=false;this.updateNavigation()})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]=false}))}));s.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,X)[X](),"click",(()=>{if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){return}babelHelpers.classPrivateFieldLooseBase(this,u)[u]=true;babelHelpers.classPrivateFieldLooseBase(this,y)[y]().then((()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]=false;this.updateNavigation()})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]=false}))}));s.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,I)[I](),"click",(()=>{const e=this.getActiveMessage();babelHelpers.classPrivateFieldLooseBase(this,O)[O](e.id)}));l.EventEmitter.subscribe("onImportantPostRead",(e=>{const[s]=e.getData();babelHelpers.classPrivateFieldLooseBase(this,w)[w](s)}));const e=s.Runtime.debounce((()=>{babelHelpers.classPrivateFieldLooseBase(this,F)[F]().then((()=>{this.updateNavigation();this.show()})).catch((()=>{}))}),6e3);l.EventEmitter.subscribe("onPullEvent-main",(a=>{if(babelHelpers.classPrivateFieldLooseBase(this,b)[b].length>0){return}const[l,i]=a.getCompatData();if(l==="user_counter"&&i[s.Loc.getMessage("SITE_ID")]&&i[s.Loc.getMessage("SITE_ID")]["BLOG_POST_IMPORTANT"]){e()}}));this.updateNavigation()}show(){if(babelHelpers.classPrivateFieldLooseBase(this,b)[b].length===0){return}const e=this.getActiveMessage();if(!e){const e=babelHelpers.classPrivateFieldLooseBase(this,b)[b][babelHelpers.classPrivateFieldLooseBase(this,p)[p]]||null;const a=babelHelpers.classPrivateFieldLooseBase(this,x)[x]().querySelector(`[data-message-id="${e==null?void 0:e.id}"]`);if(a){s.Dom.addClass(a,"--active")}}s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,S)[S](),["--hidden","--hiding"])}hide(){s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,S)[S](),"--hiding");s.Event.bindOnce(babelHelpers.classPrivateFieldLooseBase(this,S)[S](),"transitionend",(()=>{s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,S)[S](),"--hiding");s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,S)[S](),"--hidden")}))}getActiveMessage(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b][babelHelpers.classPrivateFieldLooseBase(this,R)[R]()]||null}updateNavigation(){if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]>=babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavRecordCount-1){babelHelpers.classPrivateFieldLooseBase(this,G)[G]()}else if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavRecordCount>1){babelHelpers.classPrivateFieldLooseBase(this,J)[J]()}else{babelHelpers.classPrivateFieldLooseBase(this,G)[G]()}if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]===0){babelHelpers.classPrivateFieldLooseBase(this,z)[z]()}else{babelHelpers.classPrivateFieldLooseBase(this,W)[W]()}babelHelpers.classPrivateFieldLooseBase(this,_)[_]();babelHelpers.classPrivateFieldLooseBase(this,A)[A]()}}function Q(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].bDescPageNumbering===true&&babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavPageNomer>1||babelHelpers.classPrivateFieldLooseBase(this,b)[b].length<babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavRecordCount}async function U(){const e=await babelHelpers.classPrivateFieldLooseBase(this,H)[H]();const a=e.messages;babelHelpers.classPrivateFieldLooseBase(this,j)[j](e.pageSettings);for(const e of a){if(babelHelpers.classPrivateFieldLooseBase(this,E)[E](e.id)){continue}babelHelpers.classPrivateFieldLooseBase(this,b)[b].push(e);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,m)[m](e,false),babelHelpers.classPrivateFieldLooseBase(this,x)[x]())}}function V(){return new Promise(((e,a)=>{const l=babelHelpers.classPrivateFieldLooseBase(this,c)[c];if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].bDescPageNumbering){babelHelpers.classPrivateFieldLooseBase(this,n)[n].iNumPage=babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavPageNomer-1}else{babelHelpers.classPrivateFieldLooseBase(this,n)[n].iNumPage=babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavPageNomer+1}l.page_settings=babelHelpers.classPrivateFieldLooseBase(this,n)[n];l.sessid=BX.bitrix_sessid();s.ajax({method:"POST",processData:true,url:babelHelpers.classPrivateFieldLooseBase(this,v)[v],data:l,onsuccess:s=>{const a=JSON.parse(s);e({messages:a.data,pageSettings:a.page_settings})},onfailure:e=>{a(e)}})}))}function Z(){babelHelpers.classPrivateFieldLooseBase(this,b)[b].forEach(((e,a)=>{s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,m)[m](e,a===0),babelHelpers.classPrivateFieldLooseBase(this,x)[x]())}))}function ee(e,a){return s.Tag.render(t||(t=i`
			<div class="sidebar-imp-mess ${0}" data-message-id="${0}">
				<a href="${0}" class="sidebar-imp-mess-wrap">
					<div class="sidebar-imp-mess-avatar-block">
						<div class="sidebar-imp-mess-author-avatar ui-icon ui-icon-common-user"><i ${0}></i></div>
					</div>
					<div class="sidebar-imp-mess-info">
						<div class="sidebar-imp-mess-title">${0}</div>
						<div class="sidebar-imp-mess-text">${0}</div>
					</div>
				</a>
			</div>
		`),a?"--active":"",e.id,e.post_url,e.author_avatar,e.author_name,e.post_text)}async function se(){if(!babelHelpers.classPrivateFieldLooseBase(this,K)[K]()&&babelHelpers.classPrivateFieldLooseBase(this,L)[L]()){babelHelpers.classPrivateFieldLooseBase(this,k)[k]();await babelHelpers.classPrivateFieldLooseBase(this,F)[F]();babelHelpers.classPrivateFieldLooseBase(this,q)[q]()}return babelHelpers.classPrivateFieldLooseBase(this,g)[g]().then((()=>{this.updateNavigation()})).catch((()=>{}))}async function ae(){if(!babelHelpers.classPrivateFieldLooseBase(this,K)[K]()){return Promise.resolve()}return new Promise(((e,a)=>{const l=babelHelpers.classPrivateFieldLooseBase(this,x)[x]().querySelector(".sidebar-imp-mess.--active");const i=l.nextElementSibling||babelHelpers.classPrivateFieldLooseBase(this,x)[x]().firstElementChild;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=babelHelpers.classPrivateFieldLooseBase(this,N)[N]();s.Dom.addClass(l,"--slide-out-left");s.Dom.addClass(i,"--active");s.Dom.addClass(i,"--slide-in-right");s.Event.bindOnce(l,"animationend",(()=>{s.Dom.removeClass(l,"--active");s.Dom.removeClass(l,"--slide-out-left");s.Dom.removeClass(i,"--slide-in-right");e()}))}))}function le(){if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C]()){return Promise.resolve()}return new Promise(((e,a)=>{const l=babelHelpers.classPrivateFieldLooseBase(this,x)[x]().querySelector(".sidebar-imp-mess.--active");const i=l.previousElementSibling||babelHelpers.classPrivateFieldLooseBase(this,x)[x]().lastElementChild;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=babelHelpers.classPrivateFieldLooseBase(this,M)[M]();s.Dom.addClass(l,"--slide-out-right");s.Dom.addClass(i,"--active");s.Dom.addClass(i,"--slide-in-left");s.Event.bindOnce(l,"animationend",(()=>{s.Dom.removeClass(l,"--active");s.Dom.removeClass(l,"--slide-out-right");s.Dom.removeClass(i,"--slide-in-left");e()}))}))}async function ie(e){const a=babelHelpers.classPrivateFieldLooseBase(this,E)[E](e);const l=[];for(const e of babelHelpers.classPrivateFieldLooseBase(this,d)[d]){l.push({post_id:a.id,name:e.name,value:e.value})}let i=babelHelpers.classPrivateFieldLooseBase(this,c)[c];i.options=l;i.page_settings=babelHelpers.classPrivateFieldLooseBase(this,n)[n];i.sessid=BX.bitrix_sessid();i=s.ajax.prepareData(i);babelHelpers.classPrivateFieldLooseBase(this,k)[k]();if(!babelHelpers.classPrivateFieldLooseBase(this,K)[K]()&&babelHelpers.classPrivateFieldLooseBase(this,L)[L]()){await babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}s.ajax({method:"GET",url:babelHelpers.classPrivateFieldLooseBase(this,v)[v]+(babelHelpers.classPrivateFieldLooseBase(this,v)[v].includes("?")?"&":"?")+i,onsuccess:s=>{const a=JSON.parse(s);babelHelpers.classPrivateFieldLooseBase(this,w)[w](e,a.page_settings);babelHelpers.classPrivateFieldLooseBase(this,q)[q]()},onfailure:()=>{babelHelpers.classPrivateFieldLooseBase(this,q)[q]()}})}function te(e){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e}function re(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]+1<=babelHelpers.classPrivateFieldLooseBase(this,b)[b].length-1}function oe(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]+1>babelHelpers.classPrivateFieldLooseBase(this,b)[b].length-1?0:babelHelpers.classPrivateFieldLooseBase(this,p)[p]+1}function be(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]-1>=0}function de(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]-1<0?babelHelpers.classPrivateFieldLooseBase(this,b)[b].length-1:babelHelpers.classPrivateFieldLooseBase(this,p)[p]-1}function ce(e,a=null){const l=()=>{const l=this.getActiveMessage();s.Dom.remove(i);babelHelpers.classPrivateFieldLooseBase(this,b)[b]=babelHelpers.classPrivateFieldLooseBase(this,b)[b].filter((s=>s.id!==e));babelHelpers.classPrivateFieldLooseBase(this,p)[p]=Math.max(0,babelHelpers.classPrivateFieldLooseBase(this,b)[b].findIndex((e=>e.id===l.id)));if(a===null){babelHelpers.classPrivateFieldLooseBase(this,j)[j]({...babelHelpers.classPrivateFieldLooseBase(this,n)[n],NavRecordCount:Math.max(0,babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavRecordCount-1)})}else{babelHelpers.classPrivateFieldLooseBase(this,j)[j](a)}this.updateNavigation();if(babelHelpers.classPrivateFieldLooseBase(this,b)[b].length===0){this.hide()}};const i=babelHelpers.classPrivateFieldLooseBase(this,x)[x]().querySelector(`[data-message-id="${e}"]`);const t=babelHelpers.classPrivateFieldLooseBase(this,D)[D]();if(i===t){if(babelHelpers.classPrivateFieldLooseBase(this,K)[K]()){babelHelpers.classPrivateFieldLooseBase(this,g)[g]().then(l).catch((()=>{}))}else if(babelHelpers.classPrivateFieldLooseBase(this,C)[C]()){babelHelpers.classPrivateFieldLooseBase(this,y)[y]().then(l).catch((()=>{}))}else{l()}}else{l()}}function ve(){return babelHelpers.classPrivateFieldLooseBase(this,x)[x]().querySelector(".--active")}function ne(e){return babelHelpers.classPrivateFieldLooseBase(this,b)[b].find((s=>s.id===e))}function pe(){return document.getElementById("sidebar-imp-mess-list")}function he(){return document.getElementById("sidebar-imp-mess-read-button")}function Pe(){return document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,o)[o])}function ue(){const e=document.getElementById("sidebar-imp-mess-current-mess-number");e.textContent=babelHelpers.classPrivateFieldLooseBase(this,p)[p]+1}function Le(){const e=babelHelpers.classPrivateFieldLooseBase(this,T)[T]();e.textContent=babelHelpers.classPrivateFieldLooseBase(this,n)[n].NavRecordCount}function Fe(){return document.getElementById("sidebar-imp-mess-total")}function He(){return[...babelHelpers.classPrivateFieldLooseBase(this,x)[x]().children].indexOf(babelHelpers.classPrivateFieldLooseBase(this,x)[x]().querySelector(".--active"))}function Be(){return document.getElementById("sidebar-imp-mess-prev")}function me(){return document.getElementById("sidebar-imp-mess-next")}function fe(){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=s.Tag.render(r||(r=i`
			<div class="sidebar-widget-content-overlay"></div>
		`));s.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,P)[P],{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(255, 255, 255, 0.7)"});s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,P)[P],babelHelpers.classPrivateFieldLooseBase(this,S)[S]());if(!babelHelpers.classPrivateFieldLooseBase(this,h)[h]){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new a.Loader({size:60,target:babelHelpers.classPrivateFieldLooseBase(this,P)[P],color:"#0154C8"})}babelHelpers.classPrivateFieldLooseBase(this,h)[h].show()}function ge(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,h)[h])==null?void 0:e.hide();s.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,P)[P])}function ye(){babelHelpers.classPrivateFieldLooseBase(this,$)[$]().removeAttribute("disabled")}function Oe(){babelHelpers.classPrivateFieldLooseBase(this,$)[$]().setAttribute("disabled",true)}function je(){babelHelpers.classPrivateFieldLooseBase(this,X)[X]().removeAttribute("disabled")}function Ke(){babelHelpers.classPrivateFieldLooseBase(this,X)[X]().setAttribute("disabled",true)}e.ImportantMessagesWidget=Y})(this.BX.Intranet=this.BX.Intranet||{},BX,BX,BX.Event);
//# sourceMappingURL=script.map.js