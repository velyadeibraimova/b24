this.BX=this.BX||{};(function(e,t,s,i,n,a,o,r,l,c,d,u){"use strict";class m{static eventName(e){return["BX.Intranet.LeftMenu:",...c.Type.isStringFilled(e)?[e]:e].join(":")}}m.version="2021.10";m.eventNameSpace="BX.Intranet.LeftMenu:";m.isExtranet=false;m.isAdmin=false;m.isCustomPresetRestricted=false;m.settingsPath=null;m.isMainPageEnabled=false;m.availablePresetTools=null;m.inviteDialogLink=null;m.showMarta=null;m.showSitemapMenuItem=null;var h=babelHelpers.classPrivateFieldLooseKey("popup");class p{constructor(e,{events:t}){Object.defineProperty(this,h,{writable:true,value:null});this.container=e;if(t){Array.from(Object.keys(t)).forEach((e=>{a.EventEmitter.subscribe(this,m.eventName(e),t[e])}))}}getContainer(){return this.container}createPopup(){}getPopup(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h]}show(){if(babelHelpers.classPrivateFieldLooseBase(this,h)[h]===null){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=this.createPopup(...arguments);a.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,h)[h],"onClose",(()=>{a.EventEmitter.emit(this,m.eventName("onClose"))}));a.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,h)[h],"onShow",(()=>{a.EventEmitter.emit(this,m.eventName("onShow"))}));a.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,h)[h],"onDestroy",(()=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h]=null}))}babelHelpers.classPrivateFieldLooseBase(this,h)[h].show()}hide(){if(babelHelpers.classPrivateFieldLooseBase(this,h)[h]){babelHelpers.classPrivateFieldLooseBase(this,h)[h].close()}}}let g=e=>e,f;class b extends p{constructor(...e){super(...e);this.isReady=true}createPopup(){const e=c.Tag.render(f||(f=g`
			<form id="customPresetForm" style="min-width: 350px;">
				<div style="margin: 15px 0 15px 9px;">
					<input type="radio" name="userScope" id="customPresetCurrentUser" value="currentUser">
					<label for="customPresetCurrentUser">${0}</label>
				</div>
				<div style="margin: 0 0 38px 9px;">
					<input type="radio" name="userScope" id="customPresetNewUser" value="newUser" checked>
					<label for="customPresetNewUser">${0}</label>
				</div>
				<hr style="background-color: #edeef0; border: none; color:  #edeef0; height: 1px;">
			</form>
		`),c.Loc.getMessage("MENU_CUSTOM_PRESET_CURRENT_USER"),c.Loc.getMessage("MENU_CUSTOM_PRESET_NEW_USER"));return n.PopupManager.create("custom-preset-form-popup",null,{overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:c.Loc.getMessage("MENU_CUSTOM_PRESET_POPUP_TITLE"),offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,content:e,buttons:[new t.SaveButton({onclick:t=>{if(this.isReady===false){return}t.setWaiting(true);this.isReady=false;a.EventEmitter.emit(this,m.eventName("onPresetIsSet"),e.elements.userScope.value==="newUser").forEach((e=>{e.then((()=>{t.setWaiting(false);this.hide();n.PopupManager.create("menu-custom-preset-success-popup",null,{closeIcon:true,contentColor:"white",titleBar:c.Loc.getMessage("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:c.Loc.getMessage("MENU_CUSTOM_PRESET_SUCCESS")}).show()})).catch((()=>{console.log("Error!!")}))}));this.isReady=true}}),new t.CancelButton({onclick:()=>{this.hide()}})]})}}var v=babelHelpers.classPrivateFieldLooseKey("curPage");var y=babelHelpers.classPrivateFieldLooseKey("curUri");class E{static getCurPage(){if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]===null){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=document.location.pathname+document.location.search}return babelHelpers.classPrivateFieldLooseBase(this,v)[v]===""?null:babelHelpers.classPrivateFieldLooseBase(this,v)[v]}static getCurUri(){if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]===null){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new c.Uri(document.location.href)}return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}static catchError(e){c.Runtime.loadExtension("ui.notification").then((()=>{const t=c.Reflection.getClass("BX.UI.Notification.Center");t.notify({content:[c.Loc.getMessage("MENU_ERROR_OCCURRED"),e.errors?`: ${e.errors[0].message}`:""].join(" "),position:"bottom-left",category:"menu-self-item-popup",autoHideDelay:3e3})})).catch((()=>{console.log("LeftMenu: cannot load ui.notification.")}))}static refineUrl(e){let t=String(e).trim();if(t!==""){if(!/^https?:\/\//i.test(t)&&!/^\//i.test(t)){t=`https://${t}`}else{const e=document.createElement("a");e.href=t;if(document.location.host===e.host){t=e.pathname+e.search+e.hash}}}return t}}Object.defineProperty(E,v,{writable:true,value:null});Object.defineProperty(E,y,{writable:true,value:null});var L=babelHelpers.classPrivateFieldLooseKey("unavailableToolPopup");var C=babelHelpers.classPrivateFieldLooseKey("mode");class M extends p{constructor(...e){super(...e);this.isReady=true;Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0})}createPopup(e){let s;babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;const i=document.querySelector("#left-menu-preset-popup").cloneNode(true);return n.PopupManager.create(this.constructor.name.toString(),null,{overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,content:i,events:{onFirstShow:()=>{[...i.querySelectorAll(".js-left-menu-preset-item")].forEach((e=>{e.addEventListener("click",(()=>{[...i.querySelectorAll(".js-left-menu-preset-item")].forEach((t=>{t.classList[t===e?"add":"remove"]("left-menu-popup-selected")}))}))}))}},buttons:[s=new t.CreateButton({text:c.Loc.getMessage("MENU_CONFIRM_BUTTON"),onclick:()=>{if(s.isWaiting()){return}s.setWaiting(true);const t=this.getSelectedPreset();if(!m.isAdmin&&m.availablePresetTools&&m.availablePresetTools[t]===false){s.setWaiting(false);this.showUnavailableToolPopup();return}a.EventEmitter.emit(this,m.eventName("onPresetIsSet"),{presetId:t,mode:e}).forEach((e=>{e.then((e=>{s.setWaiting(false);this.hide();if(e.data.hasOwnProperty("url")){document.location.href=e.data.url}else{document.location.reload()}})).catch(E.catchError)}))}}),new t.CancelButton({text:c.Loc.getMessage("MENU_DELAY_BUTTON"),onclick:()=>{a.EventEmitter.emit(this,m.eventName("onPresetIsPostponed"),{mode:e});this.hide()}})]})}getMode(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}getSelectedPreset(){let e="";if(document.forms["left-menu-preset-form"]){[...document.forms["left-menu-preset-form"].elements["presetType"]].forEach((t=>{if(t.checked){e=t.value}}))}return e}showUnavailableToolPopup(){if(!(babelHelpers.classPrivateFieldLooseBase(this,L)[L]instanceof o.MessageBox)){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=o.MessageBox.create({message:c.Loc.getMessage("MENU_UNAVAILABLE_TOOL_POPUP_DESCRIPTION"),buttons:o.MessageBoxButtons.OK})}babelHelpers.classPrivateFieldLooseBase(this,L)[L].show()}}var P=babelHelpers.classPrivateFieldLooseKey("getMenuItems");var I=babelHelpers.classPrivateFieldLooseKey("getMenuItem");class B extends p{constructor(...e){super(...e);Object.defineProperty(this,I,{value:T});Object.defineProperty(this,P,{value:S});this.menuId="leftMenuSettingsPopup"}createPopup(){const e=new n.Menu({bindElement:this.container,targetContainer:document.querySelector(".js-app__left-menu"),items:this.getItems(),angle:true,offsetTop:0,offsetLeft:50});return e.getPopupWindow()}getItems(){const e=a.EventEmitter.emit(this,m.eventName("onGettingSettingMenuItems"));return babelHelpers.classPrivateFieldLooseBase(this,P)[P]([...e][0])}}function S(e){if(c.Type.isArray(e)===false){return[]}return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,I)[I](e)))}function T(e){if(!c.Type.isPlainObject(e)){return null}const{text:t,html:s,onclick:i,className:n,items:a=[],delimiter:o=false}=e;return{html:s,text:s?undefined:t,items:babelHelpers.classPrivateFieldLooseBase(this,P)[P](a),delimiter:o,className:`menu-popup-no-icon ${n}`,onclick:(e,t)=>{var s,n;if(!c.Type.isArrayFilled(a)){t.getMenuWindow().close()}(s=t.getMenuWindow().getParentMenuItem())==null?void 0:(n=s.getMenuWindow())==null?void 0:n.close();if(i){i(e,t)}}}}class D{static toggleMenu(e){if(c.Loc.getMessage("USER_ID")<=0){return}const t=c.Loc.getMessage("SITE_DIR")||"/";const s=window.location.pathname.toString().startsWith(`${t}online/`)?"online":"";return c.ajax.runAction(`intranet.leftmenu.${e?"collapseMenu":"expandMenu"}`,{data:{context:s},analyticsLabel:{leftmenu:{action:e?"collapseMenu":"expandMenu"}}})}static saveSelfItemMenu(e){const t=e.id>0?"update":"add";return c.ajax.runAction(`intranet.leftmenu.${t}SelfItem`,{data:{itemData:e},analyticsLabel:{leftmenu:{action:"selfItemAddOrUpdate"}}})}static deleteSelfITem(e){return c.ajax.runAction("intranet.leftmenu.deleteSelfItem",{data:{menuItemId:e},analyticsLabel:{leftmenu:{action:"selfItemDelete"}}})}static addFavoritesItemMenu(e){return c.ajax.runAction("intranet.leftmenu.addStandartItem",{data:{itemData:e},analyticsLabel:{leftmenu:{action:"standardItemAdd"}}})}static deleteFavoritesItemMenu(e){return c.ajax.runAction("intranet.leftmenu.deleteStandartItem",{data:{itemData:e},analyticsLabel:{leftmenu:{action:"standardItemDelete"}}})}static updateFavoritesItemMenu(e){return c.ajax.runAction("intranet.leftmenu.updateStandartItem",{data:{itemText:e.text,itemId:e.id},analyticsLabel:{leftmenu:{action:"standardItemUpdate"}}})}static addAdminSharedItemMenu(e){return c.ajax.runAction("intranet.leftmenu.addItemToAll",{data:{itemInfo:e},analyticsLabel:{leftmenu:{action:"adminItemAdd"}}})}static deleteAdminSharedItemMenu(e){return c.ajax.runAction("intranet.leftmenu.deleteItemFromAll",{data:{menu_item_id:e},analyticsLabel:{leftmenu:{action:"adminItemDelete"}}})}static saveItemsSort(e,t,s){return c.ajax.runAction("intranet.leftmenu.saveItemsSort",{data:{items:e,firstItemLink:t,version:m.version},analyticsLabel:{leftmenu:s}})}static setFirstPage(e){return c.ajax.runAction("intranet.leftmenu.setFirstPage",{data:{firstPageUrl:e},analyticsLabel:{leftmenu:{action:"mainPageIsSet"}}})}static setDefaultPreset(){return c.ajax.runAction("intranet.leftmenu.setDefaultMenu",{data:{},analyticsLabel:{leftmenu:{action:"defaultMenuIsSet"}}})}static setCustomPreset(e,t,s,i){return c.ajax.runAction("intranet.leftmenu.saveCustomPreset",{data:{userApply:e===true?"newUser":"currentUser",itemsSort:t,customItems:s,firstItemLink:i,version:m.version},analyticsLabel:{leftmenu:{action:"customPresetIsSet"}}})}static deleteCustomItem(e){return c.ajax.runAction("intranet.leftmenu.deleteCustomItemFromAll",{data:{menu_item_id:e},analyticsLabel:{leftmenu:{action:"customItemDelete"}}})}static setSystemPreset(e,t){return c.ajax.runAction("intranet.leftmenu.setPreset",{data:{preset:t,mode:e==="global"?"global":"personal"},analyticsLabel:{leftmenu:{action:"systemPresetIsSet",presetId:t,mode:e,analyticsFirst:e==="global"?"y":"n"}}})}static postponeSystemPreset(e){return c.ajax.runAction("intranet.leftmenu.delaySetPreset",{data:{},analyticsLabel:{leftmenu:{action:"systemPresetIsPostponed",mode:e,analyticsFirst:e==="global"?"y":"n"}}})}static clearCache(){return c.ajax.runAction("intranet.leftmenu.clearCache",{data:{},analyticsLabel:{leftmenu:{action:"clearCache"}}})}static expandGroup(e){if(c.Loc.getMessage("USER_ID")<=0){return}return c.ajax.runAction("intranet.leftmenu.expandMenuGroup",{data:{id:e},analyticsLabel:{leftmenu:{action:"expandMenuGroup"}}})}static collapseGroup(e){if(c.Loc.getMessage("USER_ID")<=0){return}return c.ajax.runAction("intranet.leftmenu.collapseMenuGroup",{data:{id:e},analyticsLabel:{leftmenu:{action:"collapseMenuGroup"}}})}}let x=e=>e,A,w,F,k;class N{constructor(e,t){this.links=[];this.isDraggable=true;this.storage=[];this.parentContainer=e;this.container=t;this.init();this.onDeleteAsFavorites=this.onDeleteAsFavorites.bind(this);setTimeout((()=>{a.EventEmitter.subscribe(a.EventEmitter.GLOBAL_TARGET,m.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);a.EventEmitter.incrementMaxListeners(a.EventEmitter.GLOBAL_TARGET,m.eventName("onItemDeleteAsFavorites"));a.EventEmitter.subscribe(this,m.eventName("onItemDelete"),this.destroy.bind(this))}),0);this.showError=this.showError.bind(this);this.showMessage=this.showMessage.bind(this)}getId(){return this.container.dataset.id}getCode(){return this.constructor.code}getName(){return this.container.querySelector("[data-role='item-text']").textContent}canDelete(){return false}delete(){}init(){this.links=[];if(this.container.hasAttribute("data-link")&&c.Type.isStringFilled(this.container.getAttribute("data-link"))){this.links.push(this.container.getAttribute("data-link"))}if(this.container.hasAttribute("data-all-links")){this.container.getAttribute("data-all-links").split(",").forEach((e=>{e=String(e).trim();if(c.Type.isStringFilled(e)){this.links.push(e)}}))}this.makeTextIcons();this.storage=this.container.dataset.storage.split(",")}update({link:e,openInNewPage:t,text:s}){t=t==="Y"?"Y":"N";if(this.container.hasAttribute("data-link")){this.container.setAttribute("data-link",c.Text.encode(e));this.container.setAttribute("data-new-page",t)}const i=this.container.querySelector("a");if(i){if(c.Type.isString(e)){i.setAttribute("href",c.Text.encode(e))}i.setAttribute("target",t==="Y"?"_blank":"_self")}this.container.querySelector("[data-role='item-text']").innerHTML=c.Text.encode(s);this.init()}destroy(){a.EventEmitter.unsubscribe(a.EventEmitter.GLOBAL_TARGET,m.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);a.EventEmitter.decrementMaxListeners(a.EventEmitter.GLOBAL_TARGET,"onItemDeleteAsFavorites")}getSimilarToUrl(e){const t=[];this.links.forEach(((s,i)=>{if(_(s,e)){let e=0;if(i===0){e=this.getCode()==="default"?2:1}t.push({priority:e,url:s})}}));return t}makeTextIcons(){if(!this.container.classList.contains("menu-item-no-icon-state")){return}const e=this.container.querySelector(".menu-item-icon");const t=this.container.querySelector(".menu-item-link-text");if(e&&t){e.textContent=H(t.textContent)}}getCounterValue(){const e=i.Counter.initFromCounterNode(this.container.querySelector(`.${i.Counter.BaseClassname}`));if(!e){return null}return e.getRealValue()}updateCounter(e){const t=i.Counter.initFromCounterNode(this.container.querySelector(`.${i.Counter.BaseClassname}`));if(!t){return}const s=t.getRealValue()||0;t.update(parseInt(e,10));if(e>0){c.Dom.addClass(this.container,"menu-item-with-index")}else{c.Dom.removeClass(this.container,"menu-item-with-index")}return{oldValue:s,newValue:e}}markAsActive(){console.error("This action is only for the group")}showWarning(e,t){this.removeWarning();const s=this.container.querySelector("a.menu-item-link");if(!s){return}e=e?c.Text.encode(e):"";const i=c.Tag.render(A||(A=x`<a class="menu-post-warn-icon" title="${0}"></a>`),e);if(t){Object.keys(t).forEach((e=>{c.Event.bind(i,e,t[e])}))}this.container.classList.add("menu-item-warning-state");s.appendChild(i)}removeWarning(){if(!this.container.classList.contains("menu-item-warning-state")){return}this.container.classList.remove("menu-item-warning-state");let e;while(e=this.container.querySelector("a.menu-post-warn-icon")){e.parentNode.removeChild(e)}}showMessage(e){if(this.showMessagePopup){this.showMessagePopup.close()}this.showMessagePopup=n.PopupManager.create("left-menu-message",this.container,{content:'<div class="left-menu-message-popup">'+e+"</div>",darkMode:true,offsetTop:2,offsetLeft:0,angle:true,events:{onClose:()=>{this.showMessagePopup=null}},autoHide:true});this.showMessagePopup.show();setTimeout((()=>{if(this.showMessagePopup){this.showMessagePopup.close()}}),3e3)}showError(e){const t=[];if(e.errors){t.push(e.errors[0].message)}else if(e instanceof TypeError){t.push(e.message)}const s=[c.Loc.getMessage("MENU_ERROR_OCCURRED"),...t].join(" ");this.showMessage(s)}getDropDownActions(){return[]}getEditFields(){return{id:this.getId(),text:this.getName()}}onDeleteAsFavorites({data:e}){if(String(e.id)===String(this.getId())){if(this.getCode()==="standard"){a.EventEmitter.emit(this,m.eventName("onItemDelete"),{item:this,animate:true})}else{this.storage=[...this.storage].filter((e=>e!=="standard"));this.container.dataset.storage=this.storage.join(",")}a.EventEmitter.unsubscribe(a.EventEmitter.GLOBAL_TARGET,m.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);a.EventEmitter.decrementMaxListeners(a.EventEmitter.GLOBAL_TARGET,m.eventName("onItemDeleteAsFavorites"))}}static detect(e){return e.getAttribute("data-role")!=="group"&&e.getAttribute("data-type")===this.code}static createNode({id:e,text:t,link:s,openInNewPage:n,counterId:a,counterValue:o,topMenuId:r}){e=c.Text.encode(e);t=c.Text.encode(t);s=c.Text.encode(s);a=a?c.Text.encode(a):"";o=o?parseInt(o):0;n=n==="Y"?"Y":"N";const l=new i.Counter({size:i.Counter.Size.SMALL,style:i.Counter.Style.FILLED_ALERT,useAirDesign:true,value:o,id:`menu-counter-${a}`});return c.Tag.render(w||(w=x`<li 
			id="bx_left_menu_${0}" 
			data-status="show" 
			data-id="${0}" 
			data-role="item"
			data-storage="" 
			data-counter-id="${0}" 
			data-link="${0}" 
			data-all-links="" 
			data-type="${0}" 
			data-delete-perm="Y" 
			${0}
			data-new-page="${0}" 
			class="menu-item-block menu-item-no-icon-state">
				<span class="menu-favorites-btn menu-favorites-draggable">
					<span class="menu-fav-draggable-icon"></span>
				</span>
				<a class="menu-item-link" data-slider-ignore-autobinding="true" href="${0}" target="${0}">
					<span class="menu-item-icon-box">
						<span class="menu-item-icon">W</span>
					</span>
					<span class="menu-item-link-text " data-role="item-text">${0}</span>
					${0}
				</a>
				<span data-role="item-edit-control" class="menu-fav-editable-btn menu-favorites-btn">
					<span class="menu-favorites-btn-icon"></span>
				</span>
			</li>`),e,e,a,s,this.code,r?`data-top-menu-id="${c.Text.encode(r)}"`:"",n,s,n==="Y"?"_blank":"_self",t,a?`<span class="menu-item-index-wrap">\n\t\t\t\t\t\t${l.render()}\n\t\t\t\t\t</span>`:"")}static backendSaveItem(e){throw"Function backendSaveItem must be replaced"}static showUpdate(e){return new Promise(((t,s)=>{this.showForm(e.container,e.getEditFields(),t,s)}))}static checkForm(e){if(String(e.elements["text"].value).trim().length<=0){e.elements["text"].classList.add("menu-form-input-error");e.elements["text"].focus();return false}if(e.elements["link"]){if(String(e.elements["link"].value).trim().length<=0||E.refineUrl(e.elements["link"].value).length<=0){e.elements["link"].classList.add("menu-form-input-error");e.elements["link"].focus();return false}else{e.elements["link"].value=E.refineUrl(e.elements["link"].value)}}return true}static showForm(e,s,i,a){if(this.popup){this.popup.close()}const o=s.id!=="";const r=c.Tag.render(F||(F=x`
<form name="menuAddToFavoriteForm">
	<input type="hidden" name="id" value="${0}">
	<label for="menuPageToFavoriteName" class="menu-form-label">${0}</label>
	<input name="text" type="text" id="menuPageToFavoriteName" class="menu-form-input" value="${0}" >
	${0}
	${0}
</form>`),c.Text.encode(s.id||""),c.Loc.getMessage("MENU_ITEM_NAME"),c.Text.encode(s.text||""),s["link"]!==undefined?`<br><br>\n\t<label for="menuPageToFavoriteLink" class="menu-form-label">${c.Loc.getMessage("MENU_ITEM_LINK")}</label>\n\t<input name="link" id="menuPageToFavoriteLink" type="text" class="menu-form-input" value="${c.Text.encode(s.link)}" >`:"",s["openInNewPage"]!==undefined?`<br><br>\n\t<input name="openInNewPage" id="menuOpenInNewPage" type="checkbox" value="Y" ${s.openInNewPage==="Y"?"checked":""} >\n\t<label for="menuOpenInNewPage" class="menu-form-label">${c.Loc.getMessage("MENU_OPEN_IN_NEW_PAGE")}</label>`:"");Object.keys(s).forEach((e=>{if(["id","text","link","openInNewPage"].indexOf(e)<0){const t=c.Text.encode(e);const i=c.Text.encode(s[e]);r.appendChild(c.Tag.render(k||(k=x`<input type="hidden" name="${0}" value="${0}">`),t,i))}}));this.popup=n.PopupManager.create("menu-self-item-popup",e,{className:"menu-self-item-popup",titleBar:s["link"]===undefined?c.Loc.getMessage("MENU_RENAME_ITEM"):o?c.Loc.getMessage("MENU_EDIT_SELF_PAGE"):c.Loc.getMessage("MENU_ADD_SELF_PAGE"),offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,content:r,buttons:[new t.SaveButton({onclick:()=>{if(this.checkForm(r)){const e={};[...r.elements].forEach((t=>{e[t.name]=t.value}));if(r.elements["openInNewPage"]){e["openInNewPage"]=r.elements["openInNewPage"].checked?"Y":"N"}this.backendSaveItem(e).then((()=>{i(e);this.popup.close()})).catch(E.catchError)}}}),new t.CancelButton({onclick:()=>{this.popup.close()}})]});this.popup.show()}}N.code="abstract";function _(e,t){const s=new c.Uri(e);const i=s.getPath().replace("/index.php","").replace("/index.html","");const n=t.getPath().replace("/index.php","").replace("/index.html","");if(s.getHost()!==""&&s.getHost()!==t.getHost()){return false}if(n.indexOf(i)!==0){return false}return true}function H(e){if(!c.Type.isStringFilled(e)){return"..."}e=e.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(e.length<=0){return"..."}let t;let s=e.split(/[\s,]+/);if(s.length<=1){t=e.substring(0,1)}else if(s.length===2){t=s[0].substring(0,1)+s[1].substring(0,1)}else{let e=s[0];let i=s[1];for(let e=1;e<s.length;e++){if(s[e].length>3){i=s[e];break}}t=e.substring(0,1)+i.substring(0,1)}return t.toUpperCase()}var O=babelHelpers.classPrivateFieldLooseKey("currentPageInTopMenu");class U extends N{canDelete(){return true}delete(){D.deleteFavoritesItemMenu({id:this.getId(),storage:this.storage}).then((()=>{this.destroy();a.EventEmitter.emit(this,m.eventName("onItemDelete"),{animate:true});const e=this.getSimilarToUrl(E.getCurUri()).length>0?window:{doesnotmatter:""};BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[{id:this.getId()},this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false,context:e}])}))}getDropDownActions(){const e=[];e.push({text:c.Loc.getMessage("MENU_RENAME_ITEM"),onclick:()=>{this.constructor.showUpdate(this).then(this.update.bind(this)).catch(this.showError)}});e.push({text:c.Loc.getMessage("MENU_REMOVE_STANDARD_ITEM"),onclick:()=>{this.delete()}});if(m.isAdmin){e.push({text:c.Loc.getMessage("MENU_ADD_ITEM_TO_ALL"),onclick:()=>{const e=this.container.querySelector("a");D.addAdminSharedItemMenu({id:this.getId(),link:this.links[0],text:this.getName(),counterId:this.container.dataset.counterId,openInNewPage:e&&e.getAttribute("target")==="_blank"?"Y":"N"}).then((()=>{this.showMessage(c.Loc.getMessage("MENU_ITEM_WAS_ADDED_TO_ALL"));this.container.dataset.type=R.code;this.storage.push(U.code);this.container.dataset.storage=this.storage.join(",");a.EventEmitter.emit(this,m.eventName("onItemConvert"),this)})).catch(this.showError)}})}return e}static backendSaveItem(e){return D.updateFavoritesItemMenu(e)}static getActiveTopMenuItem(){if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]){return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}if(!BX.Main||!BX.Main.interfaceButtonsManager){return null}const e=Array.from(Object.values(BX.Main.interfaceButtonsManager.getObjects())).shift();if(e){const t=e.getActive();if(t&&typeof t==="object"){const e=document.createElement("a");e.href=t["URL"];const s=e.pathname[0]!=="/"?"/"+e.pathname:e.pathname;babelHelpers.classPrivateFieldLooseBase(this,O)[O]={ID:t["ID"]||null,NODE:t["NODE"]||null,URL:s+e.search,TEXT:t["TEXT"],DATA_ID:t["DATA_ID"],COUNTER_ID:t["COUNTER_ID"],COUNTER:t["COUNTER"],SUB_LINK:t["SUB_LINK"]}}}return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}static isCurrentPageStandard(e){if(e&&e["URL"]){const t=document.location.pathname+document.location.search;return e.URL===t&&e.URL.indexOf("workgroups")<0}return false}static saveCurrentPage({pageTitle:e,pageLink:t}){const s=this.getActiveTopMenuItem();let i,n,a;if(s&&s.NODE&&this.isCurrentPageStandard(s)&&(t===E.getCurPage()||t===s.URL||!t)){const t=s.NODE.getBoundingClientRect();n=t.left;a=t.top;i={id:s.DATA_ID,text:e||s.TEXT,link:E.getCurPage()||s.URL,counterId:s.COUNTER_ID,counterValue:s.COUNTER,isStandardItem:true,subLink:s.SUB_LINK}}else{i={text:e||document.getElementById("pagetitle").innerText,link:t||E.getCurPage(),isStandardItem:t===E.getCurPage()};const s=BX("pagetitle").getBoundingClientRect();n=s.left;a=s.top}return D.addFavoritesItemMenu(i).then((({data:{itemId:e}})=>{i.id=e;i.topMenuId=i.id;return{node:this.createNode(i),animateFromPoint:{startX:n,startY:a},itemInfo:i}}))}static deleteCurrentPage({pageLink:e}){const t=this.getActiveTopMenuItem();var s={},i,n;if(t&&this.isCurrentPageStandard(t)){s["id"]=t.DATA_ID;const e=t.NODE.getBoundingClientRect();i=e.left;n=e.top}else{s["link"]=e||E.getCurPage();const t=BX("pagetitle").getBoundingClientRect();i=t.left;n=t.top}return D.deleteFavoritesItemMenu(s).then((({data:e})=>{if(!s.id&&e&&e["itemId"]){s.id=e["itemId"]}a.EventEmitter.emit(a.EventEmitter.GLOBAL_TARGET,m.eventName("onItemDeleteAsFavorites"),{id:s.id});return{itemInfo:s,animateToPoint:{startX:i,startY:n}}}))}static saveStandardPage({DATA_ID:e,TEXT:t,SUB_LINK:s,COUNTER_ID:i,COUNTER:n,NODE:a,URL:o}){const r={id:e,text:t,link:o,subLink:s,counterId:i,counterValue:n};const l=a.getBoundingClientRect();const c=l.left;const d=l.top;return D.addFavoritesItemMenu(r).then((({data:{itemId:t}})=>{r.id=t;r.topMenuId=r.id;const s=this.getActiveTopMenuItem();BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[r,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:true,context:s&&s.DATA_ID===e?window:null}]);return{node:this.createNode(r),animateFromPoint:{startX:c,startY:d}}}))}static deleteStandardPage({DATA_ID:e}){const t={id:e};return D.deleteFavoritesItemMenu(t).then((()=>{a.EventEmitter.emit(a.EventEmitter.GLOBAL_TARGET,m.eventName("onItemDeleteAsFavorites"),{id:t.id});BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[t,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false}]);return{itemInfo:t}}))}}U.code="standard";Object.defineProperty(U,O,{writable:true,value:null});class X extends N{canDelete(){return true}delete(){return D.deleteSelfITem(this.getId()).then((()=>{if(this.storage.indexOf(U.code)>=0){D.deleteFavoritesItemMenu({id:this.getId()})}a.EventEmitter.emit(this,m.eventName("onItemDelete"),{animate:true})})).catch(this.showError)}getDropDownActions(){const e=[];e.push({text:c.Loc.getMessage("MENU_EDIT_ITEM"),onclick:()=>{this.constructor.showUpdate(this).then(this.update.bind(this)).catch(this.showError)}});e.push({text:c.Loc.getMessage("MENU_DELETE_SELF_ITEM"),onclick:()=>{o.MessageBox.confirm(c.Loc.getMessage("MENU_DELETE_SELF_ITEM_CONFIRM"),c.Loc.getMessage("MENU_DELETE_SELF_ITEM"),(e=>{this.delete();e.close()}),c.Loc.getMessage("MENU_DELETE"))}});if(m.isAdmin){e.push({text:c.Loc.getMessage("MENU_ADD_ITEM_TO_ALL"),onclick:()=>{const e=this.container.querySelector("a");D.addAdminSharedItemMenu({id:this.getId(),link:this.links[0],text:this.getName(),counterId:this.container.dataset.counterId,openInNewPage:e&&e.getAttribute("target")==="_blank"?"Y":"N"}).then((()=>{this.showMessage(c.Loc.getMessage("MENU_ITEM_WAS_ADDED_TO_ALL"));this.container.dataset.type=R.code;this.storage.push(X.code);this.container.dataset.storage=this.storage.join(",");a.EventEmitter.emit(this,m.eventName("onItemConvert"),this)})).catch(this.showError)}})}return e}getEditFields(){return{id:this.getId(),text:this.getName(),link:this.links[0],openInNewPage:this.container.getAttribute("data-new-page")}}static backendSaveItem(e){return D.saveSelfItemMenu(e).then((({data:t})=>{if(t&&t["itemId"]){e.id=t["itemId"]}return e}))}static showAdd(e){return new Promise(((t,s)=>{this.showForm(e,{id:0,name:"",link:"",openInNewPage:"Y"},t,s)})).then((e=>({node:this.createNode(e)})))}}X.code="self";class R extends N{canDelete(){return this.container.dataset.deletePerm==="Y"}delete(){D.deleteAdminSharedItemMenu(this.getId()).then((()=>{if(this.storage.indexOf(U.code)>=0){D.deleteFavoritesItemMenu({id:this.getId()})}if(this.storage.indexOf(X.code)>=0){D.deleteSelfITem(this.getId())}a.EventEmitter.emit(this,m.eventName("onItemDelete"),{animate:true})})).catch(this.showError)}getDropDownActions(){if(!this.canDelete()){return[]}const e=[];if(this.storage.filter((e=>e===U.code||e===X.code)).length>0){e.push({text:c.Loc.getMessage("MENU_REMOVE_STANDARD_ITEM"),onclick:this.delete.bind(this)});e.push({text:c.Loc.getMessage("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),onclick:()=>{D.deleteAdminSharedItemMenu(this.getId()).then((()=>{this.showMessage(c.Loc.getMessage("MENU_ITEM_WAS_DELETED_FROM_ALL"));const e=this.storage.indexOf(X.code)>=0?X.code:U.code;this.container.dataset.type=e;this.container.dataset.storage=this.storage.filter((t=>t!==e)).join(",");a.EventEmitter.emit(this,m.eventName("onItemConvert"),this)})).catch(this.showError)}})}else{e.push({text:c.Loc.getMessage("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),onclick:this.delete.bind(this)})}return e}}R.code="admin";class q extends N{canDelete(){return this.container.dataset.deletePerm==="Y"}delete(){if(this.canDelete()){D.deleteCustomItem(this.getId()).then((()=>{if(this.storage.indexOf(U.code)>=0){D.deleteFavoritesItemMenu({id:this.getId()})}a.EventEmitter.emit(this,m.eventName("onItemDelete"),{animate:true})})).catch(this.showError)}}getDropDownActions(){const e=[];if(this.canDelete()){e.push({text:c.Loc.getMessage("MENU_DELETE_ITEM_FROM_ALL"),onclick:this.delete.bind(this)})}return e}}q.code="custom";class j extends N{canDelete(){return false}openSettings(){const e=`${c.Loc.getMessage("mainpage_settings_path")}&analyticContext=left_menu`;BX.SidePanel.Instance.open(e)}}j.code="main";class $ extends N{canDelete(){return false}}$.code="default";var G=babelHelpers.classPrivateFieldLooseKey("collapsingAnimation");class K extends N{constructor(){super(...arguments);Object.defineProperty(this,G,{writable:true,value:void 0});this.container.addEventListener("click",this.toggleAndSave.bind(this),true);this.container.addEventListener("mouseleave",(()=>{c.Dom.removeClass(this.container,"menu-item-group-actioned")}));this.groupContainer=this.container.parentNode.querySelector(`[data-group-id="${this.getId()}"]`);if(this.container.getAttribute("data-collapse-mode")==="collapsed"){this.groupContainer.style.display="none"}setTimeout((()=>{this.updateCounter()}),0)}toggleAndSave(e){e.preventDefault();e.stopPropagation();if(this.container.getAttribute("data-collapse-mode")==="collapsed"){D.expandGroup(this.getId());this.expand().then((()=>{this.container.setAttribute("data-collapse-mode","expanded")}))}else{D.collapseGroup(this.getId());this.collapse().then((()=>{this.container.setAttribute("data-collapse-mode","collapsed")}))}return false}checkAndCorrect(){const e=this.groupContainer;if(e.parentNode===this.container){c.Dom.insertAfter(e,this.container)}[...e.querySelectorAll(`.menu-item-block`)].forEach((e=>{e.setAttribute("data-status",this.container.getAttribute("data-status"))}));return this}collapse(e){return new Promise((t=>{const s=this.groupContainer;if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){babelHelpers.classPrivateFieldLooseBase(this,G)[G].stop()}s.style.overflow="hidden";c.Dom.addClass(this.container,"menu-item-group-collapsing");c.Dom.addClass(this.container,"menu-item-group-actioned");c.Dom.addClass(s,"menu-item-group-collapsing");const i={height:s.offsetHeight,display:s.style.display};babelHelpers.classPrivateFieldLooseBase(this,G)[G]=new BX.easing({duration:500,start:{height:i.height,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.height=e.height+"px";s.style.opacity=e.opacity/100},complete:()=>{s.style.display="none";s.style.opacity="auto";s.style.height="auto";c.Dom.style(s,"overflow",null);if(this.container.getAttribute("data-contains-active-item")==="Y"){c.Dom.addClass(this.container,"menu-item-active")}c.Dom.removeClass(this.container,"menu-item-group-collapsing");c.Dom.removeClass(s,"menu-item-group-collapsing");babelHelpers.classPrivateFieldLooseBase(this,G)[G]=null;if(e===true){this.container.appendChild(s)}t()}});babelHelpers.classPrivateFieldLooseBase(this,G)[G].animate()}))}expand(e){return new Promise((t=>{const s=this.container;const i=this.groupContainer;if(e===true&&s.getAttribute("data-collapse-mode")==="collapsed"){return t()}const n=i.querySelectorAll("li").length*(s.offsetHeight+4);c.Dom.addClass(s,"menu-item-group-expanding");c.Dom.addClass(s,"menu-item-group-actioned");c.Dom.addClass(i,"menu-item-group-expanding");if(i.parentNode===this.container){c.Dom.insertAfter(i,this.container)}i.style.display="block";babelHelpers.classPrivateFieldLooseBase(this,G)[G]=new BX.easing({duration:500,start:{height:0,opacity:0},finish:{height:n,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.height=e.height+"px";i.style.opacity=e.opacity/100},complete:function(){c.Dom.removeClass(s,"menu-item-group-expanding menu-item-active");c.Dom.removeClass(i,"menu-item-group-expanding");i.style.height="auto";i.style.opacity="auto";t()}});babelHelpers.classPrivateFieldLooseBase(this,G)[G].animate()}))}canDelete(){return false}updateCounter(){let e=0;[...this.container.parentNode.querySelector(`[data-group-id="${this.getId()}"]`).querySelectorAll(`.${i.Counter.BaseClassname}`)].forEach((t=>{const s=i.Counter.initFromCounterNode(t);e+=s.getRealValue()}));i.Counter.updateCounterNodeValue(this.container.querySelector(`.${i.Counter.BaseClassname}`),e);if(e>0){c.Dom.addClass(this.container,"menu-item-with-index")}else{c.Dom.removeClass(this.container,"menu-item-with-index")}}markAsActive(){this.container.setAttribute("data-contains-active-item","Y");if(this.container.getAttribute("data-collapse-mode")==="collapsed")c.Dom.addClass(this.container,"menu-item-active")}markAsInactive(){this.container.removeAttribute("data-contains-active-item");c.Dom.removeClass(this.container,"menu-item-active")}isActive(){return this.container.getAttribute("data-contains-active-item")==="Y"}static detect(e){return e.getAttribute("data-role")==="group"&&e.getAttribute("data-type")===this.code}}K.code="group";class V extends K{constructor(){super(...arguments);this.container.querySelector('[data-role="item-edit-control"]').style.display="none"}}V.code="system_group";const W=[N,R,U,q,X,$,K,V,j];function Y(e){let t=N;W.forEach((s=>{if(s.detect(e)){t=s}}));return t}var z=babelHelpers.classPrivateFieldLooseKey("link");var Q=babelHelpers.classPrivateFieldLooseKey("actualLink");class J{constructor(){Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=new c.Uri(window.location.href)}checkAndSet(e,t){if(e===this.item){return false}let s=babelHelpers.classPrivateFieldLooseBase(this,z)[z];t.forEach((e=>{const t=new c.Uri(e.url);let i=false;if(!s||s.uri.getPath().length<t.getPath().length){i=true}else if(s.uri.getPath().length===t.getPath().length){const n=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getQueryParams();const a={params:s.uri.getQueryParams(),matches:0};const o={params:t.getQueryParams(),matches:0};for(const e of Object.keys(n)){if(e in n&&e in a.params&&String(n[e])===String(a.params[e])){a.matches++}if(e in n&&e in o.params&&String(n[e])===String(o.params[e])){o.matches++}}if(o.matches>a.matches||o.matches===a.matches&&Object.keys(o.params).length<Object.keys(a.params).length||s.priority<e.priority){i=true}}if(i){s={priority:e.priority,url:e.url,uri:t}}}));if(s!==babelHelpers.classPrivateFieldLooseBase(this,z)[z]){if(this.item){this.unhighlight(this.item)}babelHelpers.classPrivateFieldLooseBase(this,z)[z]=s;this.item=e;this.highlight();return true}return false}checkAndUnset(e){if(e instanceof N&&e===this.item){this.unhighlight(this.item);this.item=null;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=null}}highlight(){if(this.item){this.item.container.classList.add("menu-item-active");let e=this.item.container.closest('[data-role="group-content"]');let t;while(e){t=e.parentNode.querySelector(`[data-id="${e.getAttribute("data-group-id")}"]`);if(t){t.setAttribute("data-contains-active-item","Y");if(t.getAttribute("data-collapse-mode")==="collapsed"){t.classList.add("menu-item-active")}}e=e.closest('[data-relo="group-content"]')}}}unhighlight(e){if(!(e instanceof N)){e=this.item}if(e instanceof N){e.container.classList.remove("menu-item-active");let t=e.container.closest('[data-role="group-content"]');let s;while(t){s=t.parentNode.querySelector(`[data-id="${t.getAttribute("data-group-id")}"]`);if(s){s.removeAttribute("data-contains-active-item");s.classList.remove("menu-item-active")}t=t.closest('[data-relo="group-content"]')}return e}return null}}var Z=babelHelpers.classPrivateFieldLooseKey("activeItem");var ee=babelHelpers.classPrivateFieldLooseKey("isEditMode");var te=babelHelpers.classPrivateFieldLooseKey("showHiddenContainer");var se=babelHelpers.classPrivateFieldLooseKey("hideHiddenContainer");var ie=babelHelpers.classPrivateFieldLooseKey("animation");var ne=babelHelpers.classPrivateFieldLooseKey("recalculateCounters");var ae=babelHelpers.classPrivateFieldLooseKey("refreshActivity");var oe=babelHelpers.classPrivateFieldLooseKey("updateCountersLastValue");var re=babelHelpers.classPrivateFieldLooseKey("getItemsByCounterId");var le=babelHelpers.classPrivateFieldLooseKey("getItemsToSave");var ce=babelHelpers.classPrivateFieldLooseKey("saveItemsSort");var de=babelHelpers.classPrivateFieldLooseKey("getParentItemFor");var ue=babelHelpers.classPrivateFieldLooseKey("canChangePaternity");var me=babelHelpers.classPrivateFieldLooseKey("openItemMenuPopup");var he=babelHelpers.classPrivateFieldLooseKey("animateTopItemToLeft");var pe=babelHelpers.classPrivateFieldLooseKey("animateTopItemFromLeft");var ge=babelHelpers.classPrivateFieldLooseKey("registerDND");var fe=babelHelpers.classPrivateFieldLooseKey("menuItemDragStart");var be=babelHelpers.classPrivateFieldLooseKey("menuItemDragMove");var ve=babelHelpers.classPrivateFieldLooseKey("menuItemDragHover");var ye=babelHelpers.classPrivateFieldLooseKey("menuItemDragStop");class Ee extends p{constructor(e,{events:t}){super(e,{events:t});Object.defineProperty(this,ye,{value:He});Object.defineProperty(this,ve,{value:_e});Object.defineProperty(this,be,{value:Ne});Object.defineProperty(this,fe,{value:ke});Object.defineProperty(this,ge,{value:Fe});Object.defineProperty(this,pe,{value:we});Object.defineProperty(this,he,{value:Ae});Object.defineProperty(this,ue,{value:xe});Object.defineProperty(this,de,{value:De});Object.defineProperty(this,ce,{value:Te});Object.defineProperty(this,le,{value:Se});Object.defineProperty(this,re,{value:Be});Object.defineProperty(this,ae,{value:Ie});Object.defineProperty(this,ne,{value:Pe});Object.defineProperty(this,ie,{value:Me});Object.defineProperty(this,se,{value:Ce});Object.defineProperty(this,te,{value:Le});this.items=new Map;Object.defineProperty(this,Z,{writable:true,value:new J});Object.defineProperty(this,ee,{writable:true,value:false});Object.defineProperty(this,oe,{writable:true,value:null});Object.defineProperty(this,me,{writable:true,value:void 0});this.parentContainer=e;this.container=e.querySelector(".menu-items");this.hiddenContainer=e.querySelector("#left-menu-hidden-items-block");e.querySelectorAll("li.menu-item-block").forEach(this.registerItem.bind(this));e.querySelector("#left-menu-hidden-separator").addEventListener("click",this.toggleHiddenContainer.bind(this));if(this.getActiveItem()&&this.getActiveItem().container.getAttribute("data-status")==="hide"){babelHelpers.classPrivateFieldLooseBase(this,te)[te](false)}}registerItem(e){var t;const s=Y(e);const i=new s(this.container,e);this.items.set(i.getId(),i);if(!(i instanceof j)){babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](i)}if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].checkAndSet(i,i.getSimilarToUrl(E.getCurUri()))===true){let e=babelHelpers.classPrivateFieldLooseBase(this,de)[de](i);while(e){e.markAsActive();e=babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)}}a.EventEmitter.subscribe(i,m.eventName("onItemDelete"),(({data:e})=>{this.deleteItem(i,e)}));a.EventEmitter.subscribe(i,m.eventName("onItemConvert"),(({data:e})=>{this.convertItem(i,e)}));[...i.container.querySelectorAll("a")].forEach((e=>{e.addEventListener("click",(e=>{if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]===true){e.preventDefault();e.stopPropagation();return false}}),true)}));(t=i.container.querySelector('[data-role="item-edit-control"]'))==null?void 0:t.addEventListener("click",(e=>{this.openItemMenu(i,e.target,e.currentTarget)}));return i}unregisterItem(e){if(!this.items.has(e.getId())){return}this.items.delete(e.getId());babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].checkAndUnset(e,e.getSimilarToUrl(E.getCurUri()));a.EventEmitter.unsubscribeAll(e,m.eventName("onItemDelete"));a.EventEmitter.unsubscribeAll(e,m.eventName("onItemConvert"));e.container.parentNode.replaceChild(e.container.cloneNode(true),e.container)}get isEditMode(){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]}switchToEditMode(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return}babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=true;a.EventEmitter.emit(this,m.eventName("EditMode"))}switchToViewMode(){if(!babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return}babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=false;a.EventEmitter.emit(this,m.eventName("ViewMode"))}isHiddenContainerVisible(){return this.hiddenContainer.classList.contains("menu-item-favorites-more-open")}toggleHiddenContainer(e){if(this.hiddenContainer.classList.contains("menu-item-favorites-more-open")){babelHelpers.classPrivateFieldLooseBase(this,se)[se](e)}else{babelHelpers.classPrivateFieldLooseBase(this,te)[te](e)}}setItemAsAMainPage(e){const t=e.container;t.setAttribute("data-status","show");const s=t.offsetTop;const i=c.Dom.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:s}});const n=t.nextElementSibling;if(n){t.parentNode.insertBefore(i,n)}else{t.parentNode.appendChild(i)}i.appendChild(t);c.Dom.addClass(t,"menu-item-draggable");new BX.easing({duration:500,start:{top:s},finish:{top:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.top=e.top+"px"},complete:()=>{this.container.insertBefore(t,BX("left-menu-empty-item").nextSibling);c.Dom.removeClass(t,"menu-item-draggable");c.Dom.remove(i);babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]({action:"mainPageIsSet",itemId:e.getId()})}}).animate()}showItem(e){const t=babelHelpers.classPrivateFieldLooseBase(this,de)[de](e);const s=this.container;e.container.setAttribute("data-status","show");if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](e)){s.appendChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e,t)}else if(t){s.appendChild(t.container);t.container.setAttribute("data-status","show");s.appendChild(t.groupContainer)}if(this.hiddenContainer.querySelector(".menu-item-block")===null){a.EventEmitter.emit(this,m.eventName("onHiddenBlockIsEmpty"));babelHelpers.classPrivateFieldLooseBase(this,se)[se](false)}babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e);babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]({action:"showItem",itemId:e.getId()})}hideItem(e){const t=babelHelpers.classPrivateFieldLooseBase(this,de)[de](e);const s=this.hiddenContainer.querySelector("#left-menu-hidden-items-list");const i=s.querySelector(".menu-item-block")===null;e.container.setAttribute("data-status","hide");if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](e)){s.appendChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e,t)}else if(t){s.appendChild(t.container);t.container.setAttribute("data-status","hide");s.appendChild(t.groupContainer)}if(i){a.EventEmitter.emit(this,m.eventName("onHiddenBlockIsNotEmpty"))}babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e);babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]({action:"hideItem",itemId:e.getId()})}updateCounters(e,t){const s={};t=t!==false;[...Object.entries(e)].forEach((([e,i])=>{[...babelHelpers.classPrivateFieldLooseBase(this,re)[re](e)].forEach((t=>{const{oldValue:n,newValue:a}=t.updateCounter(i);const o=t.container.getAttribute("data-status");if((e.indexOf("crm_")<0||e.indexOf("crm_all")>=0)&&(e.indexOf("tasks_")<0||e.indexOf("tasks_total")>=0)){s[o]=s[o]||0;s[o]+=a-n}let r=babelHelpers.classPrivateFieldLooseBase(this,de)[de](t);while(r){r.updateCounter();r=babelHelpers.classPrivateFieldLooseBase(this,de)[de](r)}}));if(t){BX.localStorage.set("lmc-"+e,i,5)}}));if(s["hide"]!==undefined&&s["hide"]!==0){const e=this.parentContainer.querySelector("#menu-hidden-counter");e.dataset.counterValue=Math.max(0,Number(e.dataset.counterValue)+Number(s["hide"]));if(e.dataset.counterValue>0){e.classList.remove("menu-hidden-counter");e.innerHTML=e.dataset.counterValue>99?"99+":e.dataset.counterValue}else{e.classList.add("menu-hidden-counter");e.innerHTML=""}}if(typeof BXIM!=="undefined"){if(babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]===null){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=0;[...this.items.entries()].forEach((([e,t])=>{if(t instanceof K){return}const s=t.getCounterValue();if(s>0){let n="doesNotMatter";if(e.indexOf("menu_crm")>=0||e.indexOf("menu_tasks")>=0){const e=t.container.querySelector(`.${i.Counter.BaseClassname}`);if(e){n=e.id}}if(n==="doesNotMatter"||n.indexOf("crm_all")>=0||n.indexOf("tasks_total")>=0){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]+=s}}}))}else{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]+=s["show"]!==undefined?s["show"]:0;babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]+=s["hide"]!==undefined?s["hide"]:0}const e=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]>99?"99+":babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]<0?"0":babelHelpers.classPrivateFieldLooseBase(this,oe)[oe];const t=c.Reflection.getClass("BX.Messenger.v2.Lib.DesktopApi");if(t&&t.isDesktop()){t.setBrowserIconBadge(e)}}[...this.items.entries()].forEach((([e,t])=>{if(t instanceof K){t.updateCounter()}}))}decrementCounter(e){[...Object.entries(e)].forEach((([t,s])=>{const i=babelHelpers.classPrivateFieldLooseBase(this,re)[re](t).shift();if(i){const n=i.getCounterValue();e[t]=n>s?n-s:0}else{delete e[t]}}));this.updateCounters(e,false)}addItem({node:e,animateFromPoint:t}){if(!(e instanceof Element)){return}const s=e.style.display;if(t){e.dataset.styleDisplay=e.style.display;e.style.display="none"}if(this.items.has(e.dataset.id)&&e.dataset.type===U.code){const t=this.items.get(e.dataset.id);t.storage.push(U.code);t.container.dataset.storage=t.storage.join(",");e=t.container}else{this.container.appendChild(e);this.registerItem(e);babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()}if(t){babelHelpers.classPrivateFieldLooseBase(this,he)[he](e,t).then((()=>{e.style.display=e.dataset.styleDisplay}))}}updateItem(e){let{id:t}=e;if(this.items.has(t)){this.items.get(t).update(e)}}deleteItem(e,{animate:t}){this.items.delete(e.getId());babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].checkAndUnset(e);if(e instanceof U||t){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](e.container).then((()=>{e.container.parentNode.removeChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()}))}else if(e.container){e.container.parentNode.removeChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()}}convertItem(e){this.unregisterItem(e);this.registerItem(this.parentContainer.querySelector(`li.menu-item-block[data-id="${e.getId()}"]`))}getActiveItem(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].item}export(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}openItemMenu(e,t,s){if(s){c.Dom.addClass(s,"--open")}else{c.Dom.addClass(t,"--open")}if(babelHelpers.classPrivateFieldLooseBase(this,me)[me]){babelHelpers.classPrivateFieldLooseBase(this,me)[me].close()}const i=[];if(e instanceof j){i.push({text:c.Loc.getMessage("MENU_OPEN_SETTINGS_MAIN_PAGE"),onclick:()=>{e.openSettings()}})}else if(e.container.getAttribute("data-status")==="show"){i.push({text:c.Loc.getMessage("hide_item"),onclick:()=>{this.hideItem(e)}})}else{i.push({text:c.Loc.getMessage("show_item"),onclick:(t,s)=>{this.showItem(e)}})}if(!m.isExtranet&&!m.isMainPageEnabled&&!(e instanceof X)&&!(e instanceof K)&&this.container.querySelector('li.menu-item-block[data-role="item"]')!==e.container){i.push({text:c.Loc.getMessage("MENU_SET_MAIN_PAGE"),onclick:()=>{this.setItemAsAMainPage(e)}})}e.getDropDownActions().forEach((e=>{i.push(e)}));if(!(e instanceof j)){i.push({text:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]?c.Loc.getMessage("MENU_EDIT_READY_FULL"):c.Loc.getMessage("MENU_SETTINGS_MODE"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]?this.switchToViewMode():this.switchToEditMode()}})}i.forEach((e=>{var t;e["className"]=["menu-popup-no-icon",(t=e["className"])!=null?t:""].join(" ");const{onclick:s}=e;e["onclick"]=(e,t)=>{t.getMenuWindow().close();s.call(e,t)}}));const o=c.Dom.getPosition(t);babelHelpers.classPrivateFieldLooseBase(this,me)[me]=new n.Menu({bindElement:{top:o.top-o.height,left:o.right},items:i,offsetTop:0,offsetLeft:c.Dom.getPosition(t).width/2,events:{onClose:()=>{a.EventEmitter.emit(this,m.eventName("onClose"));e.container.classList.remove("menu-item-block-hover");babelHelpers.classPrivateFieldLooseBase(this,me)[me]=null;if(s){c.Dom.removeClass(s,"--open")}else{c.Dom.removeClass(t,"--open")}},onShow:()=>{e.container.classList.add("menu-item-block-hover");a.EventEmitter.emit(this,m.eventName("onShow"))}}});babelHelpers.classPrivateFieldLooseBase(this,me)[me].show()}}function Le(e){a.EventEmitter.emit(this,m.eventName("onHiddenBlockIsVisible"));if(e===false){return this.hiddenContainer.classList.add("menu-item-favorites-more-open")}this.hiddenContainer.style.height="0px";this.hiddenContainer.style.opacity=0;babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](true,this.hiddenContainer,this.hiddenContainer.scrollHeight)}function Ce(e){a.EventEmitter.emit(this,m.eventName("onHiddenBlockIsHidden"));if(e===false){return this.hiddenContainer.classList.remove("menu-item-favorites-more-open")}babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](false,this.hiddenContainer,this.hiddenContainer.offsetHeight)}function Me(e,t,s){t.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:s},finish:{opacity:e?100:0,height:e?s:0},transition:BX.easing.transitions.linear,step:function(e){t.style.opacity=e.opacity/100;t.style.height=e.height+"px"},complete:function(){if(e){t.classList.add("menu-item-favorites-more-open")}else{t.classList.remove("menu-item-favorites-more-open")}t.style.opacity="";t.style.overflow="";t.style.height=""}}).animate()}function Pe(e){let t=0;const s=i.Counter.initFromCounterNode(e.container.querySelector(`.${i.Counter.BaseClassname}`));if(s){t=s.getRealValue()}if(t<=0){return}[...this.items.entries()].forEach((([e,t])=>{if(t instanceof K){t.updateCounter()}}));let n=0;[...this.parentContainer.querySelectorAll(`.menu-item-block[data-status="hide"][data-role='item']`)].forEach((e=>{const t=i.Counter.initFromCounterNode(e.querySelector(`.${i.Counter.BaseClassname}`));if(t){n+=t.getRealValue()}}));i.Counter.updateCounterNodeValue(i.Counter.initFromCounterNode(this.parentContainer.querySelector("#menu-hidden-counter")),n)}function Ie(e,t){if(this.getActiveItem()!==e){return}const s=babelHelpers.classPrivateFieldLooseBase(this,de)[de](e);if(t!==s){if(t instanceof K){t.markAsInactive()}if(s instanceof K){s.markAsActive()}}}function Be(e){const t=[];[...this.items.values()].forEach((s=>{const n=i.Counter.initFromCounterNode(s.container.querySelector(`.${i.Counter.BaseClassname}`));if(n&&n.getId().includes(e)){t.push(s)}}));return t}function Se(){const e={show:[],hide:[]};const t=[];let s=null;["show","hide"].forEach((i=>{let n=e[i];let a=null;const o=[];Array.from(this.parentContainer.querySelectorAll(`.menu-item-block[data-status="${i}"]`)).forEach((r=>{if(r.dataset.role==="group"){const t=r.parentNode.hasAttribute("data-group-id")?r.parentNode.getAttribute("data-group-id"):null;n=e[i];let s;while(s=o.pop()){if(s["group_id"]===t){o.push(s);n=s.items;break}}const l={group_id:r.dataset.id,items:[]};n.push(l);o.push(l);n=l.items;a=r.dataset.id}else{if([q.code,X.code,U.code].indexOf(r.getAttribute("data-type"))>=0){const e={ID:r.getAttribute("data-id"),LINK:r.getAttribute("data-link"),TEXT:c.Text.decode(r.querySelector("[data-role='item-text']").innerHTML)};if(r.getAttribute("data-new-page")==="Y"){e.NEW_PAGE="Y"}t.push(e)}if(s===null&&c.Type.isStringFilled(r.getAttribute("data-link"))){s=r.getAttribute("data-link")}if(r.closest(`[data-group-id="${a}"][data-role="group-content"]`)){n.push(r.dataset.id)}else{const t=r.parentNode.hasAttribute("data-group-id")?r.parentNode.getAttribute("data-group-id"):null;n=e[i];let s;while(s=o.pop()){if(s["group_id"]===t){o.push(s);n=s.items;break}}n.push(r.dataset.id)}}}))}));return{saveSortItems:e,firstItemLink:s,customItems:t}}function Te(e){const{saveSortItems:t,firstItemLink:s}=babelHelpers.classPrivateFieldLooseBase(this,le)[le]();D.saveItemsSort(t,s,e||{action:"sortItem"})}function De(e){if(!(e instanceof N)){return null}const t=e.container.closest('[data-role="group-content"]');if(t&&this.items.has(t.getAttribute("data-group-id"))){return this.items.get(t.getAttribute("data-group-id"))}return null}function xe(e){if(e instanceof K){return false}const t=babelHelpers.classPrivateFieldLooseBase(this,de)[de](e);if(t instanceof K&&e.container.parentNode.querySelectorAll("li.menu-item-block").length<=1){return false}return true}function Ae(e,t){return new Promise((s=>{let{startX:i,startY:n}=t;const a=document.createElement("DIV");a.style=`position: absolute; z-index: 1000; top: ${n+25}px;`;const o=e.cloneNode(true);o.style.display=e.dataset.styleDisplay;document.body.appendChild(a);a.appendChild(o);let r=this.hiddenContainer.getBoundingClientRect().top;new BX.easing({duration:500,start:{left:i},finish:{left:30},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){a.style.left=e.left+"px"},complete:()=>{new BX.easing({duration:500,start:{top:n+25},finish:{top:r},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){a.style.top=e.top+"px"},complete:()=>{c.Dom.remove(a);s()}}).animate()}}).animate()}))}function we(e){return new Promise((t=>{new BX.easing({duration:700,start:{left:e.offsetLeft,opacity:1},finish:{left:400,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){e.style.paddingLeft=t.left+"px";e.style.opacity=t.opacity},complete:function(){t()}}).animate()}))}function Fe(e){jsDD.Enable();e.container.onbxdragstart=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe].bind(this,e);e.container.onbxdrag=(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,be)[be](e,t)};e.container.onbxdraghover=(e,t,s)=>{babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e,t,s)};e.container.onbxdragstop=babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].bind(this,e);jsDD.registerObject(e.container)}function ke(e){a.EventEmitter.emit(a.EventEmitter.GLOBAL_TARGET,"BX.Bitrix24.LeftMenuClass:onDragStart");if(!(e instanceof K)&&e.container.parentNode.querySelectorAll("li.menu-item-block").length<=1&&babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)!==null){e=babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)}a.EventEmitter.emit(this,m.eventName("onDragModeOn"));this.dnd={container:this.container.parentNode,itemDomBlank:c.Dom.create("div",{style:{display:"none"}}),itemMoveBlank:c.Dom.create("div",{style:{height:e.container.offsetHeight+"px"}}),draggableBlock:c.Dom.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:[e.container.offsetTop-e.container.offsetHeight,"px"].join("")}}),item:e,oldParent:babelHelpers.classPrivateFieldLooseBase(this,de)[de](e),isHiddenContainerVisible:this.isHiddenContainerVisible()};babelHelpers.classPrivateFieldLooseBase(this,te)[te](false);const t=()=>{[...this.parentContainer.querySelectorAll("li.menu-item-block")].forEach((t=>{if(e instanceof K&&babelHelpers.classPrivateFieldLooseBase(this,de)[de](this.items.get(t.getAttribute("data-id")))!==null){return}jsDD.registerDest(t,100)}));const t=this.parentContainer.querySelector("#left-menu-empty-item");if(e instanceof X){jsDD.unregisterDest(t)}else{jsDD.registerDest(t,100)}jsDD.registerDest(this.parentContainer.querySelector("#left-menu-hidden-empty-item"),100);jsDD.registerDest(this.parentContainer.querySelector("#left-menu-hidden-separator"),100)};if(e instanceof K){e.collapse(true).then((()=>{if(this.dnd){this.dnd.pos=BX.pos(this.container.parentNode);t()}}))}else{t()}const s=e.container;c.Dom.addClass(this.dnd.container,"menu-drag-mode");c.Dom.addClass(s,"menu-item-draggable");s.parentNode.insertBefore(this.dnd.itemDomBlank,s);s.parentNode.insertBefore(this.dnd.itemMoveBlank,s);this.dnd.draggableBlock.appendChild(e.container);this.dnd.container.style.position="relative";this.dnd.container.appendChild(this.dnd.draggableBlock);this.dnd.pos=BX.pos(this.container.parentNode)}function Ne(e,t){const s=this.dnd.item;var i=this.dnd.pos.height;t=Math.max(0,t-this.dnd.pos.top);this.dnd.draggableBlock.style.top=[Math.min(i-s.container.offsetHeight,t)-5,"px"].join("")}function _e(e,t,s){const i=this.dnd.item;const n=i.container;if(e===n){this.dnd.itemDomBlank.parentNode.insertBefore(this.dnd.itemMoveBlank,this.dnd.itemDomBlank);return}if(e.id==="left-menu-empty-item"&&(n.getAttribute("data-type")==="self"||n.getAttribute("data-disable-first-item")==="Y")){return}if(e.getAttribute("data-role")==="group"){const t=e.parentNode.querySelector(`[data-group-id="${e.getAttribute("data-id")}"]`);if(e.getAttribute("data-collapse-mode")==="collapsed"){c.Dom.insertAfter(this.dnd.itemMoveBlank,t)}else if(i instanceof K){c.Dom.insertBefore(this.dnd.itemMoveBlank,e)}else{c.Dom.prepend(this.dnd.itemMoveBlank,t.querySelector("ul"))}}else if(this.dnd.container.contains(e)){let t=e;if(i instanceof K&&e.closest('[data-role="group-content"]')){t=e.closest('[data-role="group-content"]')}c.Dom.insertAfter(this.dnd.itemMoveBlank,t)}}function He(){const e=this.dnd.item;const t=this.dnd.oldParent;const s=e.container;c.Dom.removeClass(this.dnd.container,"menu-drag-mode");c.Dom.removeClass(s,"menu-item-draggable");this.dnd.container.style.position="";let i=null;let n=false;if(this.parentContainer.querySelector(".menu-item-block")===e.container){if(e instanceof X){i=c.Loc.getMessage("MENU_SELF_ITEM_FIRST_ERROR")}else if(e.container.getAttribute("data-disable-first-item")==="Y"){i=c.Loc.getMessage("MENU_FIRST_ITEM_ERROR")}}if(i!==null){this.dnd.itemDomBlank.parentNode.replaceChild(s,this.dnd.itemDomBlank);e.showMessage(i)}else if(!this.dnd.container.contains(this.dnd.itemMoveBlank)){this.dnd.itemDomBlank.parentNode.replaceChild(s,this.dnd.itemDomBlank)}else{try{this.dnd.itemMoveBlank.parentNode.replaceChild(s,this.dnd.itemMoveBlank);if(this.hiddenContainer.contains(s)){e.container.setAttribute("data-status","hide");if(this.dnd.itemDomBlank.closest("#left-menu-hidden-items-block")===null&&this.hiddenContainer.querySelectorAll(".menu-item-block").length===1){a.EventEmitter.emit(this,m.eventName("onHiddenBlockIsNotEmpty"))}}else{e.container.setAttribute("data-status","show");if(this.hiddenContainer.querySelectorAll(".menu-item-block").length<=0){n=true;a.EventEmitter.emit(this,m.eventName("onHiddenBlockIsEmpty"))}}if(e instanceof K){e.checkAndCorrect().expand(true)}babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e,t);babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e);const i={action:"sortItem"};if(this.parentContainer.querySelector(".menu-item-block")===e.container&&!this.isExtranet){e.showMessage(c.Loc.getMessage("MENU_ITEM_MAIN_PAGE"));i.action="mainPage";i.itemId=e.getId()}babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](i)}catch(e){this.dnd.itemDomBlank.parentNode.replaceChild(s,this.dnd.itemDomBlank)}}c.Dom.remove(this.dnd.draggableBlock);c.Dom.remove(this.dnd.itemDomBlank);c.Dom.remove(this.dnd.itemMoveBlank);jsDD.enableDest(s);this.container.style.position="static";if(!this.dnd.isHiddenContainerVisible||n===true){babelHelpers.classPrivateFieldLooseBase(this,se)[se](false)}delete this.dnd;[...this.parentContainer.querySelectorAll("li.menu-item-block")].forEach((e=>{jsDD.registerDest(e)}));const o=this.parentContainer.querySelector("#left-menu-empty-item");jsDD.unregisterDest(o);jsDD.unregisterDest(this.parentContainer.querySelector("#left-menu-hidden-empty-item"));jsDD.unregisterDest(this.parentContainer.querySelector("#left-menu-hidden-separator"));jsDD.refreshDestArea();a.EventEmitter.emit(this,m.eventName("onDragModeOff"))}class Oe extends p{constructor(e,t){super(e,t)}saveCurrentPage(e){return U.saveCurrentPage(e).then((e=>{a.EventEmitter.emit(this,m.eventName("onItemHasBeenAdded"),e);return e})).catch(E.catchError)}saveStandardPage(e){return U.saveStandardPage(e).then((e=>{a.EventEmitter.emit(this,m.eventName("onItemHasBeenAdded"),e);return e})).catch(E.catchError)}deleteCurrentPage({pageLink:e}){return U.deleteCurrentPage({pageLink:e}).then((e=>{a.EventEmitter.emit(this,m.eventName("onItemHasBeenDeleted"),e);return e})).catch(E.catchError)}deleteStandardPage(e){return U.deleteStandardPage(e).then((e=>{a.EventEmitter.emit(this,m.eventName("onItemHasBeenDeleted"),e);return e})).catch(E.catchError)}showAddToSelf(e){X.showAdd(e).then((e=>{a.EventEmitter.emit(this,m.eventName("onItemHasBeenAdded"),e)})).catch(E.catchError)}}var Ue=babelHelpers.classPrivateFieldLooseKey("isAdmin");class Xe{constructor(e){Object.defineProperty(this,Ue,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=e?je.ADMIN:je.NOT_ADMIN}sendSetCustomPreset(){l.sendData({tool:Ke,category:Re.MENU,event:qe.SET,type:"custom",c_section:$e.MENU,p1:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]})}sendSetPreset(e,t,s){l.sendData({type:e,event:t?qe.CHANGE:qe.SELECT,tool:Ke,category:t?Re.MENU:Re.TOOL,c_section:t?$e.MENU:$e.POPUP,c_element:s,p1:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]})}sendClose(){l.sendData({event:qe.SHOW,tool:Ke,category:Re.TOOL,c_section:$e.POPUP})}}const Re={TOOL:"main_tool",MENU:"main_menu"};const qe={SHOW:"window_show",SELECT:"select",CHANGE:"change",SET:"menu_set"};const je={ADMIN:"isAdmin_Y",NOT_ADMIN:"isAdmin_N"};const $e={POPUP:"menu_popup",PRESET:"preset",QUALIFICATION:"qualification",SETTINGS:"settings",MENU:"main_menu"};const Ge={CONFIRM:"confirm",LATER:"later",CLOSE:"close",SAVE:"save",SKIP:"skip"};const Ke="intranet";let Ve=e=>e,We,Ye,ze,Qe,Je,Ze,et,tt;var st=babelHelpers.classPrivateFieldLooseKey("refs");var it=babelHelpers.classPrivateFieldLooseKey("status");var nt=babelHelpers.classPrivateFieldLooseKey("xhr");var at=babelHelpers.classPrivateFieldLooseKey("isExtranetInstalled");var ot=babelHelpers.classPrivateFieldLooseKey("handleGroupsLinkClick");var rt=babelHelpers.classPrivateFieldLooseKey("loadContent");var lt=babelHelpers.classPrivateFieldLooseKey("handleFilterClick");var ct=babelHelpers.classPrivateFieldLooseKey("handleItemsClick");var dt=babelHelpers.classPrivateFieldLooseKey("animateStart");var ut=babelHelpers.classPrivateFieldLooseKey("animateCounter");class mt{constructor(e){Object.defineProperty(this,ut,{value:vt});Object.defineProperty(this,dt,{value:bt});Object.defineProperty(this,ct,{value:ft});Object.defineProperty(this,lt,{value:gt});Object.defineProperty(this,rt,{value:pt});Object.defineProperty(this,ot,{value:ht});Object.defineProperty(this,st,{writable:true,value:new d.MemoryCache});Object.defineProperty(this,it,{writable:true,value:"initial"});Object.defineProperty(this,nt,{writable:true,value:null});Object.defineProperty(this,at,{writable:true,value:true});const t=document.getElementById("menu-all-groups-link");c.Event.bind(t,"click",babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].bind(this));babelHelpers.classPrivateFieldLooseBase(this,at)[at]=c.Type.isBoolean(e.isExtranetInstalled)?e.isExtranetInstalled:babelHelpers.classPrivateFieldLooseBase(this,at)[at]}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,st)[st].remember("container",(()=>c.Tag.render(We||(We=Ve`
				<div class="group-panel-content">
					<div class="group-panel-header">
						${0}
					</div>
					${0}
				</div>
			`),this.getFilterContainer(),this.getItemsContainer())))}getItemsContainer(){return babelHelpers.classPrivateFieldLooseBase(this,st)[st].remember("items-container",(()=>c.Tag.render(Ye||(Ye=Ve`
				<div class="group-panel-items" onclick="${0}"></div>
			`),babelHelpers.classPrivateFieldLooseBase(this,ct)[ct].bind(this))))}getFilterContainer(){return babelHelpers.classPrivateFieldLooseBase(this,st)[st].remember("filter-container",(()=>c.Tag.render(ze||(ze=Ve`
				<span class="group-panel-header-filters">${0}
				</span>
			`),[c.Tag.render(Qe||(Qe=Ve`
						<span
							class="group-panel-header-filter group-panel-header-filter-all"
							data-filter="all"
							onclick="${0}"
						>${0}</span>
					`),babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].bind(this),c.Loc.getMessage("MENU_MY_WORKGROUPS")),babelHelpers.classPrivateFieldLooseBase(this,at)[at]?c.Tag.render(Je||(Je=Ve`
								<span
									class="group-panel-header-filter group-panel-header-filter-extranet"
									data-filter="extranet"
									onclick="${0}"
								>${0}</span>
							`),babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].bind(this),c.Loc.getMessage("MENU_MY_WORKGROUPS_EXTRANET")):null,c.Tag.render(Ze||(Ze=Ve`
						<span
							class="group-panel-header-filter group-panel-header-filter-favorites"
							data-filter="favorites"
							onclick="${0}"
						>${0}${0}</span>
					`),babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].bind(this),c.Loc.getMessage("MENU_MY_WORKGROUPS_FAVORITES"),this.getCounterContainer())])))}getCounterContainer(){return babelHelpers.classPrivateFieldLooseBase(this,st)[st].remember("counter-container",(()=>c.Tag.render(et||(et=Ve`<span class="group-panel-header-filter-counter"></span>`))))}saveFilter(e){void c.ajax.runAction("intranet.leftmenu.setGroupFilter",{data:{filter:e}})}}function ht(e){u.SidePanel.Instance.open("my-groups",{cacheable:false,contentCallback:()=>c.Runtime.loadExtension("ui.sidepanel.layout").then((e=>{const{Layout:t}=e;return t.createContent({title:c.Loc.getMessage("MENU_MY_WORKGROUPS"),design:{section:true,margin:true},buttons:()=>[],content:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,it)[it]==="loaded"){return this.getContainer()}return babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]()}})})),events:{onClose:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]&&babelHelpers.classPrivateFieldLooseBase(this,it)[it]!=="loaded"){babelHelpers.classPrivateFieldLooseBase(this,it)[it]="initial";babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].abort()}}}})}async function pt(){babelHelpers.classPrivateFieldLooseBase(this,it)[it]="loading";const e=await c.ajax.runAction("intranet.leftmenu.getGroups",{onrequeststart:e=>{babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=e}});const{groups:t,filter:s}=e.data;for(const e of t){const t=["group-panel-item"];t.push(e.extranet?"group-panel-item-extranet":"group-panel-item-intranet");if(e.favorite){t.push("group-panel-item-favorite")}const s=c.Tag.render(tt||(tt=Ve`
				<a href="${0}" 
					class="${0}" 
					data-id="${0}" 
					data-slider-ignore-autobinding="true"
				>
					<span class="group-panel-item-text" title="${0}">${0}</span>
					<span class="group-panel-item-star"></span>
				</a>
			`),encodeURI(e.url),t.join(" "),e.id,c.Text.encode(e.title),c.Text.encode(e.title));c.Dom.append(s,this.getItemsContainer())}c.Dom.addClass(this.getContainer(),`group-panel-content-${s}`);c.Dom.attr(this.getContainer(),{"data-filter":s});babelHelpers.classPrivateFieldLooseBase(this,it)[it]="loaded";return this.getContainer()}function gt(e){const t=e.target;const s=this.getContainer().dataset.filter||"all";const i=t.dataset.filter||"all";if(s!==i){this.getContainer().dataset.filter=i;this.saveFilter(i);new BX.easing({duration:50,start:{opacity:1},finish:{opacity:0},transition:BX.easing.transitions.linear,step:e=>{c.Dom.style(this.getItemsContainer(),"opacity",e.opacity/100)},complete:()=>{c.Dom.removeClass(this.getContainer(),`group-panel-content-${s}`);c.Dom.addClass(this.getContainer(),`group-panel-content-${i}`);new BX.easing({duration:50,start:{opacity:0},finish:{opacity:1},transition:BX.easing.transitions.linear,step:e=>{c.Dom.style(this.getItemsContainer(),"opacity",e.opacity/100)},complete:()=>{c.Dom.style(this.getItemsContainer(),"opacity",null)}}).animate()}}).animate()}e.stopPropagation()}function ft(e){if(!c.Dom.hasClass(e.target,"group-panel-item-star")){return}const t=e.target;const s=t.parentNode;const i=s.dataset.id;const n=c.Dom.hasClass(s,"group-panel-item-favorite")?"removeFromFavorites":"addToFavorites";c.Dom.toggleClass(s,"group-panel-item-favorite");babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](t);babelHelpers.classPrivateFieldLooseBase(this,ut)[ut](n==="addToFavorites");void c.ajax.runAction(`intranet.leftmenu.${n}`,{data:{groupId:i}});e.preventDefault()}function bt(e){const t=e.cloneNode();c.Dom.style(t,"margin-left",`-${e.offsetWidth}px`);c.Dom.append(t,e.parentNode);new BX.easing({duration:200,start:{opacity:100,scale:100},finish:{opacity:0,scale:300},step:e=>{c.Dom.style(t,"transform",`scale(${e.scale/100})`);c.Dom.style(t,"opacity",e.opacity/100)},complete:()=>{t.parentNode.removeChild(t)}}).animate()}function vt(e){this.getCounterContainer().innerHTML=e===false?"-1":"+1";new BX.easing({duration:400,start:{opacity:100,top:0},finish:{opacity:0,top:-20},transition:BX.easing.transitions.linear,step:e=>{c.Dom.style(this.getCounterContainer(),"top",`${e.top}px`);c.Dom.style(this.getCounterContainer(),"opacity",e.opacity/100)},complete:()=>{c.Dom.style(this.getCounterContainer(),"top",null);c.Dom.style(this.getCounterContainer(),"opacity",null)}}).animate()}var yt=babelHelpers.classPrivateFieldLooseKey("getLeftMenuItemByTopMenuItem");var Et=babelHelpers.classPrivateFieldLooseKey("specialLiveFeedDecrement");var Lt=babelHelpers.classPrivateFieldLooseKey("addLicenseButton");var Ct=babelHelpers.classPrivateFieldLooseKey("getLicenseButton");var Mt=babelHelpers.classPrivateFieldLooseKey("createLicenseButton");class Pt{constructor(e){Object.defineProperty(this,Mt,{value:Tt});Object.defineProperty(this,Ct,{value:St});Object.defineProperty(this,Lt,{value:Bt});Object.defineProperty(this,yt,{value:It});this.cache=new c.Cache.MemoryCache;this.scrollModeThreshold=20;this.lastScrollOffset=0;this.slidingModeTimeoutId=0;this.isMenuMouseEnterBlocked=false;this.isMenuMouseLeaveBlocked=[];this.isCollapsedMode=false;Object.defineProperty(this,Et,{writable:true,value:0});this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return}e=typeof e==="object"?e:{};m.isExtranet=e.isExtranet==="Y";m.isMainPageEnabled=e.isMainPageEnabled==="Y";m.isAdmin=e.isAdmin;m.isCustomPresetRestricted=e.isCustomPresetAvailable!=="Y";m.availablePresetTools=e.availablePresetTools;m.settingsPath=e.settingsPath;m.inviteDialogLink=e.inviteDialogLink;m.showMarta=e.showMarta;m.showSitemapMenuItem=e.showSitemapMenuItem;m.showLicenseButton=e.showLicenseButton;m.licenseButtonPath=e.licenseButtonPath;this.isCollapsedMode=e.isCollapsedMode;this.analytics=new Xe(e.isAdmin);this.initAndBindNodes();this.bindEvents();this.getItemsController();babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]();this.groupPanel=new mt({isExtranetInstalled:e.isExtranetInstalled!=="N"})}initAndBindNodes(){var e;this.menuContainer.addEventListener("dblclick",this.handleMenuDoubleClick.bind(this));this.menuContainer.addEventListener("mouseenter",this.handleMenuMouseEnter.bind(this));this.menuContainer.addEventListener("mouseleave",this.handleMenuMouseLeave.bind(this));this.menuContainer.addEventListener("transitionend",this.handleSlidingTransitionEnd.bind(this));this.menuHeader=this.menuContainer.querySelector(".menu-items-header");this.menuBody=this.menuContainer.querySelector(".menu-items-body");this.menuItemsBlock=this.menuContainer.querySelector(".menu-items");this.mainTable=document.querySelector(".js-app");this.menuHeaderBurger=this.menuHeader.querySelector(".menu-switcher");this.menuHeaderBurger.addEventListener("click",this.handleBurgerClick.bind(this));this.menuHeader.querySelector(".menu-items-header-title").addEventListener("click",this.handleBurgerClick.bind(this,true));this.menuMoreButton=this.menuContainer.querySelector(".menu-item-block.menu-expand");this.menuMoreButton=this.menuContainer.querySelector('[data-role="expand-menu-item"]');this.menuMoreButton.addEventListener("click",this.handleShowHiddenClick.bind(this));const t=this.menuContainer.querySelector(".menu-sitemap-btn");if(t){t.addEventListener("click",this.handleSiteMapClick.bind(this))}const s=this.menuContainer.querySelector(".menu-settings-save-btn");if(s){s.addEventListener("click",this.handleViewMode.bind(this))}(e=this.menuContainer.querySelector('[data-role="menu-settings-item"]'))==null?void 0:e.addEventListener("click",(()=>{this.getSettingsController().show()}))}getItemsController(){return this.cache.remember("itemsController",(()=>new Ee(this.menuContainer,{events:{EditMode:()=>{this.toggle(true);this.menuContainer.classList.add("menu-items-edit-mode");this.menuContainer.classList.remove("menu-items-view-mode")},ViewMode:()=>{this.toggle(true);this.menuContainer.classList.add("menu-items-view-mode");this.menuContainer.classList.remove("menu-items-edit-mode")},onDragModeOn:({target:e})=>{this.switchToSlidingMode(true);this.isMenuMouseLeaveBlocked.push("drag")},onDragModeOff:({target:e})=>{this.isMenuMouseLeaveBlocked.pop()},onHiddenBlockIsVisible:this.onHiddenBlockIsVisible.bind(this),onHiddenBlockIsHidden:this.onHiddenBlockIsHidden.bind(this),onHiddenBlockIsEmpty:this.onHiddenBlockIsEmpty.bind(this),onHiddenBlockIsNotEmpty:this.onHiddenBlockIsNotEmpty.bind(this),onShow:()=>{this.isMenuMouseLeaveBlocked.push("items")},onClose:()=>{this.isMenuMouseLeaveBlocked.pop()}}})))}getItemDirector(){return this.cache.remember("itemsCreator",(()=>new Oe(this.menuContainer,{events:{onItemHasBeenAdded:({data:e})=>{this.getItemsController().addItem(e)}}})))}getSettingsController(){return this.cache.remember("presetController",(()=>{const e=this.menuContainer.querySelector('[data-role="menu-settings-item"]');if(!e){return null}return new B(e,{events:{onGettingSettingMenuItems:this.onGettingSettingMenuItems.bind(this),onShow:()=>{this.isMenuMouseLeaveBlocked.push("settings")},onClose:()=>{this.isMenuMouseLeaveBlocked.pop()}}})}))}getCustomPresetController(){return this.cache.remember("customPresetController",(()=>new b(this.menuContainer,{events:{onPresetIsSet:({data:e})=>{const{saveSortItems:t,firstItemLink:s,customItems:i}=this.getItemsController().export();if(!e){this.analytics.sendSetCustomPreset()}return D.setCustomPreset(e,t,i,s)},onShow:()=>{this.isMenuMouseLeaveBlocked.push("presets")},onClose:()=>{this.isMenuMouseLeaveBlocked.pop()}}})))}getDefaultPresetController(){let e=false;const t=e=>{const t=D.postponeSystemPreset(e);a.EventEmitter.emit(this,m.eventName("onPresetIsPostponed"));return t};return this.cache.remember("defaultPresetController",(()=>{const s=new M(this.menuContainer,{events:{onPresetIsSet:({data:{mode:t,presetId:s}})=>{this.analytics.sendSetPreset(s,t==="personal",Ge.CONFIRM);e=true;return D.setSystemPreset(t,s)},onPresetIsPostponed:({data:{mode:i}})=>{this.analytics.sendSetPreset(s.getSelectedPreset(),i==="personal",Ge.LATER);e=true;return t(i)},onShow:()=>{this.analytics.sendClose()},onClose:()=>{if(e!==true){this.analytics.sendSetPreset(s.getSelectedPreset(),s.getMode()==="personal",Ge.CLOSE);t(s.getMode())}e=false}}});return s}))}bindEvents(){a.EventEmitter.subscribe("onImUpdateCounter",(e=>{const[t]=e.getCompatData();this.updateCounters(t,false)}));a.EventEmitter.subscribe("onImUpdateCounterMessage",(e=>{const[t]=e.getCompatData();this.updateCounters({"im-message":t},false)}));a.EventEmitter.subscribe("onCounterDecrement",(e=>{const[t]=e.getCompatData();this.decrementCounter(document.getElementById("menu-counter-live-feed"),t)}));a.EventEmitter.subscribe("onPullEvent-main",(e=>{const[t,s]=e.getCompatData();if(t==="user_counter"&&s[c.Loc.getMessage("SITE_ID")]){const e={...s[c.Loc.getMessage("SITE_ID")]};this.updateCounters(e,false)}}));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onOpen",this.handleGroupPanelOpen.bind(this));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onClose",this.handleGroupPanelClose.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",((e,t)=>{if(!e||!c.Type.isDomNode(t)){return}const s=t.getAttribute("data-top-menu-id");const i=this.menuBody.querySelector(`[data-top-menu-id="${s}"]`);if(i){i.setAttribute("data-link",e);const t=i.querySelector("a.menu-item-link");if(t){t.setAttribute("href",e)}if(i.previousElementSibling===this.menuContainer.querySelector("#left-menu-empty-item")){D.setFirstPage(e)}else{D.clearCache()}}this.showMessage(t,c.Loc.getMessage("MENU_ITEM_MAIN_SECTION_PAGE"))}));BX.addCustomEvent("BX.Main.InterfaceButtons:onHideLastVisibleItem",(e=>{this.showMessage(e,c.Loc.getMessage("MENU_TOP_ITEM_LAST_HIDDEN"))}));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeCreateEditMenu",((e,t,s)=>{let i=babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](t);if(!i&&t&&c.Type.isStringFilled(t.URL)&&!t.URL.match(/javascript:/)){e.addMenuItem({text:c.Loc.getMessage("MENU_ADD_TO_LEFT_MENU"),onclick:(e,s)=>{this.getItemDirector().saveStandardPage(t);s.getMenuWindow().close()}})}else if(i instanceof U){e.addMenuItem({text:c.Loc.getMessage("MENU_DELETE_FROM_LEFT_MENU"),onclick:(e,s)=>{this.getItemDirector().deleteStandardPage(t);s.getMenuWindow().close()}})}}));top.BX.addCustomEvent("UI.Toolbar:onRequestMenuItemData",(({currentFullPath:e,context:t})=>{if(c.Type.isStringFilled(e)){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",[{currentPageInMenu:this.menuContainer.querySelector(`.menu-item-block[data-link="${e}"]`),context:t}])}}));a.EventEmitter.subscribe("UI.Toolbar:onStarClick",(({compatData:[e]})=>{if(e.isActive){this.getItemDirector().deleteCurrentPage({context:e.context,pageLink:e.pageLink}).then((({itemInfo:t})=>{BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[t,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false,context:e.context}])}))}else{this.getItemDirector().saveCurrentPage({pageTitle:e.pageTitle,pageLink:e.pageLink}).then((({itemInfo:t})=>{BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[t,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:true,context:e.context}])}))}}));a.EventEmitter.subscribe("BX.Main.InterfaceButtons:onBeforeResetMenu",(({compatData:[e]})=>{e.push((()=>{const e=new BX.Promise;D.clearCache().then((()=>{e.fulfill()}),(t=>{e.reject(`Error: ${t.errors[0].message}`)}));return e}))}))}isEditMode(){return this.getItemsController().isEditMode}isCollapsed(){return this.isCollapsedMode}showMessage(e,t,s){var i=n.PopupManager.create("left-menu-message",e,{content:'<div class="left-menu-message-popup">'+t+"</div>",darkMode:true,offsetTop:s==="right"?-45:2,offsetLeft:s==="right"?215:0,angle:s==="right"?{position:"left"}:true,cacheable:false,autoHide:true,events:{onDestroy:function(){i=null}}});i.show();setTimeout((function(){if(i){i.close();i=null}}),3e3)}showError(e){this.showMessage(e,c.Loc.getMessage("edit_error"))}showGlobalPreset(){const e=c.Runtime.loadExtension("ui.banner-dispatcher");e.then((()=>{r.BannerDispatcher.high.toQueue((e=>{const t=this.getDefaultPresetController();t.show("global");t.getPopup().subscribe("onAfterClose",(t=>{e()}))}))})).catch((()=>{}))}handleShowHiddenClick(){this.getItemsController().toggleHiddenContainer(true)}onHiddenBlockIsVisible(){c.Dom.addClass(this.menuMoreButton,"menu-favorites-more-btn-open");this.menuMoreButton.querySelector("#menu-more-btn-text").innerHTML=c.Loc.getMessage("more_items_hide")}onHiddenBlockIsHidden(){c.Dom.removeClass(this.menuMoreButton,"menu-favorites-more-btn-open");this.menuMoreButton.querySelector("#menu-more-btn-text").innerHTML=c.Loc.getMessage("more_items_show")}onHiddenBlockIsEmpty(){c.Dom.addClass(this.menuMoreButton,"menu-favorites-more-btn-hidden")}onHiddenBlockIsNotEmpty(){c.Dom.removeClass(this.menuMoreButton,"menu-favorites-more-btn-hidden")}setDefaultMenu(){o.MessageBox.show({message:c.Loc.getMessage("MENU_SET_DEFAULT_CONFIRM"),onYes:(e,t)=>{t.setWaiting();D.setDefaultPreset().then((()=>{t.setWaiting(false);e.close();document.location.reload()}))},buttons:o.MessageBoxButtons.YES_CANCEL})}clearCompositeCache(){c.ajax.runAction("intranet.leftmenu.clearCache",{data:{}})}onGettingSettingMenuItems(){const e=U.getActiveTopMenuItem();let t=null;if(e){const s=this.menuContainer.querySelector(`.menu-item-block[data-link="${e["URL"]}"]`);if(!s){t={text:c.Loc.getMessage("MENU_ADD_TO_LEFT_MENU"),onclick:(t,s)=>{this.getItemDirector().saveStandardPage(e);s.getMenuWindow().destroy()}}}else if(s.getAttribute("data-type")===U.code){t={text:c.Loc.getMessage("MENU_DELETE_FROM_LEFT_MENU"),onclick:(t,s)=>{this.getItemDirector().deleteStandardPage(e);s.getMenuWindow().destroy()}}}else{t={text:c.Loc.getMessage("MENU_DELETE_PAGE_FROM_LEFT_MENU"),className:"menu-popup-disable-text",onclick:()=>{}}}}const s=[{text:c.Loc.getMessage("SORT_ITEMS"),onclick:()=>{this.getItemsController().switchToEditMode()}},{text:this.isCollapsed()?c.Loc.getMessage("MENU_EXPAND"):c.Loc.getMessage("MENU_COLLAPSE"),onclick:(e,t)=>{this.toggle();t.getMenuWindow().destroy()}},t,{text:c.Loc.getMessage("MENU_ADD_SELF_PAGE"),onclick:(e,t)=>{this.getItemDirector().showAddToSelf(this.getSettingsController().getContainer())}}];if(m.isAdmin){let e=c.Loc.getMessage("MENU_SAVE_CUSTOM_PRESET");if(m.isCustomPresetRestricted){e+="<span class='menu-lock-icon'></span>"}s.push({html:e,className:m.isCustomPresetRestricted?" menu-popup-disable-text":"",onclick:(e,t)=>{if(m.isCustomPresetRestricted){BX.UI.InfoHelper.show("limit_office_menu_to_all")}else{this.getCustomPresetController().show()}}})}if(!m.isExtranet){s.push({text:c.Loc.getMessage("MENU_SET_DEFAULT"),onclick:this.setDefaultMenu.bind(this)})}const i=c.Reflection.getClass("BX.Messenger.v2.Lib.Messenger");const n=[!m.isAdmin?null:{text:c.Loc.getMessage("LEFT_MENU_SETTINGS_ITEM_B24_SETTINGS"),onclick:()=>{BX.SidePanel.Instance.open(`${m.settingsPath}?analyticContext=left_menu`,{allowChangeHistory:false,width:1034})}},i?{text:c.Loc.getMessage("LEFT_MENU_SETTINGS_ITEM_MESSENGER_SETTINGS"),onclick:()=>{i.openSettings()}}:null,m.isExtranet?null:{text:c.Loc.getMessage("MENU_SET_DEFAULT2"),onclick:()=>{this.getDefaultPresetController().show("personal")}},!m.inviteDialogLink?null:{text:c.Loc.getMessage("MENU_INVITE_USERS"),onclick:()=>{BX.SidePanel.Instance.open(m.inviteDialogLink,{cacheable:false,allowChangeHistory:false,width:1100})}},!m.isAdmin&&m.isExtranet?null:{delimiter:true},{text:c.Loc.getMessage("LEFT_MENU_SETTINGS_ITEM_MENU_SETTINGS"),items:s},{delimiter:true},!m.showSitemapMenuItem?null:{text:c.Loc.getMessage("MENU_SITE_MAP"),onclick:()=>{this.handleSiteMapClick()}},{text:c.Loc.getMessage("MENU_HELP"),onclick:()=>{this.handleHelperClick()}}];return n.filter((e=>e!==null))}handleSiteMapClick(){this.switchToSlidingMode(false);BX.SidePanel.Instance.open((c.Loc.getMessage("SITE_DIR")||"/")+"sitemap/",{allowChangeHistory:false,customLeftBoundary:0})}handleHelperClick(){this.switchToSlidingMode(false);BX.Helper.show()}blockSliding(){this.stopSliding();this.isMenuMouseEnterBlocked=true}releaseSliding(){this.isMenuMouseEnterBlocked=false}stopSliding(){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=0}startSliding(){this.stopSliding();if(this.isMenuMouseEnterBlocked===true){return}this.slidingModeTimeoutId=setTimeout(function(){this.slidingModeTimeoutId=0;this.switchToSlidingMode(true)}.bind(this),400)}handleBurgerClick(e){this.getItemsController().switchToViewMode();this.menuHeaderBurger.classList.add("menu-switcher-hover");this.toggle(e,function(){this.blockSliding();setTimeout(function(){this.menuHeaderBurger.classList.remove("menu-switcher-hover");this.releaseSliding()}.bind(this),100)}.bind(this))}handleMenuMouseEnter(e){if(!this.isCollapsed()){return}this.startSliding()}handleMenuMouseLeave(e){this.stopSliding();if(this.isMenuMouseLeaveBlocked.length<=0){this.switchToSlidingMode(false)}}handleMenuDoubleClick(e){if(e.target===this.menuBody){this.toggle()}}handleUpButtonClick(){this.blockSliding();if(this.isUpButtonReversed()){window.scrollTo(0,this.lastScrollOffset);this.lastScrollOffset=0;this.unreverseUpButton()}else{this.lastScrollOffset=window.pageYOffset;window.scrollTo(0,0);this.reverseUpButton()}setTimeout(this.releaseSliding.bind(this),100)}handleUpButtonMouseLeave(){this.releaseSliding()}handleDocumentScroll(){if(window.pageYOffset>document.documentElement.clientHeight){this.showUpButton();if(this.isUpButtonReversed()){this.unreverseUpButton();this.lastScrollOffset=0}}else if(!this.isUpButtonReversed()){this.hideUpButton()}if(window.pageXOffset>0){this.menuContainer.style.left=-window.pageXOffset+"px";this.upButton.style.left=-window.pageXOffset+(this.isCollapsed()?0:172)+"px"}else{this.menuContainer.style.removeProperty("left");this.upButton.style.removeProperty("left")}}switchToSlidingMode(e,t){if(e===false){this.stopSliding();if(BX.hasClass(this.mainTable,"menu-sliding-mode")){if(t!==true){BX.addClass(this.mainTable,"menu-sliding-closing-mode");if(m.showLicenseButton){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]().setCollapsed(true)}}BX.removeClass(this.mainTable,"menu-sliding-mode menu-sliding-opening-mode");c.Dom.removeClass(this.menuContainer,"--ui-context-edge-dark")}}else if(this.isCollapsedMode&&!BX.hasClass(this.mainTable,"menu-sliding-mode")){BX.removeClass(this.mainTable,"menu-sliding-closing-mode");c.Dom.removeClass(this.menuContainer,"--ui-context-edge-dark");if(t!==true){BX.addClass(this.mainTable,"menu-sliding-opening-mode");if(m.showLicenseButton){setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]().setCollapsed(false)}),50)}}BX.addClass(this.mainTable,"menu-sliding-mode");c.Dom.addClass(this.menuContainer,"--ui-context-edge-dark")}}handleSlidingTransitionEnd(e){if(e.target===this.menuContainer){BX.removeClass(this.mainTable,"menu-sliding-opening-mode menu-sliding-closing-mode")}}switchToScrollMode(e){if(e===false){c.Dom.removeClass(this.mainTable,"menu-scroll-mode")}else if(!c.Dom.hasClass(this.mainTable,"menu-scroll-mode")){c.Dom.addClass(this.mainTable,"menu-scroll-mode")}}toggle(e,t){let s=document.querySelector(".js-app");if(!s){return}const i=!this.mainTable.classList.contains("menu-collapsed-mode");if(e===i||this.mainTable.classList.contains("menu-animation-mode")){return}BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",[e,this]);this.blockSliding();this.switchToSlidingMode(false,true);this.mainTable.classList.add("menu-animation-mode",i?"menu-animation-closing-mode":"menu-animation-opening-mode");var n=[].slice.call(s.querySelectorAll(".menu-item-link"));var a=s.querySelector(".menu-collapsed-more-btn");var o=s.querySelector(".menu-default-more-btn");var r=s.querySelector(".menu-sitemap-icon-box");var l=s.querySelector(".menu-sitemap-btn-text");var c=s.querySelector(".menu-invite-employees-text");var d=s.querySelector(".menu-invite-icon-box");const u=this.menuContainer.querySelector(".menu-settings-icon-box");const h=this.menuContainer.querySelector(".menu-settings-btn-text");const p=this.menuContainer.querySelector(".menu-help-icon-box");const g=this.menuContainer.querySelector(".menu-help-btn-text");var f=s.querySelector(".menu-item-separator");var b=s.querySelector(".menu-item-index-more");var v=this.mainTable.querySelector(".air-header");var y=document.getElementById("bx-im-bar");var E=y?y.offsetWidth:0;const L=parseInt(getComputedStyle(this.menuContainer).getPropertyValue("--menu-width-expanded"),10);const C=parseInt(getComputedStyle(this.menuContainer).getPropertyValue("--menu-width-collapsed"),10);new BX.easing({duration:300,start:{sidebarWidth:i?L:C},finish:{sidebarWidth:i?C:L},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){this.menuContainer.style.width=e.sidebarWidth+"px";this.menuHeaderBurger.style.width=e.burgerMenuWidth+"px";if(v){v.style.maxWidth="calc(100vw - "+e.sidebarWidth+"px - "+E+"px)"}if(m.showLicenseButton&&e.sidebarWidth>160){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]().setCollapsed(i)}if(i){if(r){r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100}if(l){l.style.transform="translateX("+e.translateText+"px)";l.style.opacity=e.opacity/100}if(d){d.style.transform="translateX("+e.translateIcon+"px)";d.style.opacity=e.opacityRevert/100}if(c){c.style.transform="translateX("+e.translateText+"px)";c.style.opacity=e.opacity/100}if(u){u.style.transform="translateX("+e.translateIcon+"px)";u.style.opacity=e.opacityRevert/100}if(h){h.style.transform="translateX("+e.translateText+"px)";h.style.opacity=e.opacity/100}if(p){p.style.transform="translateX("+e.translateIcon+"px)";p.style.opacity=e.opacityRevert/100}if(g){g.style.transform="translateX("+e.translateText+"px)";g.style.opacity=e.opacity/100}if(a){a.style.transform="translateX("+e.translateIcon+"px)";a.style.opacity=e.opacityRevert/100}if(o){o.style.transform="translateX("+e.translateMoreBtn+"px)";o.style.opacity=e.opacity/100}if(b){b.style.transform="translateX("+e.translateIcon+"px)";b.style.opacity=e.opacityRevert/100}n.forEach((function(t){var s=t.querySelector(".menu-item-icon-box");var i=t.querySelector(".menu-item-link-text");var n=t.querySelector(".menu-item-index");var a=t.querySelector(".menu-item-link-arrow");i.style.transform="translateX("+e.translateText+"px)";i.style.opacity=e.opacity/100;s.style.transform="translateX("+e.translateIcon+"px)";s.style.opacity=e.opacityRevert/100;if(a){a.style.transform="translateX("+e.translateText+"px)";a.style.opacity=e.opacity/100}if(n){n.style.transform="translateX("+e.translateIcon+"px)";n.style.opacity=e.opacityRevert/100}}))}else{f.style.opacity=0;if(r){r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100}if(l){l.style.transform="translateX("+e.translateText+"px)";l.style.opacity=e.opacity/100}if(d){d.style.transform="translateX("+e.translateIcon+"px)";d.style.opacity=e.opacityRevert/100}if(c){c.style.transform="translateX("+e.translateText+"px)";c.style.opacity=e.opacity/100}if(u){u.style.transform="translateX("+e.translateIcon+"px)";u.style.opacity=e.opacityRevert/100}if(h){h.style.transform="translateX("+e.translateText+"px)";h.style.opacity=e.opacity/100}if(p){p.style.transform="translateX("+e.translateIcon+"px)";p.style.opacity=e.opacityRevert/100}if(g){g.style.transform="translateX("+e.translateText+"px)";g.style.opacity=e.opacity/100}if(a){a.style.transform="translateX("+e.translateIcon+"px)";a.style.opacity=e.opacityRevert/100}if(o){o.style.transform="translateX("+e.translateMoreBtn+"px)";o.style.opacity=e.opacity/100}if(b){b.style.transform="translateX("+e.translateText+"px)"}n.forEach((function(t){var s=t.querySelector(".menu-item-icon-box");var i=t.querySelector(".menu-item-link-text");var n=t.querySelector(".menu-item-index");var a=t.querySelector(".menu-item-link-arrow");i.style.transform="translateX("+e.translateText+"px)";i.style.opacity=e.opacity/100;i.style.display="inline-block";s.style.transform="translateX("+e.translateIcon+"px)";s.style.opacity=e.opacityRevert/100;if(a){a.style.transform="translateX("+e.translateText+"px)"}if(n){n.style.transform="translateX("+e.translateText+"px)"}}))}var t=document.createEvent("Event");t.initEvent("resize",true,true);window.dispatchEvent(t)}.bind(this),complete:function(){if(i){this.isCollapsedMode=true;BX.addClass(this.mainTable,"menu-collapsed-mode")}else{this.isCollapsedMode=false;BX.removeClass(this.mainTable,"menu-collapsed-mode")}BX.removeClass(this.mainTable,"menu-animation-mode menu-animation-opening-mode menu-animation-closing-mode");var e=[s,f,this.menuHeaderBurger,this.headerBurger,u,h,p,g,o,a,r,l,d,c,b,this.menuContainer,v];e.forEach((function(e){if(e){e.style.cssText=""}}));n.forEach((function(e){var t=e.querySelector(".menu-item-icon-box");var s=e.querySelector(".menu-item-link-text");var i=e.querySelector(".menu-item-index");var n=e.querySelector(".menu-item-link-arrow");e.style.cssText="";s.style.cssText="";t.style.cssText="";if(n){n.style.cssText=""}if(i){i.style.cssText=""}}));this.releaseSliding();if(BX.type.isFunction(t)){t()}D.toggleMenu(i);var m=document.createEvent("Event");m.initEvent("resize",true,true);window.dispatchEvent(m)}.bind(this)}).animate()}handleViewMode(){this.getItemsController().switchToViewMode()}handleGroupPanelOpen(){this.isMenuMouseLeaveBlocked.push("group")}handleGroupPanelClose(){this.isMenuMouseLeaveBlocked.pop()}showUpButton(){this.menuContainer.classList.add("menu-up-button-active")}hideUpButton(){this.menuContainer.classList.remove("menu-up-button-active")}reverseUpButton(){this.menuContainer.classList.add("menu-up-button-reverse")}unreverseUpButton(){this.menuContainer.classList.remove("menu-up-button-reverse")}isUpButtonReversed(){return this.menuContainer.classList.contains("menu-up-button-reverse")}isDefaultTheme(){return document.body.classList.contains("bitrix24-default-theme")}getTopPadding(){return this.isDefaultTheme()?0:9}initPagetitleStar(){return U.isCurrentPageStandard(U.getActiveTopMenuItem())}getStructureForHelper(){const e={menu:{}};["show","hide"].forEach((t=>{Array.from(this.menuContainer.querySelectorAll(`[data-status="${t}"][data-type="${$.code}"]`)).forEach((s=>{e[t]=e[t]||[];e[t].push(s.getAttribute("data-id"))}))}));return e}showItemWarning({itemId:e,title:t,events:s}){if(this.getItemsController().items.has(e)){this.getItemsController().items.get(e).showWarning(t,s)}}removeItemWarning(e){if(this.getItemsController().items.has(e)){this.getItemsController().items.get(e).removeWarning()}}decrementCounter(e,t){if(!e||e.id!=="menu-counter-live-feed"){return}babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]+=parseInt(t);this.getItemsController().decrementCounter({"live-feed":parseInt(t)})}updateCounters(e,t){if(!e){return}if(e["**"]!==undefined){e["live-feed"]=e["**"];delete e["**"]}if(e["live-feed"]){if(e["live-feed"]<=0){babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]=0}else{e["live-feed"]-=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]}}this.getItemsController().updateCounters(e,t)}}function It({DATA_ID:e,NODE:t}){var s;let i=this.getItemsController().items.get(e);if(!i){const e=t.getAttribute("data-top-menu-id");if(t===t.parentNode.querySelector("[data-top-menu-id]")){const t=this.menuItemsBlock.querySelector(`[data-top-menu-id="${e}"]`);if(t){i=this.getItemsController().items.get(t.getAttribute("data-id"))}}}return(s=i)!=null?s:null}function Bt(){if(m.showLicenseButton){const e=this.menuContainer.querySelector(".menu-license-all-wrapper");if(e){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]().renderTo(e)}}}function St(){if(this.licenseButton){return this.licenseButton}this.licenseButton=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]();this.licenseButton.setCollapsed(this.isCollapsed());return this.licenseButton}function Tt(){return new t.Button({size:t.Button.Size.SMALL,text:c.Loc.getMessage("MENU_LICENSE_ALL"),useAirDesign:true,style:t.AirButtonStyle.FILLED_SUCCESS,noCaps:true,wide:true,icon:"o-rocket",className:"menu-license-all-button",onclick:()=>{BX.SidePanel.Instance.open(m.licenseButtonPath,{width:1250,cacheable:false})}})}e.Menu=Pt})(this.BX.Intranet=this.BX.Intranet||{},BX.UI,BX,BX.UI,BX.Main,BX.Event,BX.UI.Dialogs,BX.UI,BX.UI.Analytics,BX,BX.Cache,BX.SidePanel);
//# sourceMappingURL=script.map.js