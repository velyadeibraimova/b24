this.BX=this.BX||{};(function(e,t,n,i,a,r,s,o,l){"use strict";var u=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"eventName",value:function e(t){return["BX.Intranet.LeftMenu:"].concat(babelHelpers.toConsumableArray(i.Type.isStringFilled(t)?[t]:t)).join(":")}}]);return e}();babelHelpers.defineProperty(u,"version","2021.10");babelHelpers.defineProperty(u,"eventNameSpace","BX.Intranet.LeftMenu:");babelHelpers.defineProperty(u,"isExtranet",false);babelHelpers.defineProperty(u,"isAdmin",false);babelHelpers.defineProperty(u,"isCustomPresetRestricted",false);babelHelpers.defineProperty(u,"settingsPath",null);babelHelpers.defineProperty(u,"isMainPageEnabled",false);babelHelpers.defineProperty(u,"availablePresetTools",null);function c(e,t,n){d(e,t);t.set(e,n)}function d(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var m=new WeakMap;var h=function(){function e(t,n){var i=this;var a=n.events;babelHelpers.classCallCheck(this,e);c(this,m,{writable:true,value:null});this.container=t;if(a){Array.from(Object.keys(a)).forEach((function(e){r.EventEmitter.subscribe(i,u.eventName(e),a[e])}))}}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){return this.container}},{key:"createPopup",value:function e(){}},{key:"getPopup",value:function e(){return babelHelpers.classPrivateFieldGet(this,m)}},{key:"show",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,m)===null){babelHelpers.classPrivateFieldSet(this,m,this.createPopup.apply(this,arguments));r.EventEmitter.subscribe(babelHelpers.classPrivateFieldGet(this,m),"onClose",(function(){r.EventEmitter.emit(t,u.eventName("onClose"))}));r.EventEmitter.subscribe(babelHelpers.classPrivateFieldGet(this,m),"onShow",(function(){r.EventEmitter.emit(t,u.eventName("onShow"))}));r.EventEmitter.subscribe(babelHelpers.classPrivateFieldGet(this,m),"onDestroy",(function(){babelHelpers.classPrivateFieldSet(t,m,null)}))}babelHelpers.classPrivateFieldGet(this,m).show()}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,m)){babelHelpers.classPrivateFieldGet(this,m).close()}}}]);return e}();var f;var p=function(e){babelHelpers.inherits(n,e);function n(){var e;var t;babelHelpers.classCallCheck(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++){a[r]=arguments[r]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(n)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"isReady",true);return t}babelHelpers.createClass(n,[{key:"createPopup",value:function e(){var n=this;var s=i.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<form id="customPresetForm" style="min-width: 350px;">\n\t\t\t\t<div style="margin: 15px 0 15px 9px;">\n\t\t\t\t\t<input type="radio" name="userScope" id="customPresetCurrentUser" value="currentUser">\n\t\t\t\t\t<label for="customPresetCurrentUser">','</label>\n\t\t\t\t</div>\n\t\t\t\t<div style="margin: 0 0 38px 9px;">\n\t\t\t\t\t<input type="radio" name="userScope" id="customPresetNewUser" value="newUser" checked>\n\t\t\t\t\t<label for="customPresetNewUser">','</label>\n\t\t\t\t</div>\n\t\t\t\t<hr style="background-color: #edeef0; border: none; color:  #edeef0; height: 1px;">\n\t\t\t</form>'])),i.Loc.getMessage("MENU_CUSTOM_PRESET_CURRENT_USER"),i.Loc.getMessage("MENU_CUSTOM_PRESET_NEW_USER"));var o;return a.PopupManager.create(this.constructor.toString(),null,{overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:i.Loc.getMessage("MENU_CUSTOM_PRESET_POPUP_TITLE"),offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,content:s,buttons:[o=new t.SaveButton({onclick:function e(){if(n.isReady===false){return}o.setWaiting(true);n.isReady=false;r.EventEmitter.emit(n,u.eventName("onPresetIsSet"),s.elements["userScope"].value==="newUser").forEach((function(e){e.then((function(){o.setWaiting(false);n.hide();a.PopupManager.create("menu-custom-preset-success-popup",null,{closeIcon:true,contentColor:"white",titleBar:i.Loc.getMessage("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:i.Loc.getMessage("MENU_CUSTOM_PRESET_SUCCESS")}).show()}))["catch"]((function(){console.log("Error!!")}))}));n.isReady=true}}),new t.CancelButton({onclick:function e(){n.hide()}})]})}}]);return n}(h);function v(e,t,n,i){E(e,t);y(n,"set");g(e,n,i);return i}function g(e,t,n){if(t.set){t.set.call(e,n)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=n}}function b(e,t,n){E(e,t);y(n,"get");return k(e,n)}function y(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function E(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function k(e,t){if(t.get){return t.get.call(e)}return t.value}var C=function(){function e(){babelHelpers.classCallCheck(this,e);this.container=BX("bx-panel");if(this.container){this.bindEvents()}}babelHelpers.createClass(e,[{key:"bindEvents",value:function e(){BX.addCustomEvent("onTopPanelCollapse",function(e){r.EventEmitter.emit(this,u.eventName("onPanelHasChanged"),this.top)}.bind(this));BX.addCustomEvent("onTopPanelFix",function(){r.EventEmitter.emit(this,u.eventName("onPanelHasChanged"),this.top)}.bind(this))}},{key:"height",get:function e(){return this.container?this.container.offsetHeight:0}},{key:"fixedHeight",get:function e(){var t=BX.getClass("BX.admin.panel.state");if(t&&t.fixed){return this.height}return 0}},{key:"top",get:function e(){if(this.container){var t=this.container.getBoundingClientRect();if(t.bottom>0){return Math.max(t.bottom,this.fixedHeight)}return Math.max(0,this.fixedHeight)}return 0}}],[{key:"getInstance",value:function t(){if(!b(this,e,M)){v(this,e,M,new e)}return b(this,e,M)}}]);return e}();var M={writable:true,value:null};function I(e,t,n,i){L(e,t);w(n,"set");S(e,n,i);return i}function S(e,t,n){if(t.set){t.set.call(e,n)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=n}}function T(e,t,n){L(e,t);w(n,"get");return A(e,n)}function w(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function L(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function A(e,t){if(t.get){return t.get.call(e)}return t.value}var P=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getCurPage",value:function t(){if(T(this,e,H)===null){I(this,e,H,document.location.pathname+document.location.search)}return T(this,e,H)===""?null:T(this,e,H)}},{key:"getCurUri",value:function t(){if(T(this,e,B)===null){I(this,e,B,new i.Uri(document.location.href))}return T(this,e,B)}},{key:"catchError",value:function e(t){BX.UI.Notification.Center.notify({content:[i.Loc.getMessage("MENU_ERROR_OCCURRED"),t.errors?": "+t.errors[0].message:""].join(" "),position:"bottom-left",category:"menu-self-item-popup",autoHideDelay:3e3})}},{key:"refineUrl",value:function e(t){t=String(t).trim();if(t!==""){if(!t.match(/^https?:\/\//i)&&!t.match(/^\//i)){t="http://"+t}else{var n=document.createElement("a");n.href=t;if(document.location.host===n.host){t=n.pathname+n.search+n.hash}}}return t}},{key:"adminPanel",get:function e(){return C.getInstance()}}]);return e}();var H={writable:true,value:null};var B={writable:true,value:null};function x(e,t,n){D(e,t);t.set(e,n)}function D(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var N=new WeakMap;var _=new WeakMap;var U=function(e){babelHelpers.inherits(n,e);function n(){var e;var t;babelHelpers.classCallCheck(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++){a[r]=arguments[r]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(n)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"isReady",true);x(babelHelpers.assertThisInitialized(t),N,{writable:true,value:void 0});x(babelHelpers.assertThisInitialized(t),_,{writable:true,value:void 0});return t}babelHelpers.createClass(n,[{key:"createPopup",value:function e(n){var s=this;var o;babelHelpers.classPrivateFieldSet(this,_,n);var l=document.querySelector("#left-menu-preset-popup").cloneNode(true);return a.PopupManager.create(this.constructor.name.toString(),null,{overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,content:l,events:{onFirstShow:function e(){babelHelpers.toConsumableArray(l.querySelectorAll(".js-left-menu-preset-item")).forEach((function(e){e.addEventListener("click",(function(){babelHelpers.toConsumableArray(l.querySelectorAll(".js-left-menu-preset-item")).forEach((function(t){t.classList[t===e?"add":"remove"]("left-menu-popup-selected")}))}))}))}},buttons:[o=new t.CreateButton({text:i.Loc.getMessage("MENU_CONFIRM_BUTTON"),onclick:function e(){if(o.isWaiting()){return}o.setWaiting(true);var t=s.getSelectedPreset();if(!u.isAdmin&&u.availablePresetTools&&u.availablePresetTools[t]===false){o.setWaiting(false);s.showUnavailableToolPopup();return}r.EventEmitter.emit(s,u.eventName("onPresetIsSet"),{presetId:t,mode:n}).forEach((function(e){e.then((function(e){o.setWaiting(false);s.hide();if(e.data.hasOwnProperty("url")){document.location.href=e.data.url}else{document.location.reload()}}))["catch"](P.catchError)}))}}),new t.CancelButton({text:i.Loc.getMessage("MENU_DELAY_BUTTON"),onclick:function e(){r.EventEmitter.emit(s,u.eventName("onPresetIsPostponed"),{mode:n});s.hide()}})]})}},{key:"getMode",value:function e(){return babelHelpers.classPrivateFieldGet(this,_)}},{key:"getSelectedPreset",value:function e(){var t="";if(document.forms["left-menu-preset-form"]){babelHelpers.toConsumableArray(document.forms["left-menu-preset-form"].elements["presetType"]).forEach((function(e){if(e.checked){t=e.value}}))}return t}},{key:"showUnavailableToolPopup",value:function e(){if(!(babelHelpers.classPrivateFieldGet(this,N)instanceof s.MessageBox)){babelHelpers.classPrivateFieldSet(this,N,s.MessageBox.create({message:i.Loc.getMessage("MENU_UNAVAILABLE_TOOL_POPUP_DESCRIPTION"),buttons:s.MessageBoxButtons.OK}))}babelHelpers.classPrivateFieldGet(this,N).show()}}]);return n}(h);var O=function(e){babelHelpers.inherits(t,e);function t(){var e;var n;babelHelpers.classCallCheck(this,t);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++){a[r]=arguments[r]}n=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"menuId","leftMenuSettingsPopup");return n}babelHelpers.createClass(t,[{key:"createPopup",value:function e(){var t=new a.Menu({bindElement:this.container,items:this.getItems(),angle:true,offsetTop:0,offsetLeft:50});return t.getPopupWindow()}},{key:"getItems",value:function e(){var t=[];Array.from.apply(Array,babelHelpers.toConsumableArray(r.EventEmitter.emit(this,u.eventName("onGettingSettingMenuItems")))).forEach((function(e){var n=e.text,i=e.html,a=e.onclick,r=e.className;if(!n&&!i){return}t.push(Object.assign(i?{html:i}:{text:n},{className:["menu-popup-no-icon",r!==null&&r!==void 0?r:""].join(" "),onclick:function e(t,n){n.getMenuWindow().close();a(t,n)}}))}));return t}}]);return t}(h);var X=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"toggleMenu",value:function e(t){if(i.Loc.getMessage("USER_ID")<=0){return}return i.ajax.runAction("intranet.leftmenu.".concat(t?"collapseMenu":"expandMenu"),{data:{},analyticsLabel:{leftmenu:{action:t?"collapseMenu":"expandMenu"}}})}},{key:"saveSelfItemMenu",value:function e(t){var n=t.id>0?"update":"add";return i.ajax.runAction("intranet.leftmenu.".concat(n,"SelfItem"),{data:{itemData:t},analyticsLabel:{leftmenu:{action:"selfItemAddOrUpdate"}}})}},{key:"deleteSelfITem",value:function e(t){return i.ajax.runAction("intranet.leftmenu.deleteSelfItem",{data:{menuItemId:t},analyticsLabel:{leftmenu:{action:"selfItemDelete"}}})}},{key:"addFavoritesItemMenu",value:function e(t){return i.ajax.runAction("intranet.leftmenu.addStandartItem",{data:{itemData:t},analyticsLabel:{leftmenu:{action:"standardItemAdd"}}})}},{key:"deleteFavoritesItemMenu",value:function e(t){return i.ajax.runAction("intranet.leftmenu.deleteStandartItem",{data:{itemData:t},analyticsLabel:{leftmenu:{action:"standardItemDelete"}}})}},{key:"updateFavoritesItemMenu",value:function e(t){return i.ajax.runAction("intranet.leftmenu.updateStandartItem",{data:{itemText:t.text,itemId:t.id},analyticsLabel:{leftmenu:{action:"standardItemUpdate"}}})}},{key:"addAdminSharedItemMenu",value:function e(t){return i.ajax.runAction("intranet.leftmenu.addItemToAll",{data:{itemInfo:t},analyticsLabel:{leftmenu:{action:"adminItemAdd"}}})}},{key:"deleteAdminSharedItemMenu",value:function e(t){return i.ajax.runAction("intranet.leftmenu.deleteItemFromAll",{data:{menu_item_id:t},analyticsLabel:{leftmenu:{action:"adminItemDelete"}}})}},{key:"saveItemsSort",value:function e(t,n,a){return i.ajax.runAction("intranet.leftmenu.saveItemsSort",{data:{items:t,firstItemLink:n,version:u.version},analyticsLabel:{leftmenu:a}})}},{key:"setFirstPage",value:function e(t){return i.ajax.runAction("intranet.leftmenu.setFirstPage",{data:{firstPageUrl:t},analyticsLabel:{leftmenu:{action:"mainPageIsSet"}}})}},{key:"setDefaultPreset",value:function e(){return i.ajax.runAction("intranet.leftmenu.setDefaultMenu",{data:{},analyticsLabel:{leftmenu:{action:"defaultMenuIsSet"}}})}},{key:"setCustomPreset",value:function e(t,n,a,r){return i.ajax.runAction("intranet.leftmenu.saveCustomPreset",{data:{userApply:t===true?"newUser":"currentUser",itemsSort:n,customItems:a,firstItemLink:r,version:u.version},analyticsLabel:{leftmenu:{action:"customPresetIsSet"}}})}},{key:"deleteCustomItem",value:function e(t){return i.ajax.runAction("intranet.leftmenu.deleteCustomItemFromAll",{data:{menu_item_id:t},analyticsLabel:{leftmenu:{action:"customItemDelete"}}})}},{key:"setSystemPreset",value:function e(t,n){return i.ajax.runAction("intranet.leftmenu.setPreset",{data:{preset:n,mode:t==="global"?"global":"personal"},analyticsLabel:{leftmenu:{action:"systemPresetIsSet",presetId:n,mode:t,analyticsFirst:t==="global"?"y":"n"}}})}},{key:"postponeSystemPreset",value:function e(t){return i.ajax.runAction("intranet.leftmenu.delaySetPreset",{data:{},analyticsLabel:{leftmenu:{action:"systemPresetIsPostponed",mode:t,analyticsFirst:t==="global"?"y":"n"}}})}},{key:"clearCache",value:function e(){return i.ajax.runAction("intranet.leftmenu.clearCache",{data:{},analyticsLabel:{leftmenu:{action:"clearCache"}}})}},{key:"expandGroup",value:function e(t){if(i.Loc.getMessage("USER_ID")<=0){return}return i.ajax.runAction("intranet.leftmenu.expandMenuGroup",{data:{id:t},analyticsLabel:{leftmenu:{action:"expandMenuGroup"}}})}},{key:"collapseGroup",value:function e(t){if(i.Loc.getMessage("USER_ID")<=0){return}return i.ajax.runAction("intranet.leftmenu.collapseMenuGroup",{data:{id:t},analyticsLabel:{leftmenu:{action:"collapseMenuGroup"}}})}}]);return e}();var F,R,q,G;var W=function(){function e(t,n){var i=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"links",[]);babelHelpers.defineProperty(this,"isDraggable",true);babelHelpers.defineProperty(this,"storage",[]);this.parentContainer=t;this.container=n;this.init();this.onDeleteAsFavorites=this.onDeleteAsFavorites.bind(this);setTimeout((function(){r.EventEmitter.subscribe(r.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),i.onDeleteAsFavorites);r.EventEmitter.incrementMaxListeners(r.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"));r.EventEmitter.subscribe(i,u.eventName("onItemDelete"),i.destroy.bind(i))}),0);this.showError=this.showError.bind(this);this.showMessage=this.showMessage.bind(this)}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.container.dataset.id}},{key:"getCode",value:function e(){return this.constructor.code}},{key:"getName",value:function e(){return this.container.querySelector("[data-role='item-text']").textContent}},{key:"canDelete",value:function e(){return false}},{key:"delete",value:function e(){}},{key:"init",value:function e(){var t=this;this.links=[];if(this.container.hasAttribute("data-link")&&i.Type.isStringFilled(this.container.getAttribute("data-link"))){this.links.push(this.container.getAttribute("data-link"))}if(this.container.hasAttribute("data-all-links")){this.container.getAttribute("data-all-links").split(",").forEach((function(e){e=String(e).trim();if(i.Type.isStringFilled(e)){t.links.push(e)}}))}this.makeTextIcons();this.storage=this.container.dataset.storage.split(",")}},{key:"update",value:function e(t){var n=t.link,a=t.openInNewPage,r=t.text;a=a==="Y"?"Y":"N";if(this.container.hasAttribute("data-link")){this.container.setAttribute("data-link",i.Text.encode(n));this.container.setAttribute("data-new-page",a)}var s=this.container.querySelector("a");if(s){if(i.Type.isString(n)){s.setAttribute("href",i.Text.encode(n))}s.setAttribute("target",a==="Y"?"_blank":"_self")}this.container.querySelector("[data-role='item-text']").innerHTML=i.Text.encode(r);this.init()}},{key:"destroy",value:function e(){r.EventEmitter.unsubscribe(r.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);r.EventEmitter.decrementMaxListeners(r.EventEmitter.GLOBAL_TARGET,"onItemDeleteAsFavorites")}},{key:"getSimilarToUrl",value:function e(t){var n=this;var i=[];this.links.forEach((function(e,a){if(j(e,t)){var r=0;if(a===0){r=n.getCode()==="default"?2:1}i.push({priority:r,url:e})}}));return i}},{key:"makeTextIcons",value:function e(){if(!this.container.classList.contains("menu-item-no-icon-state")){return}var t=this.container.querySelector(".menu-item-icon");var n=this.container.querySelector(".menu-item-link-text");if(t&&n){t.textContent=V(n.textContent)}}},{key:"getCounterValue",value:function e(){var t=this.container.querySelector('[data-role="counter"]');if(!t){return null}return parseInt(t.dataset.counterValue)}},{key:"updateCounter",value:function e(t){var n=this.container.querySelector('[data-role="counter"]');if(!n){return}var i=parseInt(n.dataset.counterValue)||0;n.dataset.counterValue=t;if(t>0){n.innerHTML=t>99?"99+":t;this.container.classList.add("menu-item-with-index")}else{n.innerHTML="";this.container.classList.remove("menu-item-with-index");if(t<0){var a=BX("menu-counter-warning-"+this.getId());if(a){a.style.display="inline-block"}}}return{oldValue:i,newValue:t}}},{key:"markAsActive",value:function e(){console.error("This action is only for the group")}},{key:"showWarning",value:function e(t,n){this.removeWarning();var a=this.container.querySelector("a.menu-item-link");if(!a){return}t=t?i.Text.encode(t):"";var r=i.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(['<a class="menu-post-warn-icon" title="','"></a>'])),t);if(n){Object.keys(n).forEach((function(e){i.Event.bind(r,e,n[e])}))}this.container.classList.add("menu-item-warning-state");a.appendChild(r)}},{key:"removeWarning",value:function e(){if(!this.container.classList.contains("menu-item-warning-state")){return}this.container.classList.remove("menu-item-warning-state");var t;while(t=this.container.querySelector("a.menu-post-warn-icon")){t.parentNode.removeChild(t)}}},{key:"showMessage",value:function e(t){var n=this;if(this.showMessagePopup){this.showMessagePopup.close()}this.showMessagePopup=a.PopupManager.create("left-menu-message",this.container,{content:'<div class="left-menu-message-popup">'+t+"</div>",darkMode:true,offsetTop:2,offsetLeft:0,angle:true,events:{onClose:function e(){n.showMessagePopup=null}},autoHide:true});this.showMessagePopup.show();setTimeout((function(){if(n.showMessagePopup){n.showMessagePopup.close()}}),3e3)}},{key:"showError",value:function e(t){var n=[];if(t.errors){n.push(t.errors[0].message)}else if(t instanceof TypeError){n.push(t.message)}var a=[i.Loc.getMessage("MENU_ERROR_OCCURRED")].concat(n).join(" ");this.showMessage(a)}},{key:"getDropDownActions",value:function e(){return[]}},{key:"getEditFields",value:function e(){return{id:this.getId(),text:this.getName()}}},{key:"onDeleteAsFavorites",value:function e(t){var n=t.data;if(String(n.id)===String(this.getId())){if(this.getCode()==="standard"){r.EventEmitter.emit(this,u.eventName("onItemDelete"),{item:this,animate:true})}else{this.storage=babelHelpers.toConsumableArray(this.storage).filter((function(e){return e!=="standard"}));this.container.dataset.storage=this.storage.join(",")}r.EventEmitter.unsubscribe(r.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);r.EventEmitter.decrementMaxListeners(r.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"))}}}],[{key:"detect",value:function e(t){return t.getAttribute("data-role")!=="group"&&t.getAttribute("data-type")===this.code}},{key:"createNode",value:function e(t){var n=t.id,a=t.text,r=t.link,s=t.openInNewPage,o=t.counterId,l=t.counterValue,u=t.topMenuId;n=i.Text.encode(n);a=i.Text.encode(a);r=i.Text.encode(r);o=o?i.Text.encode(o):"";l=l?parseInt(l):0;s=s==="Y"?"Y":"N";return i.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['<li \n\t\t\tid="bx_left_menu_','" \n\t\t\tdata-status="show" \n\t\t\tdata-id="','" \n\t\t\tdata-role="item"\n\t\t\tdata-storage="" \n\t\t\tdata-counter-id="','" \n\t\t\tdata-link="','" \n\t\t\tdata-all-links="" \n\t\t\tdata-type="','" \n\t\t\tdata-delete-perm="Y" \n\t\t\t','\n\t\t\tdata-new-page="','" \n\t\t\tclass="menu-item-block menu-item-no-icon-state">\n\t\t\t\t<span class="menu-favorites-btn menu-favorites-draggable">\n\t\t\t\t\t<span class="menu-fav-draggable-icon"></span>\n\t\t\t\t</span>\n\t\t\t\t<a class="menu-item-link" data-slider-ignore-autobinding="true" href="','" target="','">\n\t\t\t\t\t<span class="menu-item-icon-box">\n\t\t\t\t\t\t<span class="menu-item-icon">W</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="menu-item-link-text " data-role="item-text">',"</span>\n\t\t\t\t\t",'\n\t\t\t\t</a>\n\t\t\t\t<span data-role="item-edit-control" class="menu-fav-editable-btn menu-favorites-btn">\n\t\t\t\t\t<span class="menu-favorites-btn-icon"></span>\n\t\t\t\t</span>\n\t\t\t</li>'])),n,n,o,r,this.code,u?'data-top-menu-id="'.concat(i.Text.encode(u),'"'):"",s,r,s==="Y"?"_blank":"_self",a,o?'<span class="menu-item-index-wrap">\n\t\t\t\t\t\t<span data-role="counter"\n\t\t\t\t\t\t\tdata-counter-value="'.concat(l,'" class="menu-item-index" id="menu-counter-').concat(o,'">').concat(l,"</span>\n\t\t\t\t\t</span>"):"")}},{key:"backendSaveItem",value:function e(t){throw"Function backendSaveItem must be replaced"}},{key:"showUpdate",value:function e(t){var n=this;return new Promise((function(e,i){n.showForm(t.container,t.getEditFields(),e,i)}))}},{key:"checkForm",value:function e(t){if(String(t.elements["text"].value).trim().length<=0){t.elements["text"].classList.add("menu-form-input-error");t.elements["text"].focus();return false}if(t.elements["link"]){if(String(t.elements["link"].value).trim().length<=0||P.refineUrl(t.elements["link"].value).length<=0){t.elements["link"].classList.add("menu-form-input-error");t.elements["link"].focus();return false}else{t.elements["link"].value=P.refineUrl(t.elements["link"].value)}}return true}},{key:"showForm",value:function e(n,r,s,o){var l=this;if(this.popup){this.popup.close()}var u=r.id!=="";var c=i.Tag.render(q||(q=babelHelpers.taggedTemplateLiteral(['\n<form name="menuAddToFavoriteForm">\n\t<input type="hidden" name="id" value="','">\n\t<label for="menuPageToFavoriteName" class="menu-form-label">','</label>\n\t<input name="text" type="text" id="menuPageToFavoriteName" class="menu-form-input" value="','" >\n\t',"\n\t","\n</form>"])),i.Text.encode(r.id||""),i.Loc.getMessage("MENU_ITEM_NAME"),i.Text.encode(r.text||""),r["link"]!==undefined?'<br><br>\n\t<label for="menuPageToFavoriteLink" class="menu-form-label">'.concat(i.Loc.getMessage("MENU_ITEM_LINK"),'</label>\n\t<input name="link" id="menuPageToFavoriteLink" type="text" class="menu-form-input" value="').concat(i.Text.encode(r.link),'" >'):"",r["openInNewPage"]!==undefined?'<br><br>\n\t<input name="openInNewPage" id="menuOpenInNewPage" type="checkbox" value="Y" '.concat(r.openInNewPage==="Y"?"checked":"",' >\n\t<label for="menuOpenInNewPage" class="menu-form-label">').concat(i.Loc.getMessage("MENU_OPEN_IN_NEW_PAGE"),"</label>"):"");Object.keys(r).forEach((function(e){if(["id","text","link","openInNewPage"].indexOf(e)<0){var t=i.Text.encode(e);var n=i.Text.encode(r[e]);c.appendChild(i.Tag.render(G||(G=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="','">'])),t,n))}}));this.popup=a.PopupManager.create("menu-self-item-popup",n,{className:"menu-self-item-popup",titleBar:r["link"]===undefined?i.Loc.getMessage("MENU_RENAME_ITEM"):u?i.Loc.getMessage("MENU_EDIT_SELF_PAGE"):i.Loc.getMessage("MENU_ADD_SELF_PAGE"),offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,content:c,buttons:[new t.SaveButton({onclick:function e(){if(l.checkForm(c)){var t={};babelHelpers.toConsumableArray(c.elements).forEach((function(e){t[e.name]=e.value}));if(c.elements["openInNewPage"]){t["openInNewPage"]=c.elements["openInNewPage"].checked?"Y":"N"}l.backendSaveItem(t).then((function(){s(t);l.popup.close()}))["catch"](P.catchError)}}}),new t.CancelButton({onclick:function e(){l.popup.close()}})]});this.popup.show()}}]);return e}();babelHelpers.defineProperty(W,"code","abstract");function j(e,t){var n=new i.Uri(e);var a=n.getPath().replace("/index.php","").replace("/index.html","");var r=t.getPath().replace("/index.php","").replace("/index.html","");if(n.getHost()!==""&&n.getHost()!==t.getHost()){return false}if(r.indexOf(a)!==0){return false}return true}function V(e){if(!i.Type.isStringFilled(e)){return"..."}e=e.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(e.length<=0){return"..."}var t;var n=e.split(/[\s,]+/);if(n.length<=1){t=e.substring(0,1)}else if(n.length===2){t=n[0].substring(0,1)+n[1].substring(0,1)}else{var a=n[0];var r=n[1];for(var s=1;s<n.length;s++){if(n[s].length>3){r=n[s];break}}t=a.substring(0,1)+r.substring(0,1)}return t.toUpperCase()}function z(e,t,n,i){Q(e,t);K(n,"set");Y(e,n,i);return i}function Y(e,t,n){if(t.set){t.set.call(e,n)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=n}}function J(e,t,n){Q(e,t);K(n,"get");return $(e,n)}function K(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function Q(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function $(e,t){if(t.get){return t.get.call(e)}return t.value}var Z=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"canDelete",value:function e(){return true}},{key:"delete",value:function e(){var t=this;X.deleteFavoritesItemMenu({id:this.getId(),storage:this.storage}).then((function(){t.destroy();r.EventEmitter.emit(t,u.eventName("onItemDelete"),{animate:true});var e=t.getSimilarToUrl(P.getCurUri()).length>0?window:{doesnotmatter:""};BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[{id:t.getId()},t]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false,context:e}])}))}},{key:"getDropDownActions",value:function e(){var n=this;var a=[];a.push({text:i.Loc.getMessage("MENU_RENAME_ITEM"),onclick:function e(){n.constructor.showUpdate(n).then(n.update.bind(n))["catch"](n.showError)}});a.push({text:i.Loc.getMessage("MENU_REMOVE_STANDARD_ITEM"),onclick:function e(){n["delete"]()}});if(u.isAdmin){a.push({text:i.Loc.getMessage("MENU_ADD_ITEM_TO_ALL"),onclick:function e(){var a=n.container.querySelector("a");X.addAdminSharedItemMenu({id:n.getId(),link:n.links[0],text:n.getName(),counterId:n.container.dataset.counterId,openInNewPage:a&&a.getAttribute("target")==="_blank"?"Y":"N"}).then((function(){n.showMessage(i.Loc.getMessage("MENU_ITEM_WAS_ADDED_TO_ALL"));n.container.dataset.type=ne.code;n.storage.push(t.code);n.container.dataset.storage=n.storage.join(",");r.EventEmitter.emit(n,u.eventName("onItemConvert"),n)}))["catch"](n.showError)}})}return a}}],[{key:"backendSaveItem",value:function e(t){return X.updateFavoritesItemMenu(t)}},{key:"getActiveTopMenuItem",value:function e(){if(J(this,t,ee)){return J(this,t,ee)}if(!BX.Main||!BX.Main.interfaceButtonsManager){return null}var n=Array.from(Object.values(BX.Main.interfaceButtonsManager.getObjects())).shift();if(n){var i=n.getActive();if(i&&babelHelpers["typeof"](i)==="object"){var a=document.createElement("a");a.href=i["URL"];var r=a.pathname[0]!=="/"?"/"+a.pathname:a.pathname;z(this,t,ee,{ID:i["ID"]||null,NODE:i["NODE"]||null,URL:r+a.search,TEXT:i["TEXT"],DATA_ID:i["DATA_ID"],COUNTER_ID:i["COUNTER_ID"],COUNTER:i["COUNTER"],SUB_LINK:i["SUB_LINK"]})}}return J(this,t,ee)}},{key:"isCurrentPageStandard",value:function e(t){if(t&&t["URL"]){var n=document.location.pathname+document.location.search;return t.URL===n&&t.URL.indexOf("workgroups")<0}return false}},{key:"saveCurrentPage",value:function e(t){var n=this;var i=t.pageTitle,a=t.pageLink;var r=this.getActiveTopMenuItem();var s,o,l;if(r&&r.NODE&&this.isCurrentPageStandard(r)&&(a===P.getCurPage()||a===r.URL||!a)){var u=r.NODE.getBoundingClientRect();o=u.left;l=u.top;s={id:r.DATA_ID,text:i||r.TEXT,link:P.getCurPage()||r.URL,counterId:r.COUNTER_ID,counterValue:r.COUNTER,isStandardItem:true,subLink:r.SUB_LINK}}else{s={text:i||document.getElementById("pagetitle").innerText,link:a||P.getCurPage(),isStandardItem:a===P.getCurPage()};var c=BX("pagetitle").getBoundingClientRect();o=c.left;l=c.top}return X.addFavoritesItemMenu(s).then((function(e){var t=e.data.itemId;s.id=t;s.topMenuId=s.id;return{node:n.createNode(s),animateFromPoint:{startX:o,startY:l},itemInfo:s}}))}},{key:"deleteCurrentPage",value:function e(t){var n=t.pageLink;var i=this.getActiveTopMenuItem();var a={},s,o;if(i&&this.isCurrentPageStandard(i)){a["id"]=i.DATA_ID;var l=i.NODE.getBoundingClientRect();s=l.left;o=l.top}else{a["link"]=n||P.getCurPage();var c=BX("pagetitle").getBoundingClientRect();s=c.left;o=c.top}return X.deleteFavoritesItemMenu(a).then((function(e){var t=e.data;if(!a.id&&t&&t["itemId"]){a.id=t["itemId"]}r.EventEmitter.emit(r.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),{id:a.id});return{itemInfo:a,animateToPoint:{startX:s,startY:o}}}))}},{key:"saveStandardPage",value:function e(t){var n=this;var i=t.DATA_ID,a=t.TEXT,r=t.SUB_LINK,s=t.COUNTER_ID,o=t.COUNTER,l=t.NODE,u=t.URL;var c={id:i,text:a,link:u,subLink:r,counterId:s,counterValue:o};var d=l.getBoundingClientRect();var m=d.left;var h=d.top;return X.addFavoritesItemMenu(c).then((function(e){var t=e.data.itemId;c.id=t;c.topMenuId=c.id;var a=n.getActiveTopMenuItem();BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[c,n]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:true,context:a&&a.DATA_ID===i?window:null}]);return{node:n.createNode(c),animateFromPoint:{startX:m,startY:h}}}))}},{key:"deleteStandardPage",value:function e(t){var n=this;var i=t.DATA_ID;var a={id:i};return X.deleteFavoritesItemMenu(a).then((function(){r.EventEmitter.emit(r.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),{id:a.id});BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[a,n]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false}]);return{itemInfo:a}}))}}]);return t}(W);babelHelpers.defineProperty(Z,"code","standard");var ee={writable:true,value:null};var te=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"canDelete",value:function e(){return true}},{key:"delete",value:function e(){var t=this;return X.deleteSelfITem(this.getId()).then((function(){if(t.storage.indexOf(Z.code)>=0){X.deleteFavoritesItemMenu({id:t.getId()})}r.EventEmitter.emit(t,u.eventName("onItemDelete"),{animate:true})}))["catch"](this.showError)}},{key:"getDropDownActions",value:function e(){var n=this;var a=[];a.push({text:i.Loc.getMessage("MENU_EDIT_ITEM"),onclick:function e(){n.constructor.showUpdate(n).then(n.update.bind(n))["catch"](n.showError)}});a.push({text:i.Loc.getMessage("MENU_DELETE_SELF_ITEM"),onclick:function e(){s.MessageBox.confirm(i.Loc.getMessage("MENU_DELETE_SELF_ITEM_CONFIRM"),i.Loc.getMessage("MENU_DELETE_SELF_ITEM"),(function(e){n["delete"]();e.close()}),i.Loc.getMessage("MENU_DELETE"))}});if(u.isAdmin){a.push({text:i.Loc.getMessage("MENU_ADD_ITEM_TO_ALL"),onclick:function e(){var a=n.container.querySelector("a");X.addAdminSharedItemMenu({id:n.getId(),link:n.links[0],text:n.getName(),counterId:n.container.dataset.counterId,openInNewPage:a&&a.getAttribute("target")==="_blank"?"Y":"N"}).then((function(){n.showMessage(i.Loc.getMessage("MENU_ITEM_WAS_ADDED_TO_ALL"));n.container.dataset.type=ne.code;n.storage.push(t.code);n.container.dataset.storage=n.storage.join(",");r.EventEmitter.emit(n,u.eventName("onItemConvert"),n)}))["catch"](n.showError)}})}return a}},{key:"getEditFields",value:function e(){return{id:this.getId(),text:this.getName(),link:this.links[0],openInNewPage:this.container.getAttribute("data-new-page")}}}],[{key:"backendSaveItem",value:function e(t){return X.saveSelfItemMenu(t).then((function(e){var n=e.data;if(n&&n["itemId"]){t.id=n["itemId"]}return t}))}},{key:"showAdd",value:function e(t){var n=this;return new Promise((function(e,i){n.showForm(t,{id:0,name:"",link:"",openInNewPage:"Y"},e,i)})).then((function(e){return{node:n.createNode(e)}}))}}]);return t}(W);babelHelpers.defineProperty(te,"code","self");var ne=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"canDelete",value:function e(){return this.container.dataset.deletePerm==="Y"}},{key:"delete",value:function e(){var t=this;X.deleteAdminSharedItemMenu(this.getId()).then((function(){if(t.storage.indexOf(Z.code)>=0){X.deleteFavoritesItemMenu({id:t.getId()})}if(t.storage.indexOf(te.code)>=0){X.deleteSelfITem(t.getId())}r.EventEmitter.emit(t,u.eventName("onItemDelete"),{animate:true})}))["catch"](this.showError)}},{key:"getDropDownActions",value:function e(){var t=this;if(!this.canDelete()){return[]}var n=[];if(this.storage.filter((function(e){return e===Z.code||e===te.code})).length>0){n.push({text:i.Loc.getMessage("MENU_REMOVE_STANDARD_ITEM"),onclick:this["delete"].bind(this)});n.push({text:i.Loc.getMessage("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),onclick:function e(){X.deleteAdminSharedItemMenu(t.getId()).then((function(){t.showMessage(i.Loc.getMessage("MENU_ITEM_WAS_DELETED_FROM_ALL"));var e=t.storage.indexOf(te.code)>=0?te.code:Z.code;t.container.dataset.type=e;t.container.dataset.storage=t.storage.filter((function(t){return t!==e})).join(",");r.EventEmitter.emit(t,u.eventName("onItemConvert"),t)}))["catch"](t.showError)}})}else{n.push({text:i.Loc.getMessage("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),onclick:this["delete"].bind(this)})}return n}}]);return t}(W);babelHelpers.defineProperty(ne,"code","admin");var ie=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"canDelete",value:function e(){return this.container.dataset.deletePerm==="Y"}},{key:"delete",value:function e(){var t=this;if(this.canDelete()){X.deleteCustomItem(this.getId()).then((function(){if(t.storage.indexOf(Z.code)>=0){X.deleteFavoritesItemMenu({id:t.getId()})}r.EventEmitter.emit(t,u.eventName("onItemDelete"),{animate:true})}))["catch"](this.showError)}}},{key:"getDropDownActions",value:function e(){var t=[];if(this.canDelete()){t.push({text:i.Loc.getMessage("MENU_DELETE_ITEM_FROM_ALL"),onclick:this["delete"].bind(this)})}return t}}]);return t}(W);babelHelpers.defineProperty(ie,"code","custom");var ae=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"canDelete",value:function e(){return false}},{key:"openSettings",value:function e(){var t="".concat(i.Loc.getMessage("mainpage_settings_path"),"&analyticContext=left_menu");BX.SidePanel.Instance.open(t)}}]);return t}(W);babelHelpers.defineProperty(ae,"code","main");var re=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"canDelete",value:function e(){return false}}]);return t}(W);babelHelpers.defineProperty(re,"code","default");function se(e,t,n){oe(e,t);t.set(e,n)}function oe(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var le=new WeakMap;var ue=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments));se(babelHelpers.assertThisInitialized(e),le,{writable:true,value:void 0});e.container.addEventListener("click",e.toggleAndSave.bind(babelHelpers.assertThisInitialized(e)),true);e.container.addEventListener("mouseleave",(function(){i.Dom.removeClass(e.container,"menu-item-group-actioned")}));e.groupContainer=e.container.parentNode.querySelector('[data-group-id="'.concat(e.getId(),'"]'));if(e.container.getAttribute("data-collapse-mode")==="collapsed"){e.groupContainer.style.display="none"}setTimeout((function(){e.updateCounter()}),0);return e}babelHelpers.createClass(t,[{key:"toggleAndSave",value:function e(t){var n=this;t.preventDefault();t.stopPropagation();if(this.container.getAttribute("data-collapse-mode")==="collapsed"){X.expandGroup(this.getId());this.expand().then((function(){n.container.setAttribute("data-collapse-mode","expanded")}))}else{X.collapseGroup(this.getId());this.collapse().then((function(){n.container.setAttribute("data-collapse-mode","collapsed")}))}return false}},{key:"checkAndCorrect",value:function e(){var t=this;var n=this.groupContainer;if(n.parentNode===this.container){i.Dom.insertAfter(n,this.container)}babelHelpers.toConsumableArray(n.querySelectorAll(".menu-item-block")).forEach((function(e){e.setAttribute("data-status",t.container.getAttribute("data-status"))}));return this}},{key:"collapse",value:function e(t){var n=this;return new Promise((function(e){var a=n.groupContainer;if(babelHelpers.classPrivateFieldGet(n,le)){babelHelpers.classPrivateFieldGet(n,le).stop()}a.style.overflow="hidden";i.Dom.addClass(n.container,"menu-item-group-collapsing");i.Dom.addClass(n.container,"menu-item-group-actioned");i.Dom.addClass(a,"menu-item-group-collapsing");var r={height:a.offsetHeight,display:a.style.display};babelHelpers.classPrivateFieldSet(n,le,new BX.easing({duration:500,start:{height:r.height,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){a.style.height=t.height+"px";a.style.opacity=t.opacity/100},complete:function r(){a.style.display="none";a.style.opacity="auto";a.style.height="auto";if(n.container.getAttribute("data-contains-active-item")==="Y"){i.Dom.addClass(n.container,"menu-item-active")}i.Dom.removeClass(n.container,"menu-item-group-collapsing");i.Dom.removeClass(a,"menu-item-group-collapsing");babelHelpers.classPrivateFieldSet(n,le,null);if(t===true){n.container.appendChild(a)}e()}}));babelHelpers.classPrivateFieldGet(n,le).animate()}))}},{key:"expand",value:function e(t){var n=this;return new Promise((function(e){var a=n.container;var r=n.groupContainer;if(t===true&&a.getAttribute("data-collapse-mode")==="collapsed"){return e()}var s=r.querySelectorAll("li").length*a.offsetHeight;i.Dom.addClass(a,"menu-item-group-expanding");i.Dom.addClass(a,"menu-item-group-actioned");i.Dom.addClass(r,"menu-item-group-expanding");if(r.parentNode===n.container){i.Dom.insertAfter(r,n.container)}r.style.display="block";babelHelpers.classPrivateFieldSet(n,le,new BX.easing({duration:500,start:{height:0,opacity:0},finish:{height:s,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){r.style.height=t.height+"px";r.style.opacity=t.opacity/100},complete:function t(){i.Dom.removeClass(a,"menu-item-group-expanding menu-item-active");i.Dom.removeClass(r,"menu-item-group-expanding");r.style.height="auto";r.style.opacity="auto";e()}}));babelHelpers.classPrivateFieldGet(n,le).animate()}))}},{key:"canDelete",value:function e(){return false}},{key:"updateCounter",value:function e(){var t=0;babelHelpers.toConsumableArray(this.container.parentNode.querySelector('[data-group-id="'.concat(this.getId(),'"]')).querySelectorAll('[data-role="counter"]')).forEach((function(e){t+=i.Text.toNumber(e.dataset.counterValue)}));var n=this.container.querySelector('[data-role="counter"]');if(t>0){n.innerHTML=t>99?"99+":t;this.container.classList.add("menu-item-with-index")}else{n.innerHTML="";this.container.classList.remove("menu-item-with-index")}}},{key:"markAsActive",value:function e(){this.container.setAttribute("data-contains-active-item","Y");if(this.container.getAttribute("data-collapse-mode")==="collapsed")i.Dom.addClass(this.container,"menu-item-active")}},{key:"markAsInactive",value:function e(){this.container.removeAttribute("data-contains-active-item");i.Dom.removeClass(this.container,"menu-item-active")}},{key:"isActive",value:function e(){return this.container.getAttribute("data-contains-active-item")==="Y"}}],[{key:"detect",value:function e(t){return t.getAttribute("data-role")==="group"&&t.getAttribute("data-type")===this.code}}]);return t}(W);babelHelpers.defineProperty(ue,"code","group");var ce=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments));e.container.querySelector('[data-role="item-edit-control"]').style.display="none";return e}return t}(ue);babelHelpers.defineProperty(ce,"code","system_group");var de=[W,ne,Z,ie,te,re,ue,ce,ae];function me(e){var t=W;de.forEach((function(n){if(n.detect(e)){t=n}}));return t}function he(e,t,n){fe(e,t);t.set(e,n)}function fe(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var pe=new WeakMap;var ve=new WeakMap;var ge=function(){function e(){babelHelpers.classCallCheck(this,e);he(this,pe,{writable:true,value:void 0});he(this,ve,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ve,new i.Uri(window.location.href))}babelHelpers.createClass(e,[{key:"checkAndSet",value:function e(t,n){var a=this;if(t===this.item){return false}var r=babelHelpers.classPrivateFieldGet(this,pe);n.forEach((function(e){var t=new i.Uri(e.url);var n=false;if(!r||r.uri.getPath().length<t.getPath().length){n=true}else if(r.uri.getPath().length===t.getPath().length){var s=babelHelpers.classPrivateFieldGet(a,ve).getQueryParams();var o={params:r.uri.getQueryParams(),matches:0};var l={params:t.getQueryParams(),matches:0};for(var u=0,c=Object.keys(s);u<c.length;u++){var d=c[u];if(d in s&&d in o.params&&String(s[d])===String(o.params[d])){o.matches++}if(d in s&&d in l.params&&String(s[d])===String(l.params[d])){l.matches++}}if(l.matches>o.matches||l.matches===o.matches&&Object.keys(l.params).length<Object.keys(o.params).length||r.priority<e.priority){n=true}}if(n){r={priority:e.priority,url:e.url,uri:t}}}));if(r!==babelHelpers.classPrivateFieldGet(this,pe)){if(this.item){this.unhighlight(this.item)}babelHelpers.classPrivateFieldSet(this,pe,r);this.item=t;this.highlight();return true}return false}},{key:"checkAndUnset",value:function e(t){if(t instanceof W&&t===this.item){this.unhighlight(this.item);this.item=null;babelHelpers.classPrivateFieldSet(this,pe,null)}}},{key:"highlight",value:function e(){if(this.item){this.item.container.classList.add("menu-item-active");var t=this.item.container.closest('[data-role="group-content"]');var n;while(t){n=t.parentNode.querySelector('[data-id="'.concat(t.getAttribute("data-group-id"),'"]'));if(n){n.setAttribute("data-contains-active-item","Y");if(n.getAttribute("data-collapse-mode")==="collapsed"){n.classList.add("menu-item-active")}}t=t.closest('[data-relo="group-content"]')}}}},{key:"unhighlight",value:function e(t){if(!(t instanceof W)){t=this.item}if(t instanceof W){t.container.classList.remove("menu-item-active");var n=t.container.closest('[data-role="group-content"]');var i;while(n){i=n.parentNode.querySelector('[data-id="'.concat(n.getAttribute("data-group-id"),'"]'));if(i){i.removeAttribute("data-contains-active-item");i.classList.remove("menu-item-active")}n=n.closest('[data-relo="group-content"]')}return t}return null}}]);return e}();function be(e,t){Ee(e,t);t.add(e)}function ye(e,t,n){Ee(e,t);t.set(e,n)}function Ee(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ke(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var Ce=new WeakMap;var Me=new WeakMap;var Ie=new WeakSet;var Se=new WeakSet;var Te=new WeakSet;var we=new WeakSet;var Le=new WeakSet;var Ae=new WeakMap;var Pe=new WeakSet;var He=new WeakSet;var Be=new WeakSet;var xe=new WeakSet;var De=new WeakSet;var Ne=new WeakMap;var _e=new WeakSet;var Ue=new WeakSet;var Oe=new WeakSet;var Xe=new WeakSet;var Fe=new WeakSet;var Re=new WeakSet;var qe=new WeakSet;var Ge=function(e){babelHelpers.inherits(t,e);function t(e,n){var i;var a=n.events;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,{events:a}));be(babelHelpers.assertThisInitialized(i),qe);be(babelHelpers.assertThisInitialized(i),Re);be(babelHelpers.assertThisInitialized(i),Fe);be(babelHelpers.assertThisInitialized(i),Xe);be(babelHelpers.assertThisInitialized(i),Oe);be(babelHelpers.assertThisInitialized(i),Ue);be(babelHelpers.assertThisInitialized(i),_e);be(babelHelpers.assertThisInitialized(i),De);be(babelHelpers.assertThisInitialized(i),xe);be(babelHelpers.assertThisInitialized(i),Be);be(babelHelpers.assertThisInitialized(i),He);be(babelHelpers.assertThisInitialized(i),Pe);be(babelHelpers.assertThisInitialized(i),Le);be(babelHelpers.assertThisInitialized(i),we);be(babelHelpers.assertThisInitialized(i),Te);be(babelHelpers.assertThisInitialized(i),Se);be(babelHelpers.assertThisInitialized(i),Ie);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"items",new Map);ye(babelHelpers.assertThisInitialized(i),Ce,{writable:true,value:new ge});ye(babelHelpers.assertThisInitialized(i),Me,{writable:true,value:false});ye(babelHelpers.assertThisInitialized(i),Ae,{writable:true,value:null});ye(babelHelpers.assertThisInitialized(i),Ne,{writable:true,value:void 0});i.parentContainer=e;i.container=e.querySelector(".menu-items");i.hiddenContainer=e.querySelector("#left-menu-hidden-items-block");e.querySelectorAll("li.menu-item-block").forEach(i.registerItem.bind(babelHelpers.assertThisInitialized(i)));e.querySelector("#left-menu-hidden-separator").addEventListener("click",i.toggleHiddenContainer.bind(babelHelpers.assertThisInitialized(i)));if(i.getActiveItem()&&i.getActiveItem().container.getAttribute("data-status")==="hide"){ke(babelHelpers.assertThisInitialized(i),Ie,We).call(babelHelpers.assertThisInitialized(i),false)}return i}babelHelpers.createClass(t,[{key:"registerItem",value:function e(t){var n=this,i;var a=me(t);var s=new a(this.container,t);this.items.set(s.getId(),s);if(!(s instanceof ae)){ke(this,Oe,nt).call(this,s)}if(babelHelpers.classPrivateFieldGet(this,Ce).checkAndSet(s,s.getSimilarToUrl(P.getCurUri()))===true){var o=ke(this,xe,$e).call(this,s);while(o){o.markAsActive();o=ke(this,xe,$e).call(this,o)}}r.EventEmitter.subscribe(s,u.eventName("onItemDelete"),(function(e){var t=e.data;n.deleteItem(s,t)}));r.EventEmitter.subscribe(s,u.eventName("onItemConvert"),(function(e){var t=e.data;n.convertItem(s,t)}));babelHelpers.toConsumableArray(s.container.querySelectorAll("a")).forEach((function(e){e.addEventListener("click",(function(e){if(babelHelpers.classPrivateFieldGet(n,Me)===true){e.preventDefault();e.stopPropagation();return false}}),true)}));(i=s.container.querySelector('[data-role="item-edit-control"]'))===null||i===void 0?void 0:i.addEventListener("click",(function(e){n.openItemMenu(s,e.target)}));return s}},{key:"unregisterItem",value:function e(t){if(!this.items.has(t.getId())){return}this.items["delete"](t.getId());babelHelpers.classPrivateFieldGet(this,Ce).checkAndUnset(t,t.getSimilarToUrl(P.getCurUri()));r.EventEmitter.unsubscribeAll(t,u.eventName("onItemDelete"));r.EventEmitter.unsubscribeAll(t,u.eventName("onItemConvert"));t.container.parentNode.replaceChild(t.container.cloneNode(true),t.container)}},{key:"switchToEditMode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Me)){return}babelHelpers.classPrivateFieldSet(this,Me,true);r.EventEmitter.emit(this,u.eventName("EditMode"))}},{key:"switchToViewMode",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,Me)){return}babelHelpers.classPrivateFieldSet(this,Me,false);r.EventEmitter.emit(this,u.eventName("ViewMode"))}},{key:"isHiddenContainerVisible",value:function e(){return this.hiddenContainer.classList.contains("menu-item-favorites-more-open")}},{key:"toggleHiddenContainer",value:function e(t){if(this.hiddenContainer.classList.contains("menu-item-favorites-more-open")){ke(this,Se,je).call(this,t)}else{ke(this,Ie,We).call(this,t)}}},{key:"setItemAsAMainPage",value:function e(t){var n=this;var a=t.container;a.setAttribute("data-status","show");var r=a.offsetTop;var s=i.Dom.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:r}});var o=a.nextElementSibling;if(o){a.parentNode.insertBefore(s,o)}else{a.parentNode.appendChild(s)}s.appendChild(a);i.Dom.addClass(a,"menu-item-draggable");new BX.easing({duration:500,start:{top:r},finish:{top:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){s.style.top=t.top+"px"},complete:function e(){n.container.insertBefore(a,BX("left-menu-empty-item").nextSibling);i.Dom.removeClass(a,"menu-item-draggable");i.Dom.remove(s);ke(n,Be,Qe).call(n,{action:"mainPageIsSet",itemId:t.getId()})}}).animate()}},{key:"showItem",value:function e(t){var n=ke(this,xe,$e).call(this,t);var i=this.container;t.container.setAttribute("data-status","show");if(ke(this,De,Ze).call(this,t)){i.appendChild(t.container);ke(this,Le,Ye).call(this,t,n)}else if(n){i.appendChild(n.container);n.container.setAttribute("data-status","show");i.appendChild(n.groupContainer)}if(this.hiddenContainer.querySelector(".menu-item-block")===null){r.EventEmitter.emit(this,u.eventName("onHiddenBlockIsEmpty"));ke(this,Se,je).call(this,false)}ke(this,we,ze).call(this,t);ke(this,Be,Qe).call(this,{action:"showItem",itemId:t.getId()})}},{key:"hideItem",value:function e(t){var n=ke(this,xe,$e).call(this,t);var i=this.hiddenContainer.querySelector("#left-menu-hidden-items-list");var a=i.querySelector(".menu-item-block")===null;t.container.setAttribute("data-status","hide");if(ke(this,De,Ze).call(this,t)){i.appendChild(t.container);ke(this,Le,Ye).call(this,t,n)}else if(n){i.appendChild(n.container);n.container.setAttribute("data-status","hide");i.appendChild(n.groupContainer)}if(a){r.EventEmitter.emit(this,u.eventName("onHiddenBlockIsNotEmpty"))}ke(this,we,ze).call(this,t);ke(this,Be,Qe).call(this,{action:"hideItem",itemId:t.getId()})}},{key:"updateCounters",value:function e(t,n){var a=this;var r={};n=n!==false;babelHelpers.toConsumableArray(Object.entries(t)).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],s=t[1];babelHelpers.toConsumableArray(ke(a,Pe,Je).call(a,i)).forEach((function(e){var t=e.updateCounter(s),n=t.oldValue,o=t.newValue;var l=e.container.getAttribute("data-status");if((i.indexOf("crm_")<0||i.indexOf("crm_all")>=0)&&(i.indexOf("tasks_")<0||i.indexOf("tasks_total")>=0)){r[l]=r[l]||0;r[l]+=o-n}var u=ke(a,xe,$e).call(a,e);while(u){u.updateCounter();u=ke(a,xe,$e).call(a,u)}}));if(n){BX.localStorage.set("lmc-"+i,s,5)}}));if(r["hide"]!==undefined&&r["hide"]!==0){var s=this.parentContainer.querySelector("#menu-hidden-counter");s.dataset.counterValue=Math.max(0,Number(s.dataset.counterValue)+Number(r["hide"]));if(s.dataset.counterValue>0){s.classList.remove("menu-hidden-counter");s.innerHTML=s.dataset.counterValue>99?"99+":s.dataset.counterValue}else{s.classList.add("menu-hidden-counter");s.innerHTML=""}}if(typeof BXIM!=="undefined"){if(babelHelpers.classPrivateFieldGet(this,Ae)===null){babelHelpers.classPrivateFieldSet(this,Ae,0);babelHelpers.toConsumableArray(this.items.entries()).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],i=t[1];if(i instanceof ue){return}var r=i.getCounterValue();if(r>0){var s="doesNotMatter";if(n.indexOf("menu_crm")>=0||n.indexOf("menu_tasks")>=0){var o=i.container.querySelector('[data-role="counter"]');if(o){s=o.id}}if(s==="doesNotMatter"||s.indexOf("crm_all")>=0||s.indexOf("tasks_total")>=0){babelHelpers.classPrivateFieldSet(a,Ae,babelHelpers.classPrivateFieldGet(a,Ae)+r)}}}))}else{babelHelpers.classPrivateFieldSet(this,Ae,babelHelpers.classPrivateFieldGet(this,Ae)+(r["show"]!==undefined?r["show"]:0));babelHelpers.classPrivateFieldSet(this,Ae,babelHelpers.classPrivateFieldGet(this,Ae)+(r["hide"]!==undefined?r["hide"]:0))}var o=babelHelpers.classPrivateFieldGet(this,Ae)>99?"99+":babelHelpers.classPrivateFieldGet(this,Ae)<0?"0":babelHelpers.classPrivateFieldGet(this,Ae);var l=i.Reflection.getClass("BX.Messenger.v2.Lib.DesktopApi");if(l&&l.isDesktop()){l.setBrowserIconBadge(o)}}babelHelpers.toConsumableArray(this.items.entries()).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],i=t[1];if(i instanceof ue){i.updateCounter()}}))}},{key:"decrementCounter",value:function e(t){var n=this;babelHelpers.toConsumableArray(Object.entries(t)).forEach((function(e){var i=babelHelpers.slicedToArray(e,2),a=i[0],r=i[1];var s=ke(n,Pe,Je).call(n,a).shift();if(s){var o=s.getCounterValue();t[a]=o>r?o-r:0}else{delete t[a]}}));this.updateCounters(t,false)}},{key:"addItem",value:function e(t){var n=t.node,i=t.animateFromPoint;if(!(n instanceof Element)){return}var a=n.style.display;if(i){n.dataset.styleDisplay=n.style.display;n.style.display="none"}if(this.items.has(n.dataset.id)&&n.dataset.type===Z.code){var r=this.items.get(n.dataset.id);r.storage.push(Z.code);r.container.dataset.storage=r.storage.join(",");n=r.container}else{this.container.appendChild(n);this.registerItem(n);ke(this,Be,Qe).call(this)}if(i){ke(this,_e,et).call(this,n,i).then((function(){n.style.display=n.dataset.styleDisplay}))}}},{key:"updateItem",value:function e(t){var n=t.id;if(this.items.has(n)){this.items.get(n).update(t)}}},{key:"deleteItem",value:function e(t,n){var i=this;var a=n.animate;this.items["delete"](t.getId());babelHelpers.classPrivateFieldGet(this,Ce).checkAndUnset(t);if(t instanceof Z||a){ke(this,Ue,tt).call(this,t.container).then((function(){t.container.parentNode.removeChild(t.container);ke(i,Be,Qe).call(i)}))}else if(t.container){t.container.parentNode.removeChild(t.container);ke(this,Be,Qe).call(this)}}},{key:"convertItem",value:function e(t){this.unregisterItem(t);this.registerItem(this.parentContainer.querySelector('li.menu-item-block[data-id="'.concat(t.getId(),'"]')))}},{key:"getActiveItem",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ce).item}},{key:"export",value:function e(){return ke(this,He,Ke).call(this)}},{key:"openItemMenu",value:function e(t,n){var s=this;if(babelHelpers.classPrivateFieldGet(this,Ne)){babelHelpers.classPrivateFieldGet(this,Ne).close()}var o=[];if(t instanceof ae){o.push({text:i.Loc.getMessage("MENU_OPEN_SETTINGS_MAIN_PAGE"),onclick:function e(){t.openSettings()}})}else if(t.container.getAttribute("data-status")==="show"){o.push({text:i.Loc.getMessage("hide_item"),onclick:function e(){s.hideItem(t)}})}else{o.push({text:i.Loc.getMessage("show_item"),onclick:function e(n,i){s.showItem(t)}})}if(!u.isExtranet&&!u.isMainPageEnabled&&!(t instanceof te)&&!(t instanceof ue)&&this.container.querySelector('li.menu-item-block[data-role="item"]')!==t.container){o.push({text:i.Loc.getMessage("MENU_SET_MAIN_PAGE"),onclick:function e(){s.setItemAsAMainPage(t)}})}t.getDropDownActions().forEach((function(e){o.push(e)}));if(!(t instanceof ae)){o.push({text:babelHelpers.classPrivateFieldGet(this,Me)?i.Loc.getMessage("MENU_EDIT_READY_FULL"):i.Loc.getMessage("MENU_SETTINGS_MODE"),onclick:function e(){babelHelpers.classPrivateFieldGet(s,Me)?s.switchToViewMode():s.switchToEditMode()}})}o.forEach((function(e){var t;e["className"]=["menu-popup-no-icon",(t=e["className"])!==null&&t!==void 0?t:""].join(" ");var n=e.onclick;e["onclick"]=function(e,t){t.getMenuWindow().close();n.call(e,t)}}));babelHelpers.classPrivateFieldSet(this,Ne,new a.Menu({bindElement:n,items:o,offsetTop:0,offsetLeft:12,angle:true,events:{onClose:function e(){r.EventEmitter.emit(s,u.eventName("onClose"));t.container.classList.remove("menu-item-block-hover");babelHelpers.classPrivateFieldSet(s,Ne,null)},onShow:function e(){t.container.classList.add("menu-item-block-hover");r.EventEmitter.emit(s,u.eventName("onShow"))}}}));babelHelpers.classPrivateFieldGet(this,Ne).show()}},{key:"isEditMode",get:function e(){return babelHelpers.classPrivateFieldGet(this,Me)}}]);return t}(h);function We(e){r.EventEmitter.emit(this,u.eventName("onHiddenBlockIsVisible"));if(e===false){return this.hiddenContainer.classList.add("menu-item-favorites-more-open")}this.hiddenContainer.style.height="0px";this.hiddenContainer.style.opacity=0;ke(this,Te,Ve).call(this,true,this.hiddenContainer,this.hiddenContainer.scrollHeight)}function je(e){r.EventEmitter.emit(this,u.eventName("onHiddenBlockIsHidden"));if(e===false){return this.hiddenContainer.classList.remove("menu-item-favorites-more-open")}ke(this,Te,Ve).call(this,false,this.hiddenContainer,this.hiddenContainer.offsetHeight)}function Ve(e,t,n){t.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:n},finish:{opacity:e?100:0,height:e?n:0},transition:BX.easing.transitions.linear,step:function e(n){t.style.opacity=n.opacity/100;t.style.height=n.height+"px"},complete:function n(){if(e){t.classList.add("menu-item-favorites-more-open")}else{t.classList.remove("menu-item-favorites-more-open")}t.style.opacity="";t.style.overflow="";t.style.height=""}}).animate()}function ze(e){var t=0;if(e.container.querySelector('[data-role="counter"]')){t=e.container.querySelector('[data-role="counter"]').dataset.counterValue}if(t<=0){return}babelHelpers.toConsumableArray(this.items.entries()).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],i=t[1];if(i instanceof ue){i.updateCounter()}}));var n=0;babelHelpers.toConsumableArray(this.parentContainer.querySelectorAll(".menu-item-block[data-status=\"hide\"][data-role='item']")).forEach((function(e){var t=e.querySelector('[data-role="counter"]');if(t){n+=parseInt(t.dataset.counterValue)}}));var i=this.parentContainer.querySelector("#menu-hidden-counter");i.dataset.counterValue=Math.max(0,n);if(i.dataset.counterValue>0){i.classList.remove("menu-hidden-counter");i.innerHTML=i.dataset.counterValue>99?"99+":i.dataset.counterValue}else{i.classList.add("menu-hidden-counter");i.innerHTML=""}}function Ye(e,t){if(this.getActiveItem()!==e){return}var n=ke(this,xe,$e).call(this,e);if(t!==n){if(t instanceof ue){t.markAsInactive()}if(n instanceof ue){n.markAsActive()}}}function Je(e){var t=[];babelHelpers.toConsumableArray(this.items.values()).forEach((function(n){var i=n.container.querySelector('[data-role="counter"]');if(i&&i.id.indexOf(e)>=0){t.push(n)}}));return t}function Ke(){var e=this;var t={show:[],hide:[]};var n=[];var a=null;["show","hide"].forEach((function(r){var s=t[r];var o=null;var l=[];Array.from(e.parentContainer.querySelectorAll('.menu-item-block[data-status="'.concat(r,'"]'))).forEach((function(e){if(e.dataset.role==="group"){var u=e.parentNode.hasAttribute("data-group-id")?e.parentNode.getAttribute("data-group-id"):null;s=t[r];var c;while(c=l.pop()){if(c["group_id"]===u){l.push(c);s=c.items;break}}var d={group_id:e.dataset.id,items:[]};s.push(d);l.push(d);s=d.items;o=e.dataset.id}else{if([ie.code,te.code,Z.code].indexOf(e.getAttribute("data-type"))>=0){var m={ID:e.getAttribute("data-id"),LINK:e.getAttribute("data-link"),TEXT:i.Text.decode(e.querySelector("[data-role='item-text']").innerHTML)};if(e.getAttribute("data-new-page")==="Y"){m.NEW_PAGE="Y"}n.push(m)}if(a===null&&i.Type.isStringFilled(e.getAttribute("data-link"))){a=e.getAttribute("data-link")}if(e.closest('[data-group-id="'.concat(o,'"][data-role="group-content"]'))){s.push(e.dataset.id)}else{var h=e.parentNode.hasAttribute("data-group-id")?e.parentNode.getAttribute("data-group-id"):null;s=t[r];var f;while(f=l.pop()){if(f["group_id"]===h){l.push(f);s=f.items;break}}s.push(e.dataset.id)}}}))}));return{saveSortItems:t,firstItemLink:a,customItems:n}}function Qe(e){var t=ke(this,He,Ke).call(this),n=t.saveSortItems,i=t.firstItemLink;X.saveItemsSort(n,i,e||{action:"sortItem"})}function $e(e){if(!(e instanceof W)){return null}var t=e.container.closest('[data-role="group-content"]');if(t&&this.items.has(t.getAttribute("data-group-id"))){return this.items.get(t.getAttribute("data-group-id"))}return null}function Ze(e){if(e instanceof ue){return false}var t=ke(this,xe,$e).call(this,e);if(t instanceof ue&&e.container.parentNode.querySelectorAll("li.menu-item-block").length<=1){return false}return true}function et(e,t){var n=this;return new Promise((function(a){var r=t.startX,s=t.startY;var o=document.createElement("DIV");o.style="position: absolute; z-index: 1000; top: ".concat(s+25,"px;");var l=e.cloneNode(true);l.style.display=e.dataset.styleDisplay;document.body.appendChild(o);o.appendChild(l);var u=n.hiddenContainer.getBoundingClientRect().top;new BX.easing({duration:500,start:{left:r},finish:{left:30},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){o.style.left=t.left+"px"},complete:function e(){new BX.easing({duration:500,start:{top:s+25},finish:{top:u},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){o.style.top=t.top+"px"},complete:function e(){i.Dom.remove(o);a()}}).animate()}}).animate()}))}function tt(e){return new Promise((function(t){new BX.easing({duration:700,start:{left:e.offsetLeft,opacity:1},finish:{left:400,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function t(n){e.style.paddingLeft=n.left+"px";e.style.opacity=n.opacity},complete:function e(){t()}}).animate()}))}function nt(e){var t=this;jsDD.Enable();e.container.onbxdragstart=ke(this,Xe,it).bind(this,e);e.container.onbxdrag=function(e,n){ke(t,Fe,at).call(t,e,n)};e.container.onbxdraghover=function(e,n,i){ke(t,Re,rt).call(t,e,n,i)};e.container.onbxdragstop=ke(this,qe,st).bind(this,e);jsDD.registerObject(e.container)}function it(e){var t=this;r.EventEmitter.emit(r.EventEmitter.GLOBAL_TARGET,"BX.Bitrix24.LeftMenuClass:onDragStart");if(!(e instanceof ue)&&e.container.parentNode.querySelectorAll("li.menu-item-block").length<=1&&ke(this,xe,$e).call(this,e)!==null){e=ke(this,xe,$e).call(this,e)}r.EventEmitter.emit(this,u.eventName("onDragModeOn"));this.dnd={container:this.container.parentNode,itemDomBlank:i.Dom.create("div",{style:{display:"none"}}),itemMoveBlank:i.Dom.create("div",{style:{height:e.container.offsetHeight+"px"}}),draggableBlock:i.Dom.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:[e.container.offsetTop-e.container.offsetHeight,"px"].join("")}}),item:e,oldParent:ke(this,xe,$e).call(this,e),isHiddenContainerVisible:this.isHiddenContainerVisible()};ke(this,Ie,We).call(this,false);var n=function n(){babelHelpers.toConsumableArray(t.parentContainer.querySelectorAll("li.menu-item-block")).forEach((function(n){if(e instanceof ue&&ke(t,xe,$e).call(t,t.items.get(n.getAttribute("data-id")))!==null){return}jsDD.registerDest(n,100)}));var i=t.parentContainer.querySelector("#left-menu-empty-item");if(e instanceof te){jsDD.unregisterDest(i)}else{jsDD.registerDest(i,100)}jsDD.registerDest(t.parentContainer.querySelector("#left-menu-hidden-empty-item"),100);jsDD.registerDest(t.parentContainer.querySelector("#left-menu-hidden-separator"),100)};if(e instanceof ue){e.collapse(true).then((function(){if(t.dnd){t.dnd.pos=BX.pos(t.container.parentNode);n()}}))}else{n()}var a=e.container;i.Dom.addClass(this.dnd.container,"menu-drag-mode");i.Dom.addClass(a,"menu-item-draggable");a.parentNode.insertBefore(this.dnd.itemDomBlank,a);a.parentNode.insertBefore(this.dnd.itemMoveBlank,a);this.dnd.draggableBlock.appendChild(e.container);this.dnd.container.style.position="relative";this.dnd.container.appendChild(this.dnd.draggableBlock);this.dnd.pos=BX.pos(this.container.parentNode)}function at(e,t){var n=this.dnd.item;var i=this.dnd.pos.height;t=Math.max(0,t-this.dnd.pos.top);this.dnd.draggableBlock.style.top=[Math.min(i-n.container.offsetHeight,t)-5,"px"].join("")}function rt(e,t,n){var a=this.dnd.item;var r=a.container;if(e===r){this.dnd.itemDomBlank.parentNode.insertBefore(this.dnd.itemMoveBlank,this.dnd.itemDomBlank);return}if(e.id==="left-menu-empty-item"&&(r.getAttribute("data-type")==="self"||r.getAttribute("data-disable-first-item")==="Y")){return}if(e.getAttribute("data-role")==="group"){var s=e.parentNode.querySelector('[data-group-id="'.concat(e.getAttribute("data-id"),'"]'));if(e.getAttribute("data-collapse-mode")==="collapsed"){i.Dom.insertAfter(this.dnd.itemMoveBlank,s)}else if(a instanceof ue){i.Dom.insertBefore(this.dnd.itemMoveBlank,e)}else{i.Dom.prepend(this.dnd.itemMoveBlank,s.querySelector("ul"))}}else if(this.dnd.container.contains(e)){var o=e;if(a instanceof ue&&e.closest('[data-role="group-content"]')){o=e.closest('[data-role="group-content"]')}i.Dom.insertAfter(this.dnd.itemMoveBlank,o)}}function st(){var e=this.dnd.item;console.log(e);var t=this.dnd.oldParent;var n=e.container;i.Dom.removeClass(this.dnd.container,"menu-drag-mode");i.Dom.removeClass(n,"menu-item-draggable");this.dnd.container.style.position="";var a=null;var s=false;if(this.parentContainer.querySelector(".menu-item-block")===e.container){if(e instanceof te){a=i.Loc.getMessage("MENU_SELF_ITEM_FIRST_ERROR")}else if(e.container.getAttribute("data-disable-first-item")==="Y"){a=i.Loc.getMessage("MENU_FIRST_ITEM_ERROR")}}if(a!==null){this.dnd.itemDomBlank.parentNode.replaceChild(n,this.dnd.itemDomBlank);e.showMessage(a)}else if(!this.dnd.container.contains(this.dnd.itemMoveBlank)){this.dnd.itemDomBlank.parentNode.replaceChild(n,this.dnd.itemDomBlank)}else{try{this.dnd.itemMoveBlank.parentNode.replaceChild(n,this.dnd.itemMoveBlank);if(this.hiddenContainer.contains(n)){e.container.setAttribute("data-status","hide");if(this.dnd.itemDomBlank.closest("#left-menu-hidden-items-block")===null&&this.hiddenContainer.querySelectorAll(".menu-item-block").length===1){r.EventEmitter.emit(this,u.eventName("onHiddenBlockIsNotEmpty"))}}else{e.container.setAttribute("data-status","show");if(this.hiddenContainer.querySelectorAll(".menu-item-block").length<=0){s=true;r.EventEmitter.emit(this,u.eventName("onHiddenBlockIsEmpty"))}}if(e instanceof ue){e.checkAndCorrect().expand(true)}ke(this,Le,Ye).call(this,e,t);ke(this,we,ze).call(this,e);var o={action:"sortItem"};if(this.parentContainer.querySelector(".menu-item-block")===e.container&&!this.isExtranet){e.showMessage(i.Loc.getMessage("MENU_ITEM_MAIN_PAGE"));o.action="mainPage";o.itemId=e.getId()}ke(this,Be,Qe).call(this,o)}catch(e){this.dnd.itemDomBlank.parentNode.replaceChild(n,this.dnd.itemDomBlank)}}i.Dom.remove(this.dnd.draggableBlock);i.Dom.remove(this.dnd.itemDomBlank);i.Dom.remove(this.dnd.itemMoveBlank);jsDD.enableDest(n);this.container.style.position="static";if(!this.dnd.isHiddenContainerVisible||s===true){ke(this,Se,je).call(this,false)}delete this.dnd;babelHelpers.toConsumableArray(this.parentContainer.querySelectorAll("li.menu-item-block")).forEach((function(e){jsDD.registerDest(e)}));var l=this.parentContainer.querySelector("#left-menu-empty-item");jsDD.unregisterDest(l);jsDD.unregisterDest(this.parentContainer.querySelector("#left-menu-hidden-empty-item"));jsDD.unregisterDest(this.parentContainer.querySelector("#left-menu-hidden-separator"));jsDD.refreshDestArea();r.EventEmitter.emit(this,u.eventName("onDragModeOff"))}var ot=function(e){babelHelpers.inherits(t,e);function t(e,n){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,n))}babelHelpers.createClass(t,[{key:"saveCurrentPage",value:function e(t){var n=this;return Z.saveCurrentPage(t).then((function(e){r.EventEmitter.emit(n,u.eventName("onItemHasBeenAdded"),e);return e}))["catch"](P.catchError)}},{key:"saveStandardPage",value:function e(t){var n=this;return Z.saveStandardPage(t).then((function(e){r.EventEmitter.emit(n,u.eventName("onItemHasBeenAdded"),e);return e}))["catch"](P.catchError)}},{key:"deleteCurrentPage",value:function e(t){var n=this;var i=t.pageLink;return Z.deleteCurrentPage({pageLink:i}).then((function(e){r.EventEmitter.emit(n,u.eventName("onItemHasBeenDeleted"),e);return e}))["catch"](P.catchError)}},{key:"deleteStandardPage",value:function e(t){var n=this;return Z.deleteStandardPage(t).then((function(e){r.EventEmitter.emit(n,u.eventName("onItemHasBeenDeleted"),e);return e}))["catch"](P.catchError)}},{key:"showAddToSelf",value:function e(t){var n=this;te.showAdd(t).then((function(e){r.EventEmitter.emit(n,u.eventName("onItemHasBeenAdded"),e)}))["catch"](P.catchError)}}]);return t}(h);function lt(e,t,n){ut(e,t);t.set(e,n)}function ut(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var ct=new WeakMap;var dt=function(){function e(t){babelHelpers.classCallCheck(this,e);lt(this,ct,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ct,t?ft.ADMIN:ft.NOT_ADMIN)}babelHelpers.createClass(e,[{key:"sendSetCustomPreset",value:function e(){l.sendData({tool:gt,category:mt.MENU,event:ht.SET,type:"custom",c_section:pt.MENU,p1:babelHelpers.classPrivateFieldGet(this,ct)})}},{key:"sendSetPreset",value:function e(t,n,i){l.sendData({type:t,event:n?ht.CHANGE:ht.SELECT,tool:gt,category:n?mt.MENU:mt.TOOL,c_section:n?pt.MENU:pt.POPUP,c_element:i,p1:babelHelpers.classPrivateFieldGet(this,ct)})}},{key:"sendClose",value:function e(){l.sendData({event:ht.SHOW,tool:gt,category:mt.TOOL,c_section:pt.POPUP})}}]);return e}();var mt={TOOL:"main_tool",MENU:"main_menu"};var ht={SHOW:"window_show",SELECT:"select",CHANGE:"change",SET:"menu_set"};var ft={ADMIN:"isAdmin_Y",NOT_ADMIN:"isAdmin_N"};var pt={POPUP:"menu_popup",PRESET:"preset",QUALIFICATION:"qualification",SETTINGS:"settings",MENU:"main_menu"};var vt={CONFIRM:"confirm",LATER:"later",CLOSE:"close",SAVE:"save",SKIP:"skip"};var gt="intranet";function bt(e,t,n){Et(e,t);t.set(e,n)}function yt(e,t){Et(e,t);t.add(e)}function Et(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function kt(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var Ct=new WeakSet;var Mt=new WeakSet;var It=new WeakMap;var St=new WeakSet;var Tt=function(){function e(t){babelHelpers.classCallCheck(this,e);yt(this,St);yt(this,Mt);yt(this,Ct);babelHelpers.defineProperty(this,"cache",new i.Cache.MemoryCache);babelHelpers.defineProperty(this,"scrollModeThreshold",20);babelHelpers.defineProperty(this,"lastScrollOffset",0);babelHelpers.defineProperty(this,"slidingModeTimeoutId",0);babelHelpers.defineProperty(this,"topMenuSelectedNode",null);babelHelpers.defineProperty(this,"topItemSelectedObj",null);babelHelpers.defineProperty(this,"isMenuMouseEnterBlocked",false);babelHelpers.defineProperty(this,"isMenuMouseLeaveBlocked",[]);babelHelpers.defineProperty(this,"isCollapsedMode",false);babelHelpers.defineProperty(this,"workgroupsCounterData",{});bt(this,It,{writable:true,value:0});this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return false}t=babelHelpers["typeof"](t)==="object"?t:{};u.isExtranet=t.isExtranet==="Y";u.isMainPageEnabled=t.isMainPageEnabled==="Y";u.isAdmin=t.isAdmin;u.isCustomPresetRestricted=t.isCustomPresetAvailable!=="Y";u.availablePresetTools=t.availablePresetTools;u.settingsPath=t.settingsPath;this.isCollapsedMode=t.isCollapsedMode;this.workgroupsCounterData=t.workgroupsCounterData;this.analytics=new dt(t.isAdmin);this.initAndBindNodes();this.bindEvents();this.getItemsController();this.handleDocumentScroll()}babelHelpers.createClass(e,[{key:"initAndBindNodes",value:function e(){var t,n=this;this.menuContainer.addEventListener("dblclick",this.handleMenuDoubleClick.bind(this));this.menuContainer.addEventListener("mouseenter",this.handleMenuMouseEnter.bind(this));this.menuContainer.addEventListener("mouseleave",this.handleMenuMouseLeave.bind(this));this.menuContainer.addEventListener("transitionend",this.handleSlidingTransitionEnd.bind(this));this.menuHeader=this.menuContainer.querySelector(".menu-items-header");this.menuBody=this.menuContainer.querySelector(".menu-items-body");this.menuItemsBlock=this.menuContainer.querySelector(".menu-items");this.header=document.querySelector("#header");this.headerBurger=this.header.querySelector(".menu-switcher");var i=this.header.querySelector(".header-logo-block");this.headerSettings=this.header.querySelector(".header-logo-block-settings");if(this.headerSettings){i.addEventListener("mouseenter",this.handleHeaderLogoMouserEnter.bind(this));i.addEventListener("mouseleave",this.handleHeaderLogoMouserLeave.bind(this));this.menuHeader.addEventListener("mouseenter",this.handleHeaderLogoMouserEnter.bind(this));this.menuHeader.addEventListener("mouseleave",this.handleHeaderLogoMouserLeave.bind(this))}document.addEventListener("scroll",this.handleDocumentScroll.bind(this));this.mainTable=document.querySelector(".bx-layout-table");this.menuHeaderBurger=this.menuHeader.querySelector(".menu-switcher");this.menuHeaderBurger.addEventListener("click",this.handleBurgerClick.bind(this));this.menuHeader.querySelector(".menu-items-header-title").addEventListener("click",this.handleBurgerClick.bind(this,true));this.upButton=this.menuContainer.querySelector(".menu-btn-arrow-up");this.upButton.addEventListener("click",this.handleUpButtonClick.bind(this));this.upButton.addEventListener("mouseenter",this.handleUpButtonMouseEnter.bind(this));this.upButton.addEventListener("mouseleave",this.handleUpButtonMouseLeave.bind(this));this.menuMoreButton=this.menuContainer.querySelector(".menu-favorites-more-btn");this.menuMoreButton.addEventListener("click",this.handleShowHiddenClick.bind(this));var a=this.menuContainer.querySelector(".menu-help-btn");if(a){a.addEventListener("click",this.handleHelperClick.bind(this))}var r=this.menuContainer.querySelector(".menu-sitemap-btn");if(r){r.addEventListener("click",this.handleSiteMapClick.bind(this))}var s=this.menuContainer.querySelector(".menu-settings-save-btn");if(s){s.addEventListener("click",this.handleViewMode.bind(this))}(t=this.menuContainer.querySelector(".menu-settings-btn"))===null||t===void 0?void 0:t.addEventListener("click",(function(){n.getSettingsController().show()}))}},{key:"getItemsController",value:function e(){var t=this;return this.cache.remember("itemsController",(function(){return new Ge(t.menuContainer,{events:{EditMode:function e(){t.toggle(true);t.menuContainer.classList.add("menu-items-edit-mode");t.menuContainer.classList.remove("menu-items-view-mode")},ViewMode:function e(){t.toggle(true);t.menuContainer.classList.add("menu-items-view-mode");t.menuContainer.classList.remove("menu-items-edit-mode")},onDragModeOn:function e(n){var i=n.target;t.switchToSlidingMode(true);t.isMenuMouseLeaveBlocked.push("drag")},onDragModeOff:function e(n){var i=n.target;t.isMenuMouseLeaveBlocked.pop()},onHiddenBlockIsVisible:t.onHiddenBlockIsVisible.bind(t),onHiddenBlockIsHidden:t.onHiddenBlockIsHidden.bind(t),onHiddenBlockIsEmpty:t.onHiddenBlockIsEmpty.bind(t),onHiddenBlockIsNotEmpty:t.onHiddenBlockIsNotEmpty.bind(t),onShow:function e(){t.isMenuMouseLeaveBlocked.push("items")},onClose:function e(){t.isMenuMouseLeaveBlocked.pop()}}})}))}},{key:"getItemDirector",value:function e(){var t=this;return this.cache.remember("itemsCreator",(function(){return new ot(t.menuContainer,{events:{onItemHasBeenAdded:function e(n){var i=n.data;t.getItemsController().addItem(i)}}})}))}},{key:"getSettingsController",value:function e(){var t=this;return this.cache.remember("presetController",(function(){var e=t.menuContainer.querySelector(".menu-settings-btn");if(!e){return null}return new O(e,{events:{onGettingSettingMenuItems:t.onGettingSettingMenuItems.bind(t),onShow:function e(){t.isMenuMouseLeaveBlocked.push("settings")},onClose:function e(){t.isMenuMouseLeaveBlocked.pop()}}})}))}},{key:"getCustomPresetController",value:function e(){var t=this;return this.cache.remember("customPresetController",(function(){return new p(t.menuContainer,{events:{onPresetIsSet:function e(n){var i=n.data;var a=t.getItemsController()["export"](),r=a.saveSortItems,s=a.firstItemLink,o=a.customItems;if(!i){t.analytics.sendSetCustomPreset()}return X.setCustomPreset(i,r,o,s)},onShow:function e(){t.isMenuMouseLeaveBlocked.push("presets")},onClose:function e(){t.isMenuMouseLeaveBlocked.pop()}}})}))}},{key:"getDefaultPresetController",value:function e(){var t=this;var n=false;var i=function e(n){var i=X.postponeSystemPreset(n);r.EventEmitter.emit(t,u.eventName("onPresetIsPostponed"));return i};return this.cache.remember("defaultPresetController",(function(){var e=new U(t.menuContainer,{events:{onPresetIsSet:function e(i){var a=i.data,r=a.mode,s=a.presetId;t.analytics.sendSetPreset(s,r==="personal",vt.CONFIRM);n=true;return X.setSystemPreset(r,s)},onPresetIsPostponed:function a(r){var s=r.data.mode;t.analytics.sendSetPreset(e.getSelectedPreset(),s==="personal",vt.LATER);n=true;return i(s)},onShow:function e(){t.analytics.sendClose()},onClose:function a(){if(n!==true){t.analytics.sendSetPreset(e.getSelectedPreset(),e.getMode()==="personal",vt.CLOSE);i(e.getMode())}n=false}}});return e}))}},{key:"bindEvents",value:function e(){var t=this;BX.addCustomEvent("BX.Bitrix24.GroupPanel:onOpen",this.handleGroupPanelOpen.bind(this));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onClose",this.handleGroupPanelClose.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",(function(e,n){if(!e||!i.Type.isDomNode(n)){return}var a=n.getAttribute("data-top-menu-id");var r=t.menuBody.querySelector('[data-top-menu-id="'.concat(a,'"]'));if(r){r.setAttribute("data-link",e);var s=r.querySelector("a.menu-item-link");if(s){s.setAttribute("href",e)}if(r.previousElementSibling===t.menuContainer.querySelector("#left-menu-empty-item")){X.setFirstPage(e)}else{X.clearCache()}}t.showMessage(n,i.Loc.getMessage("MENU_ITEM_MAIN_SECTION_PAGE"))}));BX.addCustomEvent("BX.Main.InterfaceButtons:onHideLastVisibleItem",(function(e){t.showMessage(e,i.Loc.getMessage("MENU_TOP_ITEM_LAST_HIDDEN"))}));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeCreateEditMenu",(function(e,n,a){var r=kt(t,Ct,wt).call(t,n);if(!r&&n&&i.Type.isStringFilled(n.URL)&&!n.URL.match(/javascript:/)){e.addMenuItem({text:i.Loc.getMessage("MENU_ADD_TO_LEFT_MENU"),onclick:function e(i,a){t.getItemDirector().saveStandardPage(n);a.getMenuWindow().close()}})}else if(r instanceof Z){e.addMenuItem({text:i.Loc.getMessage("MENU_DELETE_FROM_LEFT_MENU"),onclick:function e(i,a){t.getItemDirector().deleteStandardPage(n);a.getMenuWindow().close()}})}}));top.BX.addCustomEvent("UI.Toolbar:onRequestMenuItemData",(function(e){var n=e.currentFullPath,a=e.context;if(i.Type.isStringFilled(n)){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",[{currentPageInMenu:t.menuContainer.querySelector('.menu-item-block[data-link="'.concat(n,'"]')),context:a}])}}));r.EventEmitter.subscribe("UI.Toolbar:onStarClick",(function(e){var n=babelHelpers.slicedToArray(e.compatData,1),i=n[0];if(i.isActive){t.getItemDirector().deleteCurrentPage({context:i.context,pageLink:i.pageLink}).then((function(e){var n=e.itemInfo;BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[n,t]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false,context:i.context}])}))}else{t.getItemDirector().saveCurrentPage({pageTitle:i.pageTitle,pageLink:i.pageLink}).then((function(e){var n=e.itemInfo;BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[n,t]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:true,context:i.context}])}))}}));r.EventEmitter.subscribe("BX.Main.InterfaceButtons:onBeforeResetMenu",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),n=t[0];n.push((function(){var e=new BX.Promise;X.clearCache().then((function(){e.fulfill()}),(function(t){e.reject("Error: "+t.errors[0].message)}));return e}))}))}},{key:"isEditMode",value:function e(){return this.getItemsController().isEditMode}},{key:"isCollapsed",value:function e(){return this.isCollapsedMode}},{key:"showMessage",value:function e(t,n,i){var r=a.PopupManager.create("left-menu-message",t,{content:'<div class="left-menu-message-popup">'+n+"</div>",darkMode:true,offsetTop:i==="right"?-45:2,offsetLeft:i==="right"?215:0,angle:i==="right"?{position:"left"}:true,cacheable:false,autoHide:true,events:{onDestroy:function e(){r=null}}});r.show();setTimeout((function(){if(r){r.close();r=null}}),3e3)}},{key:"showError",value:function e(t){this.showMessage(t,i.Loc.getMessage("edit_error"))}},{key:"showGlobalPreset",value:function e(){var t=this;o.BannerDispatcher.high.toQueue((function(e){var n=t.getDefaultPresetController();n.show("global");n.getPopup().subscribe("onAfterClose",(function(t){e()}))}))}},{key:"handleShowHiddenClick",value:function e(){this.getItemsController().toggleHiddenContainer(true)}},{key:"onHiddenBlockIsVisible",value:function e(){i.Dom.addClass(this.menuMoreButton,"menu-favorites-more-btn-open");this.menuMoreButton.querySelector("#menu-more-btn-text").innerHTML=i.Loc.getMessage("more_items_hide")}},{key:"onHiddenBlockIsHidden",value:function e(){i.Dom.removeClass(this.menuMoreButton,"menu-favorites-more-btn-open");this.menuMoreButton.querySelector("#menu-more-btn-text").innerHTML=i.Loc.getMessage("more_items_show")}},{key:"onHiddenBlockIsEmpty",value:function e(){i.Dom.addClass(this.menuMoreButton,"menu-favorites-more-btn-hidden")}},{key:"onHiddenBlockIsNotEmpty",value:function e(){i.Dom.removeClass(this.menuMoreButton,"menu-favorites-more-btn-hidden")}},{key:"setDefaultMenu",value:function e(){s.MessageBox.show({message:i.Loc.getMessage("MENU_SET_DEFAULT_CONFIRM"),onYes:function e(t,n){n.setWaiting();X.setDefaultPreset().then((function(){n.setWaiting(false);t.close();document.location.reload()}))},buttons:s.MessageBoxButtons.YES_CANCEL})}},{key:"clearCompositeCache",value:function e(){i.ajax.runAction("intranet.leftmenu.clearCache",{data:{}})}},{key:"onGettingSettingMenuItems",value:function e(){var t=this;var n=Z.getActiveTopMenuItem();var a=null;if(n){var r=this.menuContainer.querySelector('.menu-item-block[data-link="'.concat(n["URL"],'"]'));if(!r){a={text:i.Loc.getMessage("MENU_ADD_TO_LEFT_MENU"),onclick:function e(i,a){t.getItemDirector().saveStandardPage(n);a.getMenuWindow().destroy()}}}else if(r.getAttribute("data-type")===Z.code){a={text:i.Loc.getMessage("MENU_DELETE_FROM_LEFT_MENU"),onclick:function e(i,a){t.getItemDirector().deleteStandardPage(n);a.getMenuWindow().destroy()}}}else{a={text:i.Loc.getMessage("MENU_DELETE_PAGE_FROM_LEFT_MENU"),className:"menu-popup-disable-text",onclick:function e(){}}}}var s=[{text:i.Loc.getMessage("SORT_ITEMS"),onclick:function e(){t.getItemsController().switchToEditMode()}},{text:this.isCollapsed()?i.Loc.getMessage("MENU_EXPAND"):i.Loc.getMessage("MENU_COLLAPSE"),onclick:function e(n,i){t.toggle();i.getMenuWindow().destroy()}},a,{text:i.Loc.getMessage("MENU_ADD_SELF_PAGE"),onclick:function e(n,i){t.getItemDirector().showAddToSelf(t.getSettingsController().getContainer())}},u.isExtranet?null:{text:i.Loc.getMessage("MENU_SET_DEFAULT2"),onclick:function e(){t.getDefaultPresetController().show("personal")}},u.isExtranet?null:{text:i.Loc.getMessage("MENU_SET_DEFAULT"),onclick:this.setDefaultMenu.bind(this)}];if(u.isAdmin){var o=i.Loc.getMessage("MENU_SAVE_CUSTOM_PRESET");if(u.isCustomPresetRestricted){o+="<span class='menu-lock-icon'></span>"}s.push({html:o,className:u.isCustomPresetRestricted?" menu-popup-disable-text":"",onclick:function e(n,i){if(u.isCustomPresetRestricted){BX.UI.InfoHelper.show("limit_office_menu_to_all")}else{t.getCustomPresetController().show()}}});if(u.settingsPath){s.push({html:i.Loc.getMessage("MENU_EDIT_TOOLS"),onclick:function e(){BX.SidePanel.Instance.open("".concat(u.settingsPath,"?analyticContext=left_menu&page=tools"),{allowChangeHistory:false,width:1034})}})}}return s.filter((function(e){return e!==null}))}},{key:"handleSiteMapClick",value:function e(){this.switchToSlidingMode(false);BX.SidePanel.Instance.open((i.Loc.getMessage("SITE_DIR")||"/")+"sitemap/",{allowChangeHistory:false,customLeftBoundary:0})}},{key:"handleHelperClick",value:function e(){this.switchToSlidingMode(false);BX.Helper.show()}},{key:"blockSliding",value:function e(){this.stopSliding();this.isMenuMouseEnterBlocked=true}},{key:"releaseSliding",value:function e(){this.isMenuMouseEnterBlocked=false}},{key:"stopSliding",value:function e(){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=0}},{key:"startSliding",value:function e(){this.stopSliding();if(this.isMenuMouseEnterBlocked===true){return}this.slidingModeTimeoutId=setTimeout(function(){this.slidingModeTimeoutId=0;this.switchToSlidingMode(true)}.bind(this),400)}},{key:"handleBurgerClick",value:function e(t){this.getItemsController().switchToViewMode();this.menuHeaderBurger.classList.add("menu-switcher-hover");this.toggle(t,function(){this.blockSliding();setTimeout(function(){this.menuHeaderBurger.classList.remove("menu-switcher-hover");this.releaseSliding()}.bind(this),100)}.bind(this))}},{key:"handleMenuMouseEnter",value:function e(t){if(!this.isCollapsed()){return}this.startSliding()}},{key:"handleMenuMouseLeave",value:function e(t){this.stopSliding();if(this.isMenuMouseLeaveBlocked.length<=0){this.switchToSlidingMode(false)}}},{key:"handleMenuDoubleClick",value:function e(t){if(t.target===this.menuBody){this.toggle()}}},{key:"handleHeaderLogoMouserEnter",value:function e(t){BX.addClass(this.headerSettings,"header-logo-block-settings-show")}},{key:"handleHeaderLogoMouserLeave",value:function e(t){if(!this.headerSettings.hasAttribute("data-rename-portal")){BX.removeClass(this.headerSettings,"header-logo-block-settings-show")}}},{key:"handleUpButtonClick",value:function e(){this.blockSliding();if(this.isUpButtonReversed()){window.scrollTo(0,this.lastScrollOffset);this.lastScrollOffset=0;this.unreverseUpButton()}else{this.lastScrollOffset=window.pageYOffset;window.scrollTo(0,0);this.reverseUpButton()}setTimeout(this.releaseSliding.bind(this),100)}},{key:"handleUpButtonMouseEnter",value:function e(){this.blockSliding()}},{key:"handleUpButtonMouseLeave",value:function e(){this.releaseSliding()}},{key:"handleDocumentScroll",value:function e(){kt(this,St,At).call(this);this.applyScrollMode();if(window.pageYOffset>document.documentElement.clientHeight){this.showUpButton();if(this.isUpButtonReversed()){this.unreverseUpButton();this.lastScrollOffset=0}}else if(!this.isUpButtonReversed()){this.hideUpButton()}if(window.pageXOffset>0){this.menuContainer.style.left=-window.pageXOffset+"px";this.upButton.style.left=-window.pageXOffset+(this.isCollapsed()?0:172)+"px"}else{this.menuContainer.style.removeProperty("left");this.upButton.style.removeProperty("left")}}},{key:"switchToSlidingMode",value:function e(t,n){if(t===false){this.stopSliding();if(BX.hasClass(this.mainTable,"menu-sliding-mode")){if(n!==true){BX.addClass(this.mainTable,"menu-sliding-closing-mode")}BX.removeClass(this.mainTable,"menu-sliding-mode menu-sliding-opening-mode")}}else if(this.isCollapsedMode&&!BX.hasClass(this.mainTable,"menu-sliding-mode")){BX.removeClass(this.mainTable,"menu-sliding-closing-mode");if(n!==true){BX.addClass(this.mainTable,"menu-sliding-opening-mode")}BX.addClass(this.mainTable,"menu-sliding-mode")}}},{key:"handleSlidingTransitionEnd",value:function e(t){if(t.target===this.menuContainer){BX.removeClass(this.mainTable,"menu-sliding-opening-mode menu-sliding-closing-mode")}}},{key:"switchToScrollMode",value:function e(t){if(t===false){this.mainTable.classList.remove("menu-scroll-mode")}else if(!this.mainTable.classList.contains("menu-scroll-mode")){this.mainTable.classList.add("menu-scroll-mode")}}},{key:"switchToLogoMaskMode",value:function e(t){if(!kt(this,Mt,Lt).call(this)){return}if(t===false){this.mainTable.classList.remove("menu-logo-mask-mode")}else if(!this.mainTable.classList.contains("menu-logo-mask-mode")){this.mainTable.classList.add("menu-logo-mask-mode")}}},{key:"toggle",value:function e(t,n){var i=BX("layout-left-column");if(!i){return}var a=!this.mainTable.classList.contains("menu-collapsed-mode");if(t===a||this.mainTable.classList.contains("menu-animation-mode")){return}BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",[t,this]);var r=this.menuHeader.querySelector(".logo-image-container");if(r){var s=this.header.querySelector(".logo-image-container").offsetWidth;if(s>0){r.style.width=s+"px"}}this.blockSliding();this.switchToSlidingMode(false,true);this.applyScrollMode();i.style.overflow="hidden";this.mainTable.classList.add("menu-animation-mode",a?"menu-animation-closing-mode":"menu-animation-opening-mode");var o=[].slice.call(i.querySelectorAll(".menu-item-link"));var l=i.querySelector(".menu-collapsed-more-btn");var u=i.querySelector(".menu-default-more-btn");var c=i.querySelector(".menu-sitemap-icon-box");var d=i.querySelector(".menu-sitemap-btn-text");var m=i.querySelector(".menu-invite-employees-text");var h=i.querySelector(".menu-invite-icon-box");var f=i.querySelector(".menu-license-all-container");var p=i.querySelector(".menu-license-all-default");var v=p?p.offsetHeight:0;var g=i.querySelector(".menu-license-all-collapsed");var b=this.menuContainer.querySelector(".menu-settings-icon-box");var y=this.menuContainer.querySelector(".menu-settings-btn-text");var E=this.menuContainer.querySelector(".menu-help-icon-box");var k=this.menuContainer.querySelector(".menu-help-btn-text");var C=i.querySelector(".menu-item-separator");var M=i.querySelector(".menu-item-index-more");var I=this.mainTable.querySelector(".page-header");var S=document.getElementById("bx-im-bar");var T=S?S.offsetWidth:0;new BX.easing({duration:300,start:{translateIcon:a?-100:0,translateText:a?0:-100,translateMoreBtn:a?0:-84,translateLicenseBtn:a?0:-100,heightLicenseBtn:a?v:40,burgerMenuWidth:a?33:66,sidebarWidth:a?240:66,opacity:a?100:0,opacityRevert:a?0:100},finish:{translateIcon:a?0:-100,translateText:a?-100:-18,translateMoreBtn:a?-84:0,translateLicenseBtn:a?-100:0,heightLicenseBtn:a?40:v,burgerMenuWidth:a?66:33,sidebarWidth:a?66:240,opacity:a?0:100,opacityRevert:a?100:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.width=e.sidebarWidth+"px";this.menuContainer.style.width=e.sidebarWidth+"px";this.menuHeaderBurger.style.width=e.burgerMenuWidth+"px";this.headerBurger.style.width=e.burgerMenuWidth+"px";if(I){I.style.maxWidth="calc(100vw - "+e.sidebarWidth+"px - "+T+"px)"}if(a){if(c){c.style.transform="translateX("+e.translateIcon+"px)";c.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}if(b){b.style.transform="translateX("+e.translateIcon+"px)";b.style.opacity=e.opacityRevert/100}if(y){y.style.transform="translateX("+e.translateText+"px)";y.style.opacity=e.opacity/100}E.style.transform="translateX("+e.translateIcon+"px)";E.style.opacity=e.opacityRevert/100;k.style.transform="translateX("+e.translateText+"px)";k.style.opacity=e.opacity/100;l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(M){M.style.transform="translateX("+e.translateIcon+"px)";M.style.opacity=e.opacityRevert/100}if(f){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;p.style.height=e.heightLicenseBtn+"px";g.style.transform="translateX("+e.translateIcon+"px)";g.style.opacity=e.opacityRevert/100}o.forEach((function(t){var n=t.querySelector(".menu-item-icon-box");var i=t.querySelector(".menu-item-link-text");var a=t.querySelector(".menu-item-index");var r=t.querySelector(".menu-item-link-arrow");i.style.transform="translateX("+e.translateText+"px)";i.style.opacity=e.opacity/100;n.style.transform="translateX("+e.translateIcon+"px)";n.style.opacity=e.opacityRevert/100;if(r){r.style.transform="translateX("+e.translateText+"px)";r.style.opacity=e.opacity/100}if(a){a.style.transform="translateX("+e.translateIcon+"px)";a.style.opacity=e.opacityRevert/100}}))}else{C.style.opacity=0;if(c){c.style.transform="translateX("+e.translateIcon+"px)";c.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}if(b){b.style.transform="translateX("+e.translateIcon+"px)";b.style.opacity=e.opacityRevert/100}if(y){y.style.transform="translateX("+e.translateText+"px)";y.style.opacity=e.opacity/100}E.style.transform="translateX("+e.translateIcon+"px)";E.style.opacity=e.opacityRevert/100;k.style.transform="translateX("+e.translateText+"px)";k.style.opacity=e.opacity/100;l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(M){M.style.transform="translateX("+e.translateText+"px)"}if(f){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;p.style.height=e.heightLicenseBtn+"px";g.style.transform="translateX("+e.translateIcon+"px)";g.style.opacity=e.opacityRevert/100}o.forEach((function(t){var n=t.querySelector(".menu-item-icon-box");var i=t.querySelector(".menu-item-link-text");var a=t.querySelector(".menu-item-index");var r=t.querySelector(".menu-item-link-arrow");i.style.transform="translateX("+e.translateText+"px)";i.style.opacity=e.opacity/100;i.style.display="inline-block";n.style.transform="translateX("+e.translateIcon+"px)";n.style.opacity=e.opacityRevert/100;if(r){r.style.transform="translateX("+e.translateText+"px)"}if(a){a.style.transform="translateX("+e.translateText+"px)"}}))}var t=document.createEvent("Event");t.initEvent("resize",true,true);window.dispatchEvent(t)}.bind(this),complete:function(){if(a){this.isCollapsedMode=true;BX.addClass(this.mainTable,"menu-collapsed-mode")}else{this.isCollapsedMode=false;BX.removeClass(this.mainTable,"menu-collapsed-mode")}BX.removeClass(this.mainTable,"menu-animation-mode menu-animation-opening-mode menu-animation-closing-mode");var e=[i,C,this.menuHeaderBurger,this.headerBurger,b,y,E,k,u,l,r,c,d,h,m,M,p,g,this.menuContainer,I];e.forEach((function(e){if(e){e.style.cssText=""}}));o.forEach((function(e){var t=e.querySelector(".menu-item-icon-box");var n=e.querySelector(".menu-item-link-text");var i=e.querySelector(".menu-item-index");var a=e.querySelector(".menu-item-link-arrow");e.style.cssText="";n.style.cssText="";t.style.cssText="";if(a){a.style.cssText=""}if(i){i.style.cssText=""}}));this.releaseSliding();kt(this,St,At).call(this);if(BX.type.isFunction(n)){n()}X.toggleMenu(a);var t=document.createEvent("Event");t.initEvent("resize",true,true);window.dispatchEvent(t)}.bind(this)}).animate()}},{key:"handleViewMode",value:function e(){this.getItemsController().switchToViewMode()}},{key:"applyScrollMode",value:function e(){this.switchToLogoMaskMode(true);var t=this.scrollModeThreshold+P.adminPanel.height;this.switchToScrollMode(window.pageYOffset>t)}},{key:"handleGroupPanelOpen",value:function e(){this.isMenuMouseLeaveBlocked.push("group")}},{key:"handleGroupPanelClose",value:function e(){this.isMenuMouseLeaveBlocked.pop()}},{key:"showUpButton",value:function e(){this.menuContainer.classList.add("menu-up-button-active")}},{key:"hideUpButton",value:function e(){this.menuContainer.classList.remove("menu-up-button-active")}},{key:"reverseUpButton",value:function e(){this.menuContainer.classList.add("menu-up-button-reverse")}},{key:"unreverseUpButton",value:function e(){this.menuContainer.classList.remove("menu-up-button-reverse")}},{key:"isUpButtonReversed",value:function e(){return this.menuContainer.classList.contains("menu-up-button-reverse")}},{key:"isDefaultTheme",value:function e(){return document.body.classList.contains("bitrix24-default-theme")}},{key:"getTopPadding",value:function e(){return this.isDefaultTheme()?0:9}},{key:"initPagetitleStar",value:function e(){return Z.isCurrentPageStandard(Z.getActiveTopMenuItem())}},{key:"getStructureForHelper",value:function e(){var t=this;var n={menu:{}};["show","hide"].forEach((function(e){Array.from(t.menuContainer.querySelectorAll('[data-status="'.concat(e,'"][data-type="').concat(re.code,'"]'))).forEach((function(t){n[e]=n[e]||[];n[e].push(t.getAttribute("data-id"))}))}));return n}},{key:"showItemWarning",value:function e(t){var n=t.itemId,i=t.title,a=t.events;if(this.getItemsController().items.has(n)){this.getItemsController().items.get(n).showWarning(i,a)}}},{key:"removeItemWarning",value:function e(t){if(this.getItemsController().items.has(t)){this.getItemsController().items.get(t).removeWarning()}}},{key:"decrementCounter",value:function e(t,n){if(!t||t.id!=="menu-counter-live-feed"){return}babelHelpers.classPrivateFieldSet(this,It,babelHelpers.classPrivateFieldGet(this,It)+parseInt(n));this.getItemsController().decrementCounter({"live-feed":parseInt(n)})}},{key:"updateCounters",value:function e(t,n){if(!t){return}if(t["**"]!==undefined){t["live-feed"]=t["**"];delete t["**"]}var a=false;if(!i.Type.isUndefined(t["**SG0"])){this.workgroupsCounterData["livefeed"]=t["**SG0"];delete t["**SG0"];a=true}if(!i.Type.isUndefined(t[i.Loc.getMessage("COUNTER_PROJECTS_MAJOR")])){this.workgroupsCounterData[i.Loc.getMessage("COUNTER_PROJECTS_MAJOR")]=t[i.Loc.getMessage("COUNTER_PROJECTS_MAJOR")];delete t[i.Loc.getMessage("COUNTER_PROJECTS_MAJOR")];a=true}if(!i.Type.isUndefined(t[i.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")])){this.workgroupsCounterData[i.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")]=t[i.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")];delete t[i.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")];a=true}if(a){t["workgroups"]=Object.entries(this.workgroupsCounterData).reduce((function(e,t){var n=babelHelpers.slicedToArray(t,2),i=n[1];return e+Number(i)}),0)}if(t["live-feed"]){if(t["live-feed"]<=0){babelHelpers.classPrivateFieldSet(this,It,0)}else{t["live-feed"]-=babelHelpers.classPrivateFieldGet(this,It)}}this.getItemsController().updateCounters(t,n)}}]);return e}();function wt(e){var t;var n=e.DATA_ID,i=e.NODE;var a=this.getItemsController().items.get(n);if(!a){var r=i.getAttribute("data-top-menu-id");if(i===i.parentNode.querySelector("[data-top-menu-id]")){var s=this.menuItemsBlock.querySelector('[data-top-menu-id="'.concat(r,'"]'));if(s){a=this.getItemsController().items.get(s.getAttribute("data-id"))}}}return(t=a)!==null&&t!==void 0?t:null}function Lt(){var e=this;return this.cache.remember("isLogoMaskNeeded",(function(){var t=e.menuHeader.querySelector(".logo");var n=false;if(t&&!t.querySelector(".logo-image-container")){var i=t.offsetWidth===0?e.header.querySelector(".logo")?e.header.querySelector(".logo").offsetWidth:0:t.offsetWidth;n=i>200}return n}))}function At(){var e=this;if(!this["menuAdjustAdminPanel"]){this["menuAdjustAdminPanel"]=function(t){var n=t.data;e.menuContainer.style.top=[n,"px"].join("")};r.EventEmitter.subscribe(P.adminPanel,u.eventName("onPanelHasChanged"),this["menuAdjustAdminPanel"])}this.menuContainer.style.top=[P.adminPanel.top,"px"].join("")}e.Menu=Tt})(this.BX.Intranet=this.BX.Intranet||{},BX.UI,BX,BX,BX.Main,BX.Event,BX.UI.Dialogs,BX.UI,BX.UI.Analytics);
//# sourceMappingURL=script.map.js